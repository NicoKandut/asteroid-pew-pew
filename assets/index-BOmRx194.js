(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const re=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),tt=(e,t)=>{e.x*=t,e.y*=t},G=e=>({x:Math.cos(e),y:Math.sin(e)}),ge=e=>Math.sqrt(e.x**2+e.y**2);let S=new Map;const ot=2e3,N=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const a=N(o),s=Math.cos(a.rotation),n=Math.sin(a.rotation);return{x:a.x+t.x*s-t.y*n,y:a.y+t.x*n+t.y*s,rotation:a.rotation+t.rotation}},st=(e,t)=>{S[e]||(S[e]=[]);const o=performance.now();S[e].push({x:t.x,y:t.y,time:o}),S[e]=S[e].filter(a=>o-a.time<ot)},at=e=>{delete S[e]},nt=e=>{for(const t in S){const o=S[t];if(!(!o||o.length<2)){e.beginPath();for(let a=0;a<o.length;a++){const s=o[a];a===0?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},rt="/asteroid-pew-pew/img/boom/boom_0.gif",it="/asteroid-pew-pew/img/boom/boom_1.gif",ct="/asteroid-pew-pew/img/boom/boom_2.gif",lt="/asteroid-pew-pew/img/boom/boom_3.gif",dt="/asteroid-pew-pew/img/boom/boom_4.gif",mt="/asteroid-pew-pew/img/boom/boom_5.gif",ut="/asteroid-pew-pew/img/boom/boom_6.gif",ht="/asteroid-pew-pew/img/boom/boom_7.gif",gt="/asteroid-pew-pew/img/boom/boom_8.gif",pt="/asteroid-pew-pew/img/boom/boom_9.gif",ft="/asteroid-pew-pew/img/boom/boom_10.gif",yt="/asteroid-pew-pew/img/boom/boom_11.gif",wt="/asteroid-pew-pew/img/boom/boom_12.gif",xt="/asteroid-pew-pew/img/boom/boom_13.gif",vt="/asteroid-pew-pew/img/boom/boom_14.gif",A=document.getElementsByTagName("canvas")[0],r=A.getContext("2d"),H="asteroid",b="bullet",W="explosion",J="flash",M="rocket",q="spaceship",Ae="velocity",F="spaceshippart",R="flames",bt="#ffffff",Mt="#ffff00",j="#ff0000",pe="#00ff00";let kt=0;const Et=()=>`${kt++}`,k={[H]:{color:bt},[b]:{color:Mt,length:10,strokeWidth:2},[M]:{color:j,radius:10},[q]:{color:pe},[Ae]:{color:j},[F]:{color:pe},[R]:{color:j}},I={[R]:{},[q]:{},[F]:{},[H]:{},[b]:{},[M]:{},[W]:{},[J]:{}};let De=!1,Q=!1,Ve=!1,Ue=!1;const Tt=e=>{De=e},Pt=e=>{Q=e},St=e=>{Ve=e},It=e=>{Ue=e},T=(e,t)=>{t.id=Et(),I[e][t.id]=t},E=(e,t)=>{delete I[e][t],at(t)},Lt=()=>{for(const e in I)I[e]={}},u=[];for(let e=0;e<15;++e)u.push(new Image);u[0].src=rt;u[1].src=it;u[2].src=ct;u[3].src=lt;u[4].src=dt;u[5].src=mt;u[6].src=ut;u[7].src=ht;u[8].src=gt;u[9].src=pt;u[10].src=ft;u[11].src=yt;u[12].src=wt;u[13].src=xt;u[14].src=vt;const Bt=()=>{A.width=A.clientWidth,A.height=A.clientHeight,r.clearRect(0,0,A.width,A.height);for(const e in I)for(const t of Object.values(I[e])){switch(e){case H:At(t);break;case W:Ut(t);break;case b:Dt(t);break;case M:Vt(t);break;case q:case F:Ft(t);break;case R:Rt(t);break;case J:Ot(t);break}st(t.id,N(t))}if(De){r.strokeStyle=k[Ae].color,r.lineWidth=1,r.beginPath();for(const e in I){for(const t of Object.values(I[e]))if("velocity"in t){const{position:o,velocity:a}=t,{x:s,y:n}=o,{x:c,y:l}=a;r.moveTo(s,n),r.lineTo(s+c*200,n+l*200)}r.stroke()}}Ve&&nt(r)},At=e=>{const{radius:t,texture:o}=e,a=N(e);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.drawImage(o,-t,-t,t*2,t*2),Q&&(r.strokeStyle=j,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),r.restore()},Dt=e=>{var s;const{length:t}=k[b],o=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;r.fillStyle=k[b].color,r.strokeStyle=k[b].color,r.lineWidth=(s=k[b])==null?void 0:s.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+a),r.lineTo(e.position.x-o,e.position.y-a),r.stroke()},Vt=e=>{var c;const{radius:t}=k[M],o=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},s={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},n={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=k[M].color,r.strokeStyle=k[M].color,r.lineWidth=((c=k[M])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(a.x,a.y),r.lineTo(s.x,s.y),r.lineTo(n.x,n.y),r.lineTo(a.x,a.y),r.stroke(),Ue){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},Ut=e=>{r.translate(e.position.x,e.position.y);const a=u[e.frame];r.drawImage(a,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<u.length-1?e.frame++:E(W,e.id)},Ft=e=>{const{width:t,height:o,texture:a}=e,s=N(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(a,-t/2,-o/2,t,o),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},Rt=e=>{var B,ee,_;const{width:t,height:o}=e,a=N(e),s=((B=e==null?void 0:e.parent)==null?void 0:B.velocity)??{x:0,y:1},n=((_=(ee=e==null?void 0:e.parent)==null?void 0:ee.parent)==null?void 0:_.velocity)??{x:0,y:0},c={x:s.x+n.x,y:s.y+n.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.beginPath();const m=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+m)*l),r.lineTo(t,(o+m)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+m)*l),r.lineTo(t/2,(o/2+m)*l),r.closePath(),r.fillStyle="yellow",r.fill(),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+m)),r.restore()},Ot=e=>{const t=e.position,o=e.rotation,a=3,s=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(a,a),r.lineTo(s,0),r.lineTo(a,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,a),r.lineTo(0,s),r.resetTransform(),r.closePath(),r.fill()},O=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),te=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},_t=(e,t,o)=>{e.force.x+=t.x,e.force.y+=t.y,e.torque+=o},Fe=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),fe=(e,t)=>Fe(e,t)<e.radius+t.radius,oe=(e,t,o,a)=>{if(e.frozen||t.frozen)return!1;const s=Fe(e,t);if(s>=e.radius+t.radius)return!1;const n={x:(t.position.x-e.position.x)/s,y:(t.position.y-e.position.y)/s},c=2*(e.velocity.x*n.x+e.velocity.y*n.y-t.velocity.x*n.x-t.velocity.y*n.y)/(e.mass+t.mass),l=e.radius+t.radius-s;a&&(e.position.x-=n.x*l,e.position.y-=n.y*l,t.position.x+=n.x*l,t.position.y+=n.y*l),e.velocity.x-=c*o*t.mass*n.x,e.velocity.y-=c*o*t.mass*n.y,t.velocity.x+=c*o*e.mass*n.x,t.velocity.y+=c*o*e.mass*n.y;const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return T(J,m),setTimeout(()=>E(J,m.id),100),!0},ye=10,Ct=30,we=(e,t,o,a,s)=>.5*(2*o+(-t+a)*e+(2*t-5*o+4*a-s)*e*e+(-t+3*o-3*a+s)*e*e*e),Re=(e,t,o,a,s)=>({x:we(e,t.x,o.x,a.x,s.x),y:we(e,t.y,o.y,a.y,s.y)}),Oe=(e,t)=>{const o=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return Re(t%1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position)},_e=(e,t)=>Oe(e,Ce(e,t)),Nt=e=>{e.arcLengthTable=[];let t=0,o=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*ye;++c){const l=c/ye,m=Oe(e,l),B=ge(re(m,o));t+=B,e.arcLengthTable.push({v:l,totalLength:t}),o=m}const a=e.targets.length-4,s=Re(1,e.targets[a+0].position,e.targets[a+1].position,e.targets[a+2].position,e.targets[a+3].position),n=ge(re(s,o));t+=n,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},Ht=e=>-(Math.cos(Math.PI*e)-1)/2,Ce=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const B=m.totalLength-l.totalLength;if(B===0){o=m.v;break}const _=(t-l.totalLength)/B;o=l.v*(1-_)+m.v*_;break}}const a=Math.floor(o),s=o-a,n=Ht(s);return a+n},Wt=(e,t,o)=>{const a=_e(e,t);e.velocity=re(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const s=Math.max(Math.min(Math.floor(Ce(e,t)),e.targets.length-3),0);if(s!==e.currentTarget&&(o(e.targets[s+1]),e.currentTarget=s),s>=e.targets.length-3){e.remove=!0;return}},qt=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=Ct)e.pathPoints.push(_e(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},P=document.getElementsByTagName("canvas")[0],Gt=()=>({x:Math.random()*P.width,y:Math.random()*P.height}),$t=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*P.width,y:-90};case 1:return{x:P.width+t,y:Math.random()*P.height};case 2:return{x:Math.random()*P.width,y:P.height+t};case 3:return{x:-90,y:Math.random()*P.height}}},jt=e=>(Math.random()*2-1)*e,zt=()=>{const e=[20,30,40];return e[Math.floor(Math.random()*e.length)]},x={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},Jt=JSON.stringify(x),Ne=(e,t)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default"),He=(e,t)=>{const o=Ne(e,t);return JSON.parse(localStorage.getItem(o)||Jt)},d={...x},Xt=(e,t)=>{const o=He(e,t);o.timePlayed=Math.max(o.timePlayed,d.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,d.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,d.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,d.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,d.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,d.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,d.distanceTraveled),localStorage.setItem(Ne(e,t),JSON.stringify(o))},Yt=()=>{d.timePlayed=x.timePlayed,d.asteroidsDestroyed=x.asteroidsDestroyed,d.damageDealt=x.damageDealt,d.bulletsFired=x.bulletsFired,d.bulletsHit=x.bulletsHit,d.rocketsFired=x.rocketsFired,d.distanceTraveled=x.distanceTraveled},Kt="/asteroid-pew-pew/audio/propulsion.mp3",Qt="/asteroid-pew-pew/audio/explosion.wav",Zt="/asteroid-pew-pew/audio/shoot.wav",eo="/asteroid-pew-pew/audio/hurt.wav",We="/asteroid-pew-pew/audio/hit.wav",to="/asteroid-pew-pew/audio/click.wav",oo="/asteroid-pew-pew/audio/submit.wav",so="/asteroid-pew-pew/audio/CODEX_2015.mp3";let w=.5;const ao=e=>{ue.volume=.05*e,w=e},Z=new Audio(Kt);Z.volume=0;Z.loop=!0;document.addEventListener("keydown",()=>Z.play().catch(()=>{}),{once:!0});const X=e=>{Z.volume=e*w},C=()=>{const e=new Audio(oo);e.volume=.5*w,e.play().catch(()=>{})},v=()=>{const e=new Audio(to);e.volume=.5*w,e.play().catch(()=>{})},no=()=>{const e=new Audio(We);e.volume=.1*w,e.play().catch(()=>{})},ro=()=>{const e=new Audio(eo);e.volume=.3*w,e.play().catch(()=>{})},io=()=>{const e=new Audio(Zt);e.volume=.1*w,e.play().catch(()=>{})},co=()=>{const e=new Audio(We);e.volume=.2*w,e.play().catch(()=>{})},se=()=>{const e=new Audio(Qt);e.volume=.3*w,e.play().catch(()=>{})},ue=new Audio(so);ue.volume=.05*w;ue.loop=!0;const lo="/asteroid-pew-pew/img/Asteroid1.png",mo="/asteroid-pew-pew/img/Spaceship.png",uo="/asteroid-pew-pew/img/WingLeft.png",ho="/asteroid-pew-pew/img/WingRight.png";let go=document.getElementById("entity-count"),po=document.getElementById("fps"),fo=document.getElementById("ups"),yo=document.getElementById("target-fps"),wo=document.getElementById("target-ups"),qe=document.getElementById("pause-menu");const Ge=document.getElementById("main-menu"),xo=document.getElementById("pause-resume"),vo=document.getElementById("debug-velocity"),bo=document.getElementById("debug-hitbox"),Mo=document.getElementById("debug-trajectory"),ko=document.getElementById("debug-spline-paths"),Eo=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");document.getElementById("rocket-piercing");document.getElementById("bullet-damage");const xe=document.getElementById("hp"),$e=document.getElementById("game-over"),To=document.getElementById("time-played"),Po=document.getElementById("asteroids-destroyed"),So=document.getElementById("distance-traveled"),Io=document.getElementById("damage-dealt"),Lo=document.getElementById("start"),Bo=document.getElementById("restart"),Ao=document.getElementById("volume"),Do=document.getElementById("mode-pacifist"),Vo=document.getElementById("mode-stationary"),Uo=document.getElementById("mark-pacifist"),Fo=document.getElementById("mark-stationary"),Ro=document.getElementById("back-to-main-menu"),Oo=document.getElementById("pause-back-to-main-menu"),ve=document.getElementById("controls-move"),be=document.getElementById("controls-bullet"),Me=document.getElementById("controls-rocket"),_o=(e,t,o,a,s,n,c,l,m)=>{Co(e,m,t,o),Ho(a,s,n,c,l),qo(e,m)},Co=(e,t,o,a)=>{Lo.addEventListener("click",()=>{C(),No(),t(),e()}),Do.addEventListener("change",s=>{v(),o(!s.target.checked),s.target.checked?(be.setAttribute("disabled","true"),Me.setAttribute("disabled","true")):(be.removeAttribute("disabled"),Me.removeAttribute("disabled"))}),Vo.addEventListener("change",s=>{v(),a(!s.target.checked),s.target.checked?ve.setAttribute("disabled","true"):ve.removeAttribute("disabled")})},je=()=>{Ge.style.display="grid"},No=()=>{Ge.style.display="none"},Ho=(e,t,o,a,s)=>{Ao.addEventListener("input",n=>{e(n.target.value/100)}),yo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),t(1e3/n.target.value)}),wo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),o(1e3/n.target.value)}),vo.addEventListener("change",n=>{v(),Tt(n.target.checked)}),bo.addEventListener("change",n=>{v(),Pt(n.target.checked)}),Mo.addEventListener("change",n=>{v(),St(n.target.checked)}),ko.addEventListener("change",n=>{v(),It(n.target.checked)}),Eo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),a(n.target.value)}),xo.addEventListener("click",()=>{C(),Y(),s()}),Oo.addEventListener("click",()=>{C(),Y(),je()})},Wo=()=>{qe.style.display="flex"},Y=()=>{qe.style.display="none"},qo=(e,t)=>{Bo.addEventListener("click",()=>{C(),ie(),t(),e()}),Ro.addEventListener("click",()=>{C(),ie(),je()})},Go=()=>{$e.style.display="grid"},ie=()=>{$e.style.display="none"},$o=(e,t,o,a)=>{Uo.style.display=e?"none":"block",Fo.style.display=t?"none":"block",$(To,o.timePlayed/1e3,a.timePlayed/1e3,"s",1),$(Po,o.asteroidsDestroyed,a.asteroidsDestroyed),$(So,o.distanceTraveled,a.distanceTraveled,"m",1),$(Io,o.damageDealt,a.damageDealt,"hp",0)},$=(e,t,o,a,s)=>{e.children.item(1).innerText=a?`${t.toFixed(s)} ${a}`:`${t.toFixed(s)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${o.toFixed(s)} ${a}`:o.toFixed(s)} )`)},ze=e=>{if(e==5)for(let t of xe.children)t.style.color="red";else xe.children.item(e).style.color="grey"},jo=(e,t,o)=>{go.innerText=`${e}`,po.innerText=`${t}`,fo.innerText=`${o}`};let p=document.getElementsByTagName("canvas")[0];const Je=2e3,zo=e=>4/3*Math.PI*e**3*3.5;let g=!0;const Xe=()=>g=!1;let he,z=1e3/120;const Jo=e=>z=e;let Ye=1e3/60;const Xo=e=>Ye=e;let K=0,ke=0,ce=0,U=!0;const Yo=e=>U=e;let L=!0;const Ko=e=>L=e;let ae=0,ne=0,f=[],D=[],V=[],i=null,Ee=1,Te=0,le=!1,Pe=0,Qo=40,Zo=3,de=!1,es=3e3,Se=0,Ke=300;const ts=e=>Ke=e;let me=1e3,Ie=0;const os=e=>Math.pow(.99,e/1e3)*1e3;let h={forward:!1,backward:!1,left:!1,right:!1};const ss=()=>{K=performance.now(),ce=K,as(),_o(ps,Yo,Ko,ao,Xo,Jo,ts,Xe,ys)},as=()=>{document.addEventListener("keydown",e=>{switch(e.key){case"Escape":us();break;case" ":le=!g&&U;break;case"Shift":de=!g&&U;break;case"ArrowUp":case"w":case"W":h.forward=!g&&L;break;case"ArrowDown":case"s":case"S":h.backward=!g&&L;break;case"ArrowLeft":case"a":case"A":h.left=!g&&L;break;case"ArrowRight":case"d":case"D":h.right=!g&&L;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":le=!1;break;case"Shift":de=!1;break;case"ArrowUp":case"w":case"W":h.forward=!1;break;case"ArrowDown":case"s":case"S":h.backward=!1;break;case"ArrowLeft":case"a":case"A":h.left=!1;break;case"ArrowRight":case"d":case"D":h.right=!1;break}}),document.addEventListener("mousemove",e=>{if(g||i==null)return;const t=e.clientX-p.getBoundingClientRect().left,o=e.clientY-p.getBoundingClientRect().top,a=t-i.position.x,s=o-i.position.y;i.rotation=Math.atan2(s,a)})};let y=performance.now();const Qe=()=>{for(y=performance.now();ke+z/2<=y;)g||(rs(z),++ae),ke+=z;if(K+Ye/2<=y&&(g||(Bt(),++ne),K=y),y-ce>=1e3){const e=f.length+D.length+V.length+(i?1:0);jo(e,ne,ae),ne=0,ae=0,ce=y}he=requestAnimationFrame(Qe)},ns=e=>{if(le&&y-Pe>=Qo&&i){const t=i.rotation+(Math.random()-.5)*.1,o=Te%2===0?-1:1,a=G(i.rotation+Math.PI/2*o);a.x*=10,a.y*=10,a.x+=i.position.x,a.y+=i.position.y,ls(a,t,G(t),0);const s=G(t+Math.PI);s.x*=.01,s.y*=.01,_t(i,s,0),io(),Te++,Pe=y}if(de&&y-Se>=es&&i){const t=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let o=0;o<Math.min(Zo,f.length);o++){let a;do a=f[Math.floor(Math.random()*f.length)];while(t.includes(a));a.frozen=!0,a.velocity.x=0,a.velocity.y=0,t.push(a)}t.push(i),ds({...i.position},i.rotation,tt(G(i.rotation),.2),0,t),Se=y}if(y-Ie>=me){const t=$t(),o=Gt(),a=Math.random()*Math.PI*2,s={x:o.x-t.x,y:o.y-t.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=Math.random()*.1+.1,s.y*=Math.random()*.1+.1;const c=jt(.01),l=zt();cs(t,a,{x:0,y:0},s,c,l),Ie=y,me=os(d.timePlayed)}i&&(h.forward&&(i.force.y-=.004),h.backward&&(i.force.y+=.004),h.left&&(i.force.x-=.004),h.right&&(i.force.x+=.004))},Le=e=>e.x<-100||e.x>p.width+100||e.y<-100||e.y>p.height+100,rs=e=>{ns(),d.timePlayed+=e;for(const s of f){te(s,e),Le(s.position)&&(s.remove=!0);for(const n of f)s!==n&&oe(s,n,1,!0)&&no()}for(const s of D){te(s,e),Le(s.position)&&(s.remove=!0);for(const n of f)oe(s,n,1,!1)&&(d.bulletsHit++,d.damageDealt+=Math.min(n.hp,Ee),n.hp-=Ee,s.remove=!0,co(),n.hp<=0&&(++d.asteroidsDestroyed,n.remove=!0,se()))}for(const s of V)s.progress+=e/1e3*Ke,Wt(s,s.progress,n=>{n.remove=!0,++d.asteroidsDestroyed,d.damageDealt+=n.hp,se()});const t={...i.position};te(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},a=Math.sqrt(o.x**2+o.y**2);d.distanceTraveled+=a,X(Math.min(a/100,.05));for(const s of f)if(oe(i,s,1,!0)&&(i.hp-=1,ro(),i.hp>=0&&ze(i.hp),i.hp<=0)){se(),hs(),X(0),T(W,{position:{...i.position},frame:0}),setTimeout(()=>{fs()},1e3);break}!h.forward&&!h.backward&&!h.left&&!h.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3)),(i.position.x<0||i.position.x>p.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,p.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>p.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,p.height)),i.velocity.y*=-1),is()},is=()=>{f.forEach(e=>{e.remove&&(E(H,e.id),e.frame=0,T(W,e))}),D.forEach(e=>{e.remove&&E(b,e.id)}),V.forEach(e=>{e.remove&&(E(M,e.id),e.children.forEach(t=>{E(R,t.id)}))}),f=f.filter(e=>!e.remove),D=D.filter(e=>!e.remove),V=V.filter(e=>!e.remove)},Ze=new Image;Ze.src=lo;const cs=(e,t,o,a,s,n)=>{const c=O();if(c.position=e,c.rotation=t,c.acceleration=o,c.velocity=a,c.angularVelocity=s,c.mass=zo(n),c.radius=n,c.inertia=2/5*c.mass*n**2,c.hp=n/2,c.texture=Ze,!fe(c,i)){for(const l of f)if(fe(c,l))return;T(H,c),f.push(c)}},ls=(e,t,o,a)=>{const s=O();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=Je,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,T(b,s),D.push(s),++d.bulletsFired},ds=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=a,n.mass=Je,n.radius=5,n.targets=s,n.progress=0,n.currentTarget=0,Nt(n),qt(n),T(M,n),V.push(n),et({x:-5,y:0},Math.PI/2,n),++d.rocketsFired},ms=(e,t,o,a)=>{i=O(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=a,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const s=new Image;s.src=mo,i.texture=s,T(q,i),Be({x:-5,y:18},0,F,ho,i),Be({x:-5,y:-18},0,F,uo,i)},Be=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.parent=s,n.height=20,n.width=20,T(o,n);const c=new Image;c.src=a,n.texture=c,s.children??(s.children=s.children||[]),s.children.push(n),et({x:-5,y:0},Math.PI/2,n)},et=(e,t,o)=>{const a=O();a.position=e,a.rotation=t,a.parent=o,a.height=10,a.width=5,o.children??(o.children=o.children||[]),o.children.push(a),T(R,a)},us=()=>{g=!g,g?(Wo(),X(0)):Y()},hs=()=>{if(i){E(q,i.id);for(let e of i.children){E(F,e.id);for(let t of e.children)E(R,t.id)}}},gs=()=>{p.width=p.clientWidth,p.height=p.clientHeight,ms({x:p.width/2,y:p.height/2},0,{x:0,y:0},0)},ps=()=>{gs(),Xe(),he=requestAnimationFrame(Qe)},fs=()=>{cancelAnimationFrame(he),g=!0,X(0),i=null;const e=He(!U,!L);$o(U,L,d,e),Go(),Xt(!U,!L)},ys=()=>{Yt(),Lt(),f=[],D=[],V=[],me=1e3,ze(5),Y(),ie()};ss();
