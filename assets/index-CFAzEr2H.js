(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();let A=new Map;const Mt=2e3,z=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},s=e.parent;if(s==null)return t;const n=z(s),o=Math.cos(n.rotation),a=Math.sin(n.rotation);return{x:n.x+t.x*o-t.y*a,y:n.y+t.x*a+t.y*o,rotation:n.rotation+t.rotation}},kt=(e,t)=>{A[e]||(A[e]=[]);const s=performance.now();A[e].push({x:t.x,y:t.y,time:s}),A[e]=A[e].filter(n=>s-n.time<Mt)},Et=e=>{delete A[e]},Tt=e=>{for(const t in A){const s=A[t];if(!(!s||s.length<2)){e.beginPath();for(let n=0;n<s.length;n++){const o=s[n];n===0?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},Pt="/asteroid-pew-pew/img/boom/boom_0.gif",It="/asteroid-pew-pew/img/boom/boom_1.gif",St="/asteroid-pew-pew/img/boom/boom_2.gif",At="/asteroid-pew-pew/img/boom/boom_3.gif",Lt="/asteroid-pew-pew/img/boom/boom_4.gif",Bt="/asteroid-pew-pew/img/boom/boom_5.gif",Vt="/asteroid-pew-pew/img/boom/boom_6.gif",Dt="/asteroid-pew-pew/img/boom/boom_7.gif",Ct="/asteroid-pew-pew/img/boom/boom_8.gif",Ut="/asteroid-pew-pew/img/boom/boom_9.gif",Rt="/asteroid-pew-pew/img/boom/boom_10.gif",Ft="/asteroid-pew-pew/img/boom/boom_11.gif",Ot="/asteroid-pew-pew/img/boom/boom_12.gif",_t="/asteroid-pew-pew/img/boom/boom_13.gif",Ht="/asteroid-pew-pew/img/boom/boom_14.gif",Wt="/asteroid-pew-pew/img/ice.png",Nt="/asteroid-pew-pew/img/powerup.png",D=document.getElementsByTagName("canvas")[0],r=D.getContext("2d"),J="asteroid",T="bullet",X="explosion",oe="flash",P="rocket",Y="spaceship",Ge="velocity",O="spaceshippart",_="flames",re="powerup",Gt="#ffffff",qt="#ffff00",ee="#ff0000",Ee="#00ff00";let $t=0;const jt=()=>`${$t++}`,I={[J]:{color:Gt},[T]:{color:qt,length:10,strokeWidth:2},[P]:{color:ee,radius:10},[Y]:{color:Ee},[Ge]:{color:ee},[O]:{color:Ee},[_]:{color:ee}},L={[_]:{},[Y]:{},[O]:{},[J]:{},[T]:{},[P]:{},[X]:{},[oe]:{},[re]:{}};let qe=!1,K=!1,$e=!1,je=!1;const zt=e=>{qe=e},Jt=e=>{K=e},Xt=e=>{$e=e},Yt=e=>{je=e},M=(e,t)=>{t.id=jt(),L[e][t.id]=t},v=(e,t)=>{delete L[e][t],Et(t)},Kt=()=>{for(const e in L)L[e]={}},g=[];for(let e=0;e<15;++e)g.push(new Image);g[0].src=Pt;g[1].src=It;g[2].src=St;g[3].src=At;g[4].src=Lt;g[5].src=Bt;g[6].src=Vt;g[7].src=Dt;g[8].src=Ct;g[9].src=Ut;g[10].src=Rt;g[11].src=Ft;g[12].src=Ot;g[13].src=_t;g[14].src=Ht;const ze=new Image;ze.src=Wt;const Qt=()=>{D.width=D.clientWidth,D.height=D.clientHeight,r.clearRect(0,0,D.width,D.height);for(const e in L)for(const t of Object.values(L[e])){switch(e){case J:Zt(t);break;case X:oo(t);break;case T:eo(t);break;case P:to(t);break;case Y:case O:so(t);break;case _:ao(t);break;case oe:no(t);break;case re:ro(t);break}kt(t.id,z(t))}if(qe){r.strokeStyle=I[Ge].color,r.lineWidth=1,r.beginPath();for(const e in L){for(const t of Object.values(L[e]))if("velocity"in t){const{position:s,velocity:n}=t,{x:o,y:a}=s,{x:c,y:l}=n;r.moveTo(o,a),r.lineTo(o+c*200,a+l*200)}r.stroke()}}$e&&Tt(r)},Zt=e=>{const{radius:t,texture:s}=e,n=z(e);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.drawImage(s,-t,-t,t*2,t*2),K&&(r.strokeStyle=ee,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(ze,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore()},eo=e=>{var o;const{length:t}=I[T],s=Math.cos(e.rotation)*t/2,n=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?I[T].color:"red",r.strokeStyle=e.friendly?I[T].color:"red",r.lineWidth=(o=I[T])==null?void 0:o.strokeWidth,r.beginPath(),r.moveTo(e.position.x+s,e.position.y+n),r.lineTo(e.position.x-s,e.position.y-n),r.stroke()},to=e=>{var c;const{radius:t}=I[P],s=2*Math.PI/8,n={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},o={x:e.position.x-t*Math.cos(e.rotation+s),y:e.position.y-t*Math.sin(e.rotation+s)},a={x:e.position.x-t*Math.cos(e.rotation-s),y:e.position.y-t*Math.sin(e.rotation-s)};if(r.fillStyle=I[P].color,r.strokeStyle=I[P].color,r.lineWidth=((c=I[P])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(n.x,n.y),r.lineTo(o.x,o.y),r.lineTo(a.x,a.y),r.lineTo(n.x,n.y),r.stroke(),je){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},oo=e=>{r.translate(e.position.x,e.position.y);const n=g[e.frame];r.drawImage(n,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<g.length-1?e.frame++:v(X,e.id)},so=e=>{const{width:t,height:s,texture:n}=e,o=z(e);r.save(),r.translate(o.x,o.y),r.rotate(o.rotation),r.drawImage(n,-t/2,-s/2,t,s),K&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-s/2,t,s)),r.restore()},ao=e=>{var k,ce,H;const{width:t,height:s}=e,n=z(e),o=((k=e==null?void 0:e.parent)==null?void 0:k.velocity)??{x:0,y:1},a=((H=(ce=e==null?void 0:e.parent)==null?void 0:ce.parent)==null?void 0:H.velocity)??{x:0,y:0},c={x:o.x+a.x,y:o.y+a.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.beginPath();const m=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(s+m)*l),r.lineTo(t,(s+m)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(s/2+m)*l),r.lineTo(t/2,(s/2+m)*l),r.closePath(),r.fillStyle="yellow",r.fill(),K&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,s+m)),r.restore()},no=e=>{const t=e.position,s=e.rotation,n=3,o=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(s),r.moveTo(n,n),r.lineTo(o,0),r.lineTo(n,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,n),r.lineTo(0,o),r.resetTransform(),r.closePath(),r.fill()},Je=new Image;Je.src=Nt;const ro=e=>{const{radius:t}=e,s=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(Je,-t,-t,s,s),K&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,s,s)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸ’š",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.fillStyle="blue",r.textAlign="center",r.font="20px Arial",r.fillText("ðŸš€",0,7);break}r.restore()},R=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),Q=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const s=Math.sqrt(e.velocity.x**2+e.velocity.y**2);s>e.maxVelocity&&(e.velocity.x/=s/e.maxVelocity,e.velocity.y/=s/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Xe=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),pe=(e,t)=>Xe(e,t)<e.radius+t.radius,W=(e,t,s,n)=>{const o=Xe(e,t);if(o>=e.radius+t.radius)return!1;const a={x:(t.position.x-e.position.x)/o,y:(t.position.y-e.position.y)/o},c=2*(e.velocity.x*a.x+e.velocity.y*a.y-t.velocity.x*a.x-t.velocity.y*a.y)/(e.mass+t.mass),l=e.radius+t.radius-o;n&&(e.position.x-=a.x*l,e.position.y-=a.y*l,t.position.x+=a.x*l,t.position.y+=a.y*l),e.frozen||(e.velocity.x-=c*s*t.mass*a.x,e.velocity.y-=c*s*t.mass*a.y),t.frozen||(t.velocity.x+=c*s*e.mass*a.x,t.velocity.y+=c*s*e.mass*a.y);const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return M(oe,m),setTimeout(()=>v(oe,m.id),100),!0},ge=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),io=(e,t)=>{e.x*=t,e.y*=t},de=e=>({x:Math.cos(e),y:Math.sin(e)}),lo=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},Te=e=>Math.sqrt(e.x**2+e.y**2),Pe=10,co=30,Ie=(e,t,s,n,o)=>.5*(2*s+(-t+n)*e+(2*t-5*s+4*n-o)*e*e+(-t+3*s-3*n+o)*e*e*e),Ye=(e,t,s,n,o)=>({x:Ie(e,t.x,s.x,n.x,o.x),y:Ie(e,t.y,s.y,n.y,o.y)}),Ke=(e,t)=>{const s=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return Ye(t%1,e.targets[s+0].position,e.targets[s+1].position,e.targets[s+2].position,e.targets[s+3].position)},Qe=(e,t)=>Ke(e,Ze(e,t)),mo=e=>{e.arcLengthTable=[];let t=0,s=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*Pe;++c){const l=c/Pe,m=Ke(e,l),k=Te(ge(m,s));t+=k,e.arcLengthTable.push({v:l,totalLength:t}),s=m}const n=e.targets.length-4,o=Ye(1,e.targets[n+0].position,e.targets[n+1].position,e.targets[n+2].position,e.targets[n+3].position),a=Te(ge(o,s));t+=a,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},uo=e=>-(Math.cos(Math.PI*e)-1)/2,Ze=(e,t)=>{let s=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const k=m.totalLength-l.totalLength;if(k===0){s=m.v;break}const H=(t-l.totalLength)/k;s=l.v*(1-H)+m.v*H;break}}const n=Math.floor(s),o=s-n,a=uo(o);return n+a},ho=(e,t,s)=>{const n=Qe(e,t);e.velocity=ge(n,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=n;const o=Math.max(Math.min(Math.floor(Ze(e,t)),e.targets.length-3),0);if(o!==e.currentTarget&&(s(e.targets[o+1]),e.currentTarget=o),o>=e.targets.length-3){e.remove=!0;return}},po=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let s=0;s<=t;s+=co)e.pathPoints.push(Qe(e,s));e.pathPoints.push(e.targets[e.targets.length-2].position)},S=document.getElementsByTagName("canvas")[0],go=()=>({x:Math.random()*S.width,y:Math.random()*S.height}),Se=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*S.width,y:-90};case 1:return{x:S.width+t,y:Math.random()*S.height};case 2:return{x:Math.random()*S.width,y:S.height+t};case 3:return{x:-90,y:Math.random()*S.height}}},fe=e=>(Math.random()*2-1)*e,fo=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},yo=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],s=Math.random();for(let n=0;n<e.length;n++)if(s<t[n])return e[n];return e[e.length-1]},et=(e,t)=>{const s=Math.random();let n=0;for(let o=0;o<t.length;o++)if(n+=t[o],s<n)return e[o];return e[t.length-1]},wo=()=>et(["default","homing","armored","turret"],[.85,.05,.05,.05]),xo=()=>et(["homing","armored","turret"],[.34,.33,.33]),E={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},bo=JSON.stringify(E),tt=(e,t,s)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(s?"-extreme":"-default"),ot=(e,t,s)=>{const n=tt(e,t,s);return JSON.parse(localStorage.getItem(n)||bo)},u={...E},vo=(e,t,s)=>{const n=ot(e,t,s);n.timePlayed=Math.max(n.timePlayed,u.timePlayed),n.asteroidsDestroyed=Math.max(n.asteroidsDestroyed,u.asteroidsDestroyed),n.damageDealt=Math.max(n.damageDealt,u.damageDealt),n.bulletsFired=Math.max(n.bulletsFired,u.bulletsFired),n.bulletsHit=Math.max(n.bulletsHit,u.bulletsHit),n.rocketsFired=Math.max(n.rocketsFired,u.rocketsFired),n.distanceTraveled=Math.max(n.distanceTraveled,u.distanceTraveled),localStorage.setItem(tt(e,t,s),JSON.stringify(n))},Mo=()=>{u.timePlayed=E.timePlayed,u.asteroidsDestroyed=E.asteroidsDestroyed,u.damageDealt=E.damageDealt,u.bulletsFired=E.bulletsFired,u.bulletsHit=E.bulletsHit,u.rocketsFired=E.rocketsFired,u.distanceTraveled=E.distanceTraveled},ko="/asteroid-pew-pew/audio/propulsion.mp3",Eo="/asteroid-pew-pew/audio/explosion.wav",To="/asteroid-pew-pew/audio/shoot.wav",Po="/asteroid-pew-pew/audio/hurt.wav",st="/asteroid-pew-pew/audio/hit.wav",Io="/asteroid-pew-pew/audio/click.wav",So="/asteroid-pew-pew/audio/submit.wav",Ao="/asteroid-pew-pew/audio/powerup.wav",Lo="/asteroid-pew-pew/audio/CODEX_2015.mp3",Bo="/asteroid-pew-pew/audio/armorHit.wav";let x=.5;const Vo=e=>{ve.volume=.05*e,x=e},ie=new Audio(ko);ie.volume=0;ie.loop=!0;document.addEventListener("keydown",()=>ie.play().catch(()=>{}),{once:!0});const le=e=>{ie.volume=e*x},q=()=>{const e=new Audio(So);e.volume=.5*x,e.play().catch(()=>{})},b=()=>{const e=new Audio(Io);e.volume=.5*x,e.play().catch(()=>{})},Do=()=>{const e=new Audio(st);e.volume=.1*x,e.play().catch(()=>{})},Co=()=>{const e=new Audio(Po);e.volume=.3*x,e.play().catch(()=>{})},at=()=>{const e=new Audio(To);e.volume=.1*x,e.play().catch(()=>{})},Uo=()=>{const e=new Audio(st);e.volume=.2*x,e.play().catch(()=>{})},Ro=()=>{const e=new Audio(Bo);e.volume=.2*x,e.play().catch(()=>{})},ye=()=>{const e=new Audio(Eo);e.volume=.3*x,e.play().catch(()=>{})},Fo=()=>{const e=new Audio(Ao);e.volume=.2*x,e.play().catch(()=>{})},ve=new Audio(Lo);ve.volume=.05*x;ve.loop=!0;const Oo="/asteroid-pew-pew/img/Asteroid1.png",_o="/asteroid-pew-pew/img/asteroid_red.png",Ho="/asteroid-pew-pew/img/asteroid_armored.png",Wo="/asteroid-pew-pew/img/asteroid_green.png",No="/asteroid-pew-pew/img/Spaceship.png",Go="/asteroid-pew-pew/img/WingLeft.png",qo="/asteroid-pew-pew/img/WingRight.png";let $o=document.getElementById("entity-count"),jo=document.getElementById("fps"),zo=document.getElementById("ups"),Jo=document.getElementById("target-fps"),Xo=document.getElementById("target-ups"),nt=document.getElementById("pause-menu");const rt=document.getElementById("main-menu"),Yo=document.getElementById("pause-resume"),Ko=document.getElementById("debug-velocity"),Qo=document.getElementById("debug-hitbox"),Zo=document.getElementById("debug-trajectory"),es=document.getElementById("debug-spline-paths"),ts=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const os=document.getElementById("rocket-piercing"),ss=document.getElementById("bullet-damage"),Ae=document.getElementById("hp"),it=document.getElementById("game-over"),as=document.getElementById("time-played"),ns=document.getElementById("asteroids-destroyed"),rs=document.getElementById("distance-traveled"),is=document.getElementById("damage-dealt"),ls=document.getElementById("start"),cs=document.getElementById("restart"),ds=document.getElementById("volume"),ms=document.getElementById("mode-pacifist"),us=document.getElementById("mode-stationary"),hs=document.getElementById("mode-extreme"),ps=document.getElementById("mark-pacifist"),gs=document.getElementById("mark-stationary"),fs=document.getElementById("mark-extreme"),ys=document.getElementById("back-to-main-menu"),ws=document.getElementById("pause-back-to-main-menu"),Le=document.getElementById("controls-move"),Be=document.getElementById("controls-bullet"),Ve=document.getElementById("controls-rocket"),xs=(e,t,s,n,o,a,c,l,m,k)=>{bs(e,m,t,s,k),Ms(n,o,a,c,l),ks(e,m)},bs=(e,t,s,n,o)=>{ls.addEventListener("click",()=>{q(),vs(),t(),e()}),ms.addEventListener("change",a=>{b(),s(!a.target.checked),a.target.checked?(Be.setAttribute("disabled","true"),Ve.setAttribute("disabled","true")):(Be.removeAttribute("disabled"),Ve.removeAttribute("disabled"))}),us.addEventListener("change",a=>{b(),n(!a.target.checked),a.target.checked?Le.setAttribute("disabled","true"):Le.removeAttribute("disabled")}),hs.addEventListener("change",a=>{b(),o(a.target.checked)})},lt=()=>{rt.style.display="grid"},vs=()=>{rt.style.display="none"},Ms=(e,t,s,n,o)=>{ds.addEventListener("input",a=>{e(a.target.value/100)}),Jo.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),t(1e3/a.target.value)}),Xo.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),s(1e3/a.target.value)}),Ko.addEventListener("change",a=>{b(),zt(a.target.checked)}),Qo.addEventListener("change",a=>{b(),Jt(a.target.checked)}),Zo.addEventListener("change",a=>{b(),Xt(a.target.checked)}),es.addEventListener("change",a=>{b(),Yt(a.target.checked)}),ts.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),n(a.target.value)}),Yo.addEventListener("click",()=>{q(),se(),o()}),ws.addEventListener("click",()=>{q(),se(),lt()})},ct=()=>{nt.style.display="flex"},se=()=>{nt.style.display="none"},ks=(e,t)=>{cs.addEventListener("click",()=>{q(),we(),t(),e()}),ys.addEventListener("click",()=>{q(),we(),lt()})},Es=()=>{it.style.display="grid"},we=()=>{it.style.display="none"},Ts=(e,t,s,n,o)=>{ps.style.display=e?"none":"block",gs.style.display=t?"none":"block",fs.style.display=s?"block":"none",Z(as,n.timePlayed/1e3,o.timePlayed/1e3,"s",1),Z(ns,n.asteroidsDestroyed,o.asteroidsDestroyed),Z(rs,n.distanceTraveled,o.distanceTraveled,"m",1),Z(is,n.damageDealt,o.damageDealt,"hp",0)},Z=(e,t,s,n,o)=>{e.children.item(1).innerText=n?`${t.toFixed(o)} ${n}`:`${t.toFixed(o)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>s?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${n?`${s.toFixed(o)} ${n}`:s.toFixed(o)} )`)},Ps=e=>{os.innerText=`${e}`},Is=e=>{ss.innerText=e.toFixed(1)},Me=e=>{for(let t=0;t<Ae.children.length;t++)Ae.children.item(t).style.color=t<e?"red":"grey"},Ss=(e,t,s)=>{$o.innerText=`${e}`,jo.innerText=`${t}`,zo.innerText=`${s}`};let f=document.getElementsByTagName("canvas")[0],V=null;const dt=2e3,As=(e,t)=>{const s=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*s};let h=!0;const mt=()=>h=!1;let ke,te=1e3/120;const Ls=e=>te=e;let ut=1e3/60;const Bs=e=>ut=e;let ae=0,De=0,xe=0,B=!0;const Vs=e=>B=e;let w=!0;const Ds=e=>w=e;let me=0,ue=0,Ce=0,y=[],C=[],U=[],i=null,G=[],N=1,Ue=0,$=!1,Re=0,Cs=40,Fe=80,ne=3,j=!1,Us=3e3,Oe=0,ht=300;const Rs=e=>ht=e;let be=1e3,_e=0;const Fs=e=>Math.pow(.99,e/1e3)*1e3;let F=!1;const Os=e=>F=e;let _s=1e4,He=0,d={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const Hs=()=>{document.getElementById("version").innerText="0.2.0",ae=performance.now(),xe=ae,Ns(),xs(Zs,Vs,Ds,Vo,Bs,Ls,Rs,mt,ta,Os)},Ws=e=>{if(V==null)return;const t=navigator.getGamepads()[V];t.buttons[9].value>=.5&&e-300>=Ce&&(vt(),Ce=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?$=!h&&B:$=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?j=!h&&B:j=!1,t.buttons[12].pressed?d.forwardController=!h&&w:d.forwardController=!1,t.buttons[13].pressed?d.backwardController=!h&&w:d.backwardController=!1,t.buttons[14].pressed?d.leftController=!h&&w:d.leftController=!1,t.buttons[15].pressed?d.rightController=!h&&w:d.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},Ns=()=>{window.addEventListener("gamepadconnected",e=>{V=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{V=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":vt();break;case" ":$=!h&&B;break;case"Shift":j=!h&&B;break;case"ArrowUp":case"w":case"W":d.forward=!h&&w;break;case"ArrowDown":case"s":case"S":d.backward=!h&&w;break;case"ArrowLeft":case"a":case"A":d.left=!h&&w;break;case"ArrowRight":case"d":case"D":d.right=!h&&w;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":$=!1;break;case"Shift":j=!1;break;case"ArrowUp":case"w":case"W":d.forward=!1;break;case"ArrowDown":case"s":case"S":d.backward=!1;break;case"ArrowLeft":case"a":case"A":d.left=!1;break;case"ArrowRight":case"d":case"D":d.right=!1;break}}),document.addEventListener("mousemove",e=>{if(h||i==null)return;const t=e.clientX-f.getBoundingClientRect().left,s=e.clientY-f.getBoundingClientRect().top,n=t-i.position.x,o=s-i.position.y;i.rotation=Math.atan2(o,n)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(h=!0,ct())})};let p=performance.now();const pt=()=>{for(p=performance.now(),Ws(p);De+te/2<=p;)h||(qs(te),++me),De+=te;if(ae+ut/2<=p&&(h||(Qt(),++ue),ae=p),p-xe>=1e3){const e=y.length+C.length+U.length+(i?1:0);Ss(e,ue,me),ue=0,me=0,xe=p}ke=requestAnimationFrame(pt)},Gs=()=>{if($&&p-Re>=Cs&&i){const e=i.rotation+(Math.random()-.5)*.1,t=Ue%2===0?-1:1,s=de(i.rotation+Math.PI/2*t);s.x*=10,s.y*=10,s.x+=i.position.x,s.y+=i.position.y,xt(s,e,de(e),0,!0),at(),Ue++,Re=p}if(j&&p-Oe>=Us&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(ne,y.length);t++){let s;do s=y[Math.floor(Math.random()*y.length)];while(e.includes(s));s.frozen=!0,s.velocity.x=0,s.velocity.y=0,e.push(s)}e.push(i),Js({...i.position},i.rotation,io(de(i.rotation),.2),0,e),Oe=p}if(p-_e>=be){const e=Se(),t=go(),s=Math.random()*Math.PI*2,n={x:t.x-e.x,y:t.y-e.y},o=Math.sqrt(n.x**2+n.y**2);o>0&&(n.x/=o,n.y/=o),n.x*=Math.random()*.1+.1,n.y*=Math.random()*.1+.1,F&&(n.x*=2,n.y*=2);const a=fe(.005),c=fo(u.timePlayed),l=F?xo():wo();zs(e,s,{x:0,y:0},n,a,c,l),_e=p,be=Fs(u.timePlayed)}if(p-He>=_s){const e=Se(),t={x:f.width/2+(Math.random()-.5)*400,y:f.height/2+(Math.random()-.5)*400},s={x:t.x-e.x,y:t.y-e.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=.1,s.y*=.1;const o=fe(.005),a=yo();Ys(a,e,0,s,o),He=p}if(i){if(V!=null){const e=navigator.getGamepads()[V];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let s=e.axes[0];Math.abs(e.axes[0])<=.01?s=0:e.axes[0]>=.7?s=1:e.axes[0]<=-.7&&(s=-1),i.force.y+=.004*t,i.force.x+=.004*s}i.force.x==0&&i.force.y==0&&((d.forward||d.forwardController)&&(i.force.y-=.004),(d.backward||d.backwardController)&&(i.force.y+=.004),(d.left||d.leftController)&&(i.force.x-=.004),(d.right||d.rightController)&&(i.force.x+=.004))}},he=e=>e.x<-100||e.x>f.width+100||e.y<-100||e.y>f.height+100,We=()=>{i.hp-=1,Co(),i.hp>=0&&Me(i.hp),i.hp<=0&&(ye(),Ks(),le(0),M(X,{position:{...i.position},frame:0}),setTimeout(()=>{ea()},1e3))},qs=e=>{Gs(),u.timePlayed+=e;for(const o of y){if(o.type==="homing"){const a=Math.sqrt(o.velocity.x**2+o.velocity.y**2);let c=i.position.x-o.position.x,l=i.position.y-o.position.y;const m=Math.sqrt(c**2+l**2);m>0&&(c/=m,l/=m),c*=a,l*=a,o.velocity.x=c,o.velocity.y=l}Q(o,e),he(o.position)&&(o.remove=!0);for(const a of y)o!==a&&W(o,a,1,!0)&&Do();if(o.type==="turret"&&!o.frozen){const a=o.bulletIndex%5===0?Fe*50:Fe;if(p-o.lastBulletTime>=a){const c={x:i.position.x-o.position.x,y:i.position.y-o.position.y},l=Math.sqrt(c.x**2+c.y**2);l>0&&(c.x/=l*2,c.y/=l*2);const m={x:o.position.x,y:o.position.y};xt(m,lo(c),c,0,!1),at(),o.lastBulletTime=p,o.bulletIndex++}}}for(const o of C)if(Q(o,e),he(o.position)&&(o.remove=!0),!o.disabled){if(o.friendly)for(const a of y)a.type==="armored"?W(o,a,1,!1)&&(u.bulletsHit++,o.velocity.x*=.1,o.velocity.y*=.1,o.angularVelocity=fe(.02),o.disabled=!0,Ro(),setTimeout(()=>{o.remove=!0},300)):W(o,a,1,!1)&&(u.bulletsHit++,u.damageDealt+=Math.min(a.hp,N),a.hp-=N,a.hp<=0&&(++u.asteroidsDestroyed,a.remove=!0,ye()),o.remove=!0,Uo());else if(W(o,i,1,!1)&&(We(),o.remove=!0,i.hp<=0))break}for(const o of U)o.progress+=e/1e3*ht,ho(o,o.progress,a=>{a.remove=!0,++u.asteroidsDestroyed,u.damageDealt+=a.hp,ye()});for(const o of G)if(Q(o,e),he(o.position)&&(o.remove=!0),pe(o,i))switch(o.remove=!0,Fo(),o.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,5),Me(i.hp);break;case"damage":N+=1,Is(N);break;case"rocket-piercing":ne+=1,Ps(ne);break}const t={...i.position};Q(i,e);const s={x:i.position.x-t.x,y:i.position.y-t.y},n=Math.sqrt(s.x**2+s.y**2);u.distanceTraveled+=n,le(Math.min(n/100,.05));for(const o of y)if(W(i,o,1,!0)&&(We(),i.hp<=0))break;if(V==null)!d.forward&&!d.backward&&!d.left&&!d.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const o=navigator.getGamepads()[V];Math.abs(o.axes[0])<.01&&Math.abs(o.axes[1])<.01&&!d.forward&&!d.backward&&!d.left&&!d.right&&!d.forwardController&&!d.backwardController&&!d.leftController&&!d.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>f.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,f.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>f.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,f.height)),i.velocity.y*=-1),$s()},$s=()=>{y.forEach(e=>{e.remove&&(v(J,e.id),e.frame=0,M(X,e))}),C.forEach(e=>{e.remove&&v(T,e.id)}),U.forEach(e=>{e.remove&&(v(P,e.id),e.children.forEach(t=>{v(_,t.id)}))}),G.forEach(e=>{e.remove&&v(re,e.id)}),y=y.filter(e=>!e.remove),C=C.filter(e=>!e.remove),U=U.filter(e=>!e.remove),G=G.filter(e=>!e.remove)},gt=new Image;gt.src=Oo;const ft=new Image;ft.src=_o;const yt=new Image;yt.src=Ho;const wt=new Image;wt.src=Wo;const js={default:gt,homing:ft,armored:yt,turret:wt},zs=(e,t,s,n,o,a,c)=>{const l=R();if(l.position=e,l.rotation=t,l.acceleration=s,l.velocity=n,l.angularVelocity=o,l.mass=As(a,c),l.radius=c==="armored"?a*2:a,l.inertia=2/5*l.mass*a**2,l.hp=a/2,l.texture=js[c],l.type=c,c==="turret"&&(l.lastBulletTime=p,l.bulletIndex=0),!pe(l,i)){for(const m of y)if(pe(l,m))return;M(J,l),y.push(l)}},xt=(e,t,s,n,o)=>{const a=R();a.position=e,a.rotation=t,a.velocity=s,a.angularVelocity=n,a.mass=dt,a.radius=5,a.inertia=2/5*a.mass*a.radius**2,a.friendly=o,M(T,a),C.push(a),++u.bulletsFired},Js=(e,t,s,n,o)=>{const a=R();a.position=e,a.rotation=t,a.velocity=s,a.angularVelocity=n,a.mass=dt,a.radius=5,a.targets=o,a.progress=0,a.currentTarget=0,mo(a),po(a),M(P,a),U.push(a),bt({x:-5,y:0},Math.PI/2,a),++u.rocketsFired},Xs=(e,t,s,n)=>{i=R(),i.position=e,i.rotation=t,i.velocity=s,i.angularVelocity=n,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const o=new Image;o.src=No,i.texture=o,M(Y,i),Ne({x:-5,y:18},0,O,qo,i),Ne({x:-5,y:-18},0,O,Go,i)},Ne=(e,t,s,n,o)=>{const a=R();a.position=e,a.rotation=t,a.parent=o,a.height=20,a.width=20,M(s,a);const c=new Image;c.src=n,a.texture=c,o.children??(o.children=o.children||[]),o.children.push(a),bt({x:-5,y:0},Math.PI/2,a)},bt=(e,t,s)=>{const n=R();n.position=e,n.rotation=t,n.parent=s,n.height=10,n.width=5,s.children??(s.children=s.children||[]),s.children.push(n),M(_,n)},Ys=(e,t,s,n,o)=>{const a=R();a.type=e,a.position=t,a.rotation=s,a.velocity=n,a.angularVelocity=o,a.radius=25,M(re,a),G.push(a)},vt=()=>{h=!h,h?(ct(),le(0)):se()},Ks=()=>{if(i){v(Y,i.id);for(let e of i.children){v(O,e.id);for(let t of e.children)v(_,t.id)}}},Qs=()=>{f.width=f.clientWidth,f.height=f.clientHeight,Xs({x:f.width/2,y:f.height/2},0,{x:0,y:0},0)},Zs=()=>{Qs(),mt(),ke=requestAnimationFrame(pt)},ea=()=>{if(h)return;h=!0,cancelAnimationFrame(ke),le(0),i=null;const e=ot(!B,!w,F);Ts(B,w,F,u,e),Es(),vo(!B,!w,F)},ta=()=>{Mo(),Kt(),y=[],C=[],U=[],be=1e3,ne=3,N=1,Me(5),se(),we()};Hs();
