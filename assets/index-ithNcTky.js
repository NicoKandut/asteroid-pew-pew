(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();let S=new Map;const lt=2e3,W=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const a=W(o),s=Math.cos(a.rotation),n=Math.sin(a.rotation);return{x:a.x+t.x*s-t.y*n,y:a.y+t.x*n+t.y*s,rotation:a.rotation+t.rotation}},dt=(e,t)=>{S[e]||(S[e]=[]);const o=performance.now();S[e].push({x:t.x,y:t.y,time:o}),S[e]=S[e].filter(a=>o-a.time<lt)},mt=e=>{delete S[e]},ut=e=>{for(const t in S){const o=S[t];if(!(!o||o.length<2)){e.beginPath();for(let a=0;a<o.length;a++){const s=o[a];a===0?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},ht="/asteroid-pew-pew/img/boom/boom_0.gif",pt="/asteroid-pew-pew/img/boom/boom_1.gif",gt="/asteroid-pew-pew/img/boom/boom_2.gif",ft="/asteroid-pew-pew/img/boom/boom_3.gif",yt="/asteroid-pew-pew/img/boom/boom_4.gif",wt="/asteroid-pew-pew/img/boom/boom_5.gif",xt="/asteroid-pew-pew/img/boom/boom_6.gif",bt="/asteroid-pew-pew/img/boom/boom_7.gif",vt="/asteroid-pew-pew/img/boom/boom_8.gif",Mt="/asteroid-pew-pew/img/boom/boom_9.gif",kt="/asteroid-pew-pew/img/boom/boom_10.gif",Et="/asteroid-pew-pew/img/boom/boom_11.gif",Tt="/asteroid-pew-pew/img/boom/boom_12.gif",Pt="/asteroid-pew-pew/img/boom/boom_13.gif",St="/asteroid-pew-pew/img/boom/boom_14.gif",It="/asteroid-pew-pew/img/ice.png",Lt="/asteroid-pew-pew/img/powerup.png",B=document.getElementsByTagName("canvas")[0],r=B.getContext("2d"),H="asteroid",k="bullet",$="explosion",K="flash",E="rocket",q="spaceship",_e="velocity",F="spaceshippart",O="flames",te="powerup",At="#ffffff",Bt="#ffff00",X="#ff0000",ve="#00ff00";let Dt=0;const Vt=()=>`${Dt++}`,T={[H]:{color:At},[k]:{color:Bt,length:10,strokeWidth:2},[E]:{color:X,radius:10},[q]:{color:ve},[_e]:{color:X},[F]:{color:ve},[O]:{color:X}},I={[O]:{},[q]:{},[F]:{},[H]:{},[k]:{},[E]:{},[$]:{},[K]:{},[te]:{}};let Ce=!1,G=!1,Ne=!1,We=!1;const Ut=e=>{Ce=e},Rt=e=>{G=e},Ft=e=>{Ne=e},Ot=e=>{We=e},b=(e,t)=>{t.id=Vt(),I[e][t.id]=t},x=(e,t)=>{delete I[e][t],mt(t)},_t=()=>{for(const e in I)I[e]={}},u=[];for(let e=0;e<15;++e)u.push(new Image);u[0].src=ht;u[1].src=pt;u[2].src=gt;u[3].src=ft;u[4].src=yt;u[5].src=wt;u[6].src=xt;u[7].src=bt;u[8].src=vt;u[9].src=Mt;u[10].src=kt;u[11].src=Et;u[12].src=Tt;u[13].src=Pt;u[14].src=St;const He=new Image;He.src=It;const Ct=()=>{B.width=B.clientWidth,B.height=B.clientHeight,r.clearRect(0,0,B.width,B.height);for(const e in I)for(const t of Object.values(I[e])){switch(e){case H:Nt(t);break;case $:$t(t);break;case k:Wt(t);break;case E:Ht(t);break;case q:case F:qt(t);break;case O:Gt(t);break;case K:jt(t);break;case te:zt(t);break}dt(t.id,W(t))}if(Ce){r.strokeStyle=T[_e].color,r.lineWidth=1,r.beginPath();for(const e in I){for(const t of Object.values(I[e]))if("velocity"in t){const{position:o,velocity:a}=t,{x:s,y:n}=o,{x:c,y:l}=a;r.moveTo(s,n),r.lineTo(s+c*200,n+l*200)}r.stroke()}}Ne&&ut(r)},Nt=e=>{const{radius:t,texture:o}=e,a=W(e);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.drawImage(o,-t,-t,t*2,t*2),G&&(r.strokeStyle=X,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(He,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore()},Wt=e=>{var s;const{length:t}=T[k],o=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;r.fillStyle=T[k].color,r.strokeStyle=T[k].color,r.lineWidth=(s=T[k])==null?void 0:s.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+a),r.lineTo(e.position.x-o,e.position.y-a),r.stroke()},Ht=e=>{var c;const{radius:t}=T[E],o=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},s={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},n={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=T[E].color,r.strokeStyle=T[E].color,r.lineWidth=((c=T[E])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(a.x,a.y),r.lineTo(s.x,s.y),r.lineTo(n.x,n.y),r.lineTo(a.x,a.y),r.stroke(),We){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},$t=e=>{r.translate(e.position.x,e.position.y);const a=u[e.frame];r.drawImage(a,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<u.length-1?e.frame++:x($,e.id)},qt=e=>{const{width:t,height:o,texture:a}=e,s=W(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(a,-t/2,-o/2,t,o),G&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},Gt=e=>{var A,se,_;const{width:t,height:o}=e,a=W(e),s=((A=e==null?void 0:e.parent)==null?void 0:A.velocity)??{x:0,y:1},n=((_=(se=e==null?void 0:e.parent)==null?void 0:se.parent)==null?void 0:_.velocity)??{x:0,y:0},c={x:s.x+n.x,y:s.y+n.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.beginPath();const m=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+m)*l),r.lineTo(t,(o+m)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+m)*l),r.lineTo(t/2,(o/2+m)*l),r.closePath(),r.fillStyle="yellow",r.fill(),G&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+m)),r.restore()},jt=e=>{const t=e.position,o=e.rotation,a=3,s=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(a,a),r.lineTo(s,0),r.lineTo(a,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,a),r.lineTo(0,s),r.resetTransform(),r.closePath(),r.fill()},$e=new Image;$e.src=Lt;const zt=e=>{const{radius:t}=e,o=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage($e,-t,-t,o,o),G&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,o,o)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸ’š",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.fillStyle="blue",r.textAlign="center",r.font="20px Arial",r.fillText("ðŸš€",0,7);break}r.restore()},U=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),j=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},qe=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),de=(e,t)=>qe(e,t)<e.radius+t.radius,ae=(e,t,o,a)=>{const s=qe(e,t);if(s>=e.radius+t.radius)return!1;const n={x:(t.position.x-e.position.x)/s,y:(t.position.y-e.position.y)/s},c=2*(e.velocity.x*n.x+e.velocity.y*n.y-t.velocity.x*n.x-t.velocity.y*n.y)/(e.mass+t.mass),l=e.radius+t.radius-s;a&&(e.position.x-=n.x*l,e.position.y-=n.y*l,t.position.x+=n.x*l,t.position.y+=n.y*l),e.frozen||(e.velocity.x-=c*o*t.mass*n.x,e.velocity.y-=c*o*t.mass*n.y),t.frozen||(t.velocity.x+=c*o*e.mass*n.x,t.velocity.y+=c*o*e.mass*n.y);const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return b(K,m),setTimeout(()=>x(K,m.id),100),!0},me=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Jt=(e,t)=>{e.x*=t,e.y*=t},ne=e=>({x:Math.cos(e),y:Math.sin(e)}),Me=e=>Math.sqrt(e.x**2+e.y**2),ke=10,Xt=30,Ee=(e,t,o,a,s)=>.5*(2*o+(-t+a)*e+(2*t-5*o+4*a-s)*e*e+(-t+3*o-3*a+s)*e*e*e),Ge=(e,t,o,a,s)=>({x:Ee(e,t.x,o.x,a.x,s.x),y:Ee(e,t.y,o.y,a.y,s.y)}),je=(e,t)=>{const o=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return Ge(t%1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position)},ze=(e,t)=>je(e,Je(e,t)),Yt=e=>{e.arcLengthTable=[];let t=0,o=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*ke;++c){const l=c/ke,m=je(e,l),A=Me(me(m,o));t+=A,e.arcLengthTable.push({v:l,totalLength:t}),o=m}const a=e.targets.length-4,s=Ge(1,e.targets[a+0].position,e.targets[a+1].position,e.targets[a+2].position,e.targets[a+3].position),n=Me(me(s,o));t+=n,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},Kt=e=>-(Math.cos(Math.PI*e)-1)/2,Je=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const A=m.totalLength-l.totalLength;if(A===0){o=m.v;break}const _=(t-l.totalLength)/A;o=l.v*(1-_)+m.v*_;break}}const a=Math.floor(o),s=o-a,n=Kt(s);return a+n},Qt=(e,t,o)=>{const a=ze(e,t);e.velocity=me(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const s=Math.max(Math.min(Math.floor(Je(e,t)),e.targets.length-3),0);if(s!==e.currentTarget&&(o(e.targets[s+1]),e.currentTarget=s),s>=e.targets.length-3){e.remove=!0;return}},Zt=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=Xt)e.pathPoints.push(ze(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},P=document.getElementsByTagName("canvas")[0],eo=()=>({x:Math.random()*P.width,y:Math.random()*P.height}),Te=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*P.width,y:-90};case 1:return{x:P.width+t,y:Math.random()*P.height};case 2:return{x:Math.random()*P.width,y:P.height+t};case 3:return{x:-90,y:Math.random()*P.height}}},Pe=e=>(Math.random()*2-1)*e,to=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},oo=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],o=Math.random();for(let a=0;a<e.length;a++)if(o<t[a])return e[a];return e[e.length-1]},v={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},so=JSON.stringify(v),Xe=(e,t)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default"),Ye=(e,t)=>{const o=Xe(e,t);return JSON.parse(localStorage.getItem(o)||so)},d={...v},ao=(e,t)=>{const o=Ye(e,t);o.timePlayed=Math.max(o.timePlayed,d.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,d.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,d.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,d.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,d.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,d.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,d.distanceTraveled),localStorage.setItem(Xe(e,t),JSON.stringify(o))},no=()=>{d.timePlayed=v.timePlayed,d.asteroidsDestroyed=v.asteroidsDestroyed,d.damageDealt=v.damageDealt,d.bulletsFired=v.bulletsFired,d.bulletsHit=v.bulletsHit,d.rocketsFired=v.rocketsFired,d.distanceTraveled=v.distanceTraveled},ro="/asteroid-pew-pew/audio/propulsion.mp3",io="/asteroid-pew-pew/audio/explosion.wav",co="/asteroid-pew-pew/audio/shoot.wav",lo="/asteroid-pew-pew/audio/hurt.wav",Ke="/asteroid-pew-pew/audio/hit.wav",mo="/asteroid-pew-pew/audio/click.wav",uo="/asteroid-pew-pew/audio/submit.wav",ho="/asteroid-pew-pew/audio/powerup.wav",po="/asteroid-pew-pew/audio/CODEX_2015.mp3";let w=.5;const go=e=>{xe.volume=.05*e,w=e},oe=new Audio(ro);oe.volume=0;oe.loop=!0;document.addEventListener("keydown",()=>oe.play().catch(()=>{}),{once:!0});const Q=e=>{oe.volume=e*w},N=()=>{const e=new Audio(uo);e.volume=.5*w,e.play().catch(()=>{})},M=()=>{const e=new Audio(mo);e.volume=.5*w,e.play().catch(()=>{})},fo=()=>{const e=new Audio(Ke);e.volume=.1*w,e.play().catch(()=>{})},yo=()=>{const e=new Audio(lo);e.volume=.3*w,e.play().catch(()=>{})},wo=()=>{const e=new Audio(co);e.volume=.1*w,e.play().catch(()=>{})},xo=()=>{const e=new Audio(Ke);e.volume=.2*w,e.play().catch(()=>{})},re=()=>{const e=new Audio(io);e.volume=.3*w,e.play().catch(()=>{})},bo=()=>{const e=new Audio(ho);e.volume=.2*w,e.play().catch(()=>{})},xe=new Audio(po);xe.volume=.05*w;xe.loop=!0;const vo="/asteroid-pew-pew/img/Asteroid1.png",Mo="/asteroid-pew-pew/img/Spaceship.png",ko="/asteroid-pew-pew/img/WingLeft.png",Eo="/asteroid-pew-pew/img/WingRight.png";let To=document.getElementById("entity-count"),Po=document.getElementById("fps"),So=document.getElementById("ups"),Io=document.getElementById("target-fps"),Lo=document.getElementById("target-ups"),Qe=document.getElementById("pause-menu");const Ze=document.getElementById("main-menu"),Ao=document.getElementById("pause-resume"),Bo=document.getElementById("debug-velocity"),Do=document.getElementById("debug-hitbox"),Vo=document.getElementById("debug-trajectory"),Uo=document.getElementById("debug-spline-paths"),Ro=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const Fo=document.getElementById("rocket-piercing"),Oo=document.getElementById("bullet-damage"),Se=document.getElementById("hp"),et=document.getElementById("game-over"),_o=document.getElementById("time-played"),Co=document.getElementById("asteroids-destroyed"),No=document.getElementById("distance-traveled"),Wo=document.getElementById("damage-dealt"),Ho=document.getElementById("start"),$o=document.getElementById("restart"),qo=document.getElementById("volume"),Go=document.getElementById("mode-pacifist"),jo=document.getElementById("mode-stationary"),zo=document.getElementById("mark-pacifist"),Jo=document.getElementById("mark-stationary"),Xo=document.getElementById("back-to-main-menu"),Yo=document.getElementById("pause-back-to-main-menu"),Ie=document.getElementById("controls-move"),Le=document.getElementById("controls-bullet"),Ae=document.getElementById("controls-rocket"),Ko=(e,t,o,a,s,n,c,l,m)=>{Qo(e,m,t,o),es(a,s,n,c,l),os(e,m)},Qo=(e,t,o,a)=>{Ho.addEventListener("click",()=>{N(),Zo(),t(),e()}),Go.addEventListener("change",s=>{M(),o(!s.target.checked),s.target.checked?(Le.setAttribute("disabled","true"),Ae.setAttribute("disabled","true")):(Le.removeAttribute("disabled"),Ae.removeAttribute("disabled"))}),jo.addEventListener("change",s=>{M(),a(!s.target.checked),s.target.checked?Ie.setAttribute("disabled","true"):Ie.removeAttribute("disabled")})},tt=()=>{Ze.style.display="grid"},Zo=()=>{Ze.style.display="none"},es=(e,t,o,a,s)=>{qo.addEventListener("input",n=>{e(n.target.value/100)}),Io.addEventListener("change",n=>{M(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),t(1e3/n.target.value)}),Lo.addEventListener("change",n=>{M(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),o(1e3/n.target.value)}),Bo.addEventListener("change",n=>{M(),Ut(n.target.checked)}),Do.addEventListener("change",n=>{M(),Rt(n.target.checked)}),Vo.addEventListener("change",n=>{M(),Ft(n.target.checked)}),Uo.addEventListener("change",n=>{M(),Ot(n.target.checked)}),Ro.addEventListener("change",n=>{M(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),a(n.target.value)}),Ao.addEventListener("click",()=>{N(),Z(),s()}),Yo.addEventListener("click",()=>{N(),Z(),tt()})},ts=()=>{Qe.style.display="flex"},Z=()=>{Qe.style.display="none"},os=(e,t)=>{$o.addEventListener("click",()=>{N(),ue(),t(),e()}),Xo.addEventListener("click",()=>{N(),ue(),tt()})},ss=()=>{et.style.display="grid"},ue=()=>{et.style.display="none"},as=(e,t,o,a)=>{zo.style.display=e?"none":"block",Jo.style.display=t?"none":"block",z(_o,o.timePlayed/1e3,a.timePlayed/1e3,"s",1),z(Co,o.asteroidsDestroyed,a.asteroidsDestroyed),z(No,o.distanceTraveled,a.distanceTraveled,"m",1),z(Wo,o.damageDealt,a.damageDealt,"hp",0)},z=(e,t,o,a,s)=>{e.children.item(1).innerText=a?`${t.toFixed(s)} ${a}`:`${t.toFixed(s)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${o.toFixed(s)} ${a}`:o.toFixed(s)} )`)},ns=e=>{Fo.innerText=`${e}`},rs=e=>{Oo.innerText=e.toFixed(1)},he=e=>{for(let t=0;t<Se.children.length;t++)Se.children.item(t).style.color=t<e?"red":"grey"},is=(e,t,o)=>{To.innerText=`${e}`,Po.innerText=`${t}`,So.innerText=`${o}`};let p=document.getElementsByTagName("canvas")[0];const ot=2e3,cs=e=>4/3*Math.PI*e**3*3.5;let g=!0;const st=()=>g=!1;let be,Y=1e3/120;const ls=e=>Y=e;let at=1e3/60;const ds=e=>at=e;let ee=0,Be=0,pe=0,R=!0;const ms=e=>R=e;let L=!0;const us=e=>L=e;let ie=0,ce=0,y=[],D=[],V=[],i=null,C=[],J=1,De=0,ge=!1,Ve=0,hs=40,fe=3,ye=!1,ps=3e3,Ue=0,nt=300;const gs=e=>nt=e;let we=1e3,Re=0;const fs=e=>Math.pow(.99,e/1e3)*1e3;let ys=1e4,Fe=0,h={forward:!1,backward:!1,left:!1,right:!1};const ws=()=>{ee=performance.now(),pe=ee,xs(),Ko(Bs,ms,us,go,ds,ls,gs,st,Vs)},xs=()=>{document.addEventListener("keydown",e=>{switch(e.key){case"Escape":Is();break;case" ":ge=!g&&R;break;case"Shift":ye=!g&&R;break;case"ArrowUp":case"w":case"W":h.forward=!g&&L;break;case"ArrowDown":case"s":case"S":h.backward=!g&&L;break;case"ArrowLeft":case"a":case"A":h.left=!g&&L;break;case"ArrowRight":case"d":case"D":h.right=!g&&L;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":ge=!1;break;case"Shift":ye=!1;break;case"ArrowUp":case"w":case"W":h.forward=!1;break;case"ArrowDown":case"s":case"S":h.backward=!1;break;case"ArrowLeft":case"a":case"A":h.left=!1;break;case"ArrowRight":case"d":case"D":h.right=!1;break}}),document.addEventListener("mousemove",e=>{if(g||i==null)return;const t=e.clientX-p.getBoundingClientRect().left,o=e.clientY-p.getBoundingClientRect().top,a=t-i.position.x,s=o-i.position.y;i.rotation=Math.atan2(s,a)})};let f=performance.now();const rt=()=>{for(f=performance.now();Be+Y/2<=f;)g||(vs(Y),++ie),Be+=Y;if(ee+at/2<=f&&(g||(Ct(),++ce),ee=f),f-pe>=1e3){const e=y.length+D.length+V.length+(i?1:0);is(e,ce,ie),ce=0,ie=0,pe=f}be=requestAnimationFrame(rt)},bs=()=>{if(ge&&f-Ve>=hs&&i){const e=i.rotation+(Math.random()-.5)*.1,t=De%2===0?-1:1,o=ne(i.rotation+Math.PI/2*t);o.x*=10,o.y*=10,o.x+=i.position.x,o.y+=i.position.y,Es(o,e,ne(e),0),wo(),De++,Ve=f}if(ye&&f-Ue>=ps&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(fe,y.length);t++){let o;do o=y[Math.floor(Math.random()*y.length)];while(e.includes(o));o.frozen=!0,o.velocity.x=0,o.velocity.y=0,e.push(o)}e.push(i),Ts({...i.position},i.rotation,Jt(ne(i.rotation),.2),0,e),Ue=f}if(f-Re>=we){const e=Te(),t=eo(),o=Math.random()*Math.PI*2,a={x:t.x-e.x,y:t.y-e.y},s=Math.sqrt(a.x**2+a.y**2);s>0&&(a.x/=s,a.y/=s),a.x*=Math.random()*.1+.1,a.y*=Math.random()*.1+.1;const n=Pe(.005),c=to(d.timePlayed);ks(e,o,{x:0,y:0},a,n,c),Re=f,we=fs(d.timePlayed)}if(f-Fe>=ys){const e=Te(),t={x:p.width/2+(Math.random()-.5)*400,y:p.height/2+(Math.random()-.5)*400},o={x:t.x-e.x,y:t.y-e.y},a=Math.sqrt(o.x**2+o.y**2);a>0&&(o.x/=a,o.y/=a),o.x*=.1,o.y*=.1;const s=Pe(.005),n=oo();Ss(n,e,0,o,s),Fe=f}i&&(h.forward&&(i.force.y-=.004),h.backward&&(i.force.y+=.004),h.left&&(i.force.x-=.004),h.right&&(i.force.x+=.004))},le=e=>e.x<-100||e.x>p.width+100||e.y<-100||e.y>p.height+100,vs=e=>{bs(),d.timePlayed+=e;for(const s of y){j(s,e),le(s.position)&&(s.remove=!0);for(const n of y)s!==n&&ae(s,n,1,!0)&&fo()}for(const s of D){j(s,e),le(s.position)&&(s.remove=!0);for(const n of y)ae(s,n,1,!1)&&(d.bulletsHit++,d.damageDealt+=Math.min(n.hp,J),n.hp-=J,s.remove=!0,xo(),n.hp<=0&&(++d.asteroidsDestroyed,n.remove=!0,re()))}for(const s of V)s.progress+=e/1e3*nt,Qt(s,s.progress,n=>{n.remove=!0,++d.asteroidsDestroyed,d.damageDealt+=n.hp,re()});for(const s of C)if(j(s,e),le(s.position)&&(s.remove=!0),de(s,i))switch(s.remove=!0,bo(),s.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,5),he(i.hp);break;case"damage":J+=1,rs(J);break;case"rocket-piercing":fe+=1,ns(fe);break}const t={...i.position};j(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},a=Math.sqrt(o.x**2+o.y**2);d.distanceTraveled+=a,Q(Math.min(a/100,.05));for(const s of y)if(ae(i,s,1,!0)&&(i.hp-=1,yo(),i.hp>=0&&he(i.hp),i.hp<=0)){re(),Ls(),Q(0),b($,{position:{...i.position},frame:0}),setTimeout(()=>{Ds()},1e3);break}!h.forward&&!h.backward&&!h.left&&!h.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3)),(i.position.x<0||i.position.x>p.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,p.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>p.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,p.height)),i.velocity.y*=-1),Ms()},Ms=()=>{y.forEach(e=>{e.remove&&(x(H,e.id),e.frame=0,b($,e))}),D.forEach(e=>{e.remove&&x(k,e.id)}),V.forEach(e=>{e.remove&&(x(E,e.id),e.children.forEach(t=>{x(O,t.id)}))}),C.forEach(e=>{e.remove&&x(te,e.id)}),y=y.filter(e=>!e.remove),D=D.filter(e=>!e.remove),V=V.filter(e=>!e.remove),C=C.filter(e=>!e.remove)},it=new Image;it.src=vo;const ks=(e,t,o,a,s,n)=>{const c=U();if(c.position=e,c.rotation=t,c.acceleration=o,c.velocity=a,c.angularVelocity=s,c.mass=cs(n),c.radius=n,c.inertia=2/5*c.mass*n**2,c.hp=n/2,c.texture=it,!de(c,i)){for(const l of y)if(de(c,l))return;b(H,c),y.push(c)}},Es=(e,t,o,a)=>{const s=U();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=ot,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,b(k,s),D.push(s),++d.bulletsFired},Ts=(e,t,o,a,s)=>{const n=U();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=a,n.mass=ot,n.radius=5,n.targets=s,n.progress=0,n.currentTarget=0,Yt(n),Zt(n),b(E,n),V.push(n),ct({x:-5,y:0},Math.PI/2,n),++d.rocketsFired},Ps=(e,t,o,a)=>{i=U(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=a,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const s=new Image;s.src=Mo,i.texture=s,b(q,i),Oe({x:-5,y:18},0,F,Eo,i),Oe({x:-5,y:-18},0,F,ko,i)},Oe=(e,t,o,a,s)=>{const n=U();n.position=e,n.rotation=t,n.parent=s,n.height=20,n.width=20,b(o,n);const c=new Image;c.src=a,n.texture=c,s.children??(s.children=s.children||[]),s.children.push(n),ct({x:-5,y:0},Math.PI/2,n)},ct=(e,t,o)=>{const a=U();a.position=e,a.rotation=t,a.parent=o,a.height=10,a.width=5,o.children??(o.children=o.children||[]),o.children.push(a),b(O,a)},Ss=(e,t,o,a,s)=>{const n=U();n.type=e,n.position=t,n.rotation=o,n.velocity=a,n.angularVelocity=s,n.radius=25,b(te,n),C.push(n)},Is=()=>{g=!g,g?(ts(),Q(0)):Z()},Ls=()=>{if(i){x(q,i.id);for(let e of i.children){x(F,e.id);for(let t of e.children)x(O,t.id)}}},As=()=>{p.width=p.clientWidth,p.height=p.clientHeight,Ps({x:p.width/2,y:p.height/2},0,{x:0,y:0},0)},Bs=()=>{As(),st(),be=requestAnimationFrame(rt)},Ds=()=>{if(g)return;g=!0,cancelAnimationFrame(be),Q(0),i=null;const e=Ye(!R,!L);as(R,L,d,e),ss(),ao(!R,!L)},Vs=()=>{no(),_t(),y=[],D=[],V=[],we=1e3,he(5),Z(),ue()};ws();
