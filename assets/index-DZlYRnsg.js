(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();let q=new Map;const Kt=2e3,se=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const s=se(o),a=Math.cos(s.rotation),n=Math.sin(s.rotation);return{x:s.x+t.x*a-t.y*n,y:s.y+t.x*n+t.y*a,rotation:s.rotation+t.rotation}},Qt=(e,t)=>{q[e]||(q[e]=[]);const o=performance.now();q[e].push({x:t.x,y:t.y,time:o}),q[e]=q[e].filter(s=>o-s.time<Kt)},Zt=e=>{delete q[e]},eo=e=>{for(const t in q){const o=q[t];if(!(!o||o.length<2)){e.beginPath();for(let s=0;s<o.length;s++){const a=o[s];s===0?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},to="/asteroid-pew-pew/img/boom/boom_0.gif",oo="/asteroid-pew-pew/img/boom/boom_1.gif",so="/asteroid-pew-pew/img/boom/boom_2.gif",no="/asteroid-pew-pew/img/boom/boom_3.gif",ao="/asteroid-pew-pew/img/boom/boom_4.gif",ro="/asteroid-pew-pew/img/boom/boom_5.gif",io="/asteroid-pew-pew/img/boom/boom_6.gif",co="/asteroid-pew-pew/img/boom/boom_7.gif",lo="/asteroid-pew-pew/img/boom/boom_8.gif",mo="/asteroid-pew-pew/img/boom/boom_9.gif",uo="/asteroid-pew-pew/img/boom/boom_10.gif",ho="/asteroid-pew-pew/img/boom/boom_11.gif",go="/asteroid-pew-pew/img/boom/boom_12.gif",po="/asteroid-pew-pew/img/boom/boom_13.gif",fo="/asteroid-pew-pew/img/boom/boom_14.gif",yo="/asteroid-pew-pew/img/ice.png",xo="/asteroid-pew-pew/img/powerup.png",pt=5,Je=.7,N=2;function wo(e,t,o){e.fractureSeeds=bo(Mo(e,t),e.radius);const s=o?null:To(e);e.voronoiData=ko(e,s)}function bo(e,t){const o=[];for(let s=0;s<pt;s++){const a=Math.random()*2*Math.PI,n=Math.sqrt(Math.random())*t,c=Math.cos(a)*n,d=Math.sin(a)*n,l=Je*e.x,u=Je*e.y,p=l+c,m=u+d;p*p+m*m<=Math.pow(t,2)?o.push({x:p,y:m}):s--}return o}function vo(e,t){const{position:o,rotation:s,fractureSeeds:a}=t,n=Math.cos(s),c=Math.sin(s);e.fillStyle="red";for(const d of a){const l={x:o.x+d.x*n-d.y*c,y:o.y+d.x*c+d.y*n};e.beginPath(),e.arc(l.x,l.y,2,0,Math.PI*2),e.fill()}}function Mo(e,t){const o=t.position.x-e.position.x,s=t.position.y-e.position.y,a=Math.sin(-e.rotation),n=Math.cos(-e.rotation);return{x:o*n-s*a,y:o*a+s*n}}function ko(e,t=null){const{fractureSeeds:o,radius:s}=e,a=s*2,n=s*2,c=new Int16Array(a*n).fill(-1),d=document.createElement("canvas");d.width=a,d.height=n;const l=d.getContext("2d"),u=l.getImageData(0,0,a,n),p=u.data,m=a/2,M=n/2;for(let k=0;k<n;k++)for(let E=0;E<a;E++){const H=E-m,A=k-M;if(H*H+A*A>s*s)continue;let ee=1/0,ae=-1;for(let B=0;B<o.length;B++){const j=o[B];let Be=H-j.x,Ve=A-j.y;if(t){const Xe=t(E,k);Be+=(Xe-.5)*10,Ve+=(Xe-.5)*10}const je=Be*Be+Ve*Ve;je<ee&&(ee=je,ae=B)}c[k*a+E]=ae;const _=Math.sqrt(ee),w=Math.min(1,_/s),S=(k*a+E)*4,[O,De,Ye]=Eo(w);p[S]=O,p[S+1]=De,p[S+2]=Ye,p[S+3]=255}return l.putImageData(u,0,0),{heatMap:d,cellMap:c}}function Eo(e){if(e=Math.max(0,Math.min(1,e)),e<.33){const t=e/.33;return[255,Math.round(255*t),0]}else if(e<.66){const t=(e-.33)/.33;return[Math.round(255*(1-t)),255,0]}else{const t=(e-.66)/.34;return[0,Math.round(255*(1-t)),Math.round(255*t)]}}function To(e){const t=e.radius*2,o=e.radius*2,s=new Float32Array(o*t),a=Math.floor(o/N)+2,n=Math.floor(t/N)+2,c=[];for(let l=0;l<n*a;l++)c.push(Math.random());for(let l=0;l<t;l++)for(let u=0;u<o;u++){const p=Math.floor(u/N),m=Math.floor(l/N),M=u%N/N,k=l%N/N,E=m*a+p,H=c[E],A=c[E+1],ee=c[E+a],ae=c[E+a+1],_=H*(1-M)+A*M,w=ee*(1-M)+ae*M;s[l*o+u]=_*(1-k)+w*k}return(l,u)=>s[u*o+l]}function Io(e){const t=[],o=e.texture,s=e.voronoiData.cellMap,a=e.radius*2,n=e.radius*2;for(let c=0;c<pt;c++){let d=a,l=n,u=0,p=0;for(let w=0;w<s.length;w++){if(s[w]===-1||s[w]!==c)continue;const S=w%a,O=Math.floor(w/a);d=S<d?S:d,l=O<l?O:l,u=S>u?S:u,p=O>p?O:p}const m=u-d+1,M=p-l+1,k=document.createElement("canvas");k.width=m,k.height=M;const E=k.getContext("2d"),H=E.createImageData(m,M);let A=H.data;const _=o.getContext("2d").getImageData(0,0,a,n).data;for(let w=0;w<s.length;w++){if(s[w]!==c)continue;const S=w%a,O=Math.floor(w/a),De=S-d,B=((O-l)*m+De)*4,j=w*4;A[B]=_[j],A[B+1]=_[j+1],A[B+2]=_[j+2],A[B+3]=_[j+3]}E.putImageData(H,0,0),t.push(k)}return t}const X=document.getElementsByTagName("canvas")[0],r=X.getContext("2d"),de="asteroid",C="bullet",me="explosion",be="flash",F="rocket",ue="spaceship",ft="velocity",oe="spaceshippart",ne="flames",Pe="powerup",Se="flame_particles",Po="#ffffff",So="#ffff00",ye="#ff0000",Ke="#00ff00";let Lo=0;const Ao=()=>`${Lo++}`,R={[de]:{color:Po},[C]:{color:So,length:10,strokeWidth:2},[F]:{color:ye,radius:10},[ue]:{color:Ke},[ft]:{color:ye},[oe]:{color:Ke},[ne]:{color:ye},[Se]:{color:"blue"}},G={[ne]:{},[Se]:{},[ue]:{},[oe]:{},[de]:{},[C]:{},[F]:{},[me]:{},[be]:{},[Pe]:{}};let yt=!1,he=!1,xt=!1,wt=!1,bt=!1,vt=!1;const Do=e=>{yt=e},Bo=e=>{he=e},Vo=e=>{xt=e},Co=e=>{wt=e},Fo=e=>{bt=e},Ro=e=>{vt=e},L=(e,t)=>{t.id=Ao(),G[e][t.id]=t},D=(e,t)=>{delete G[e][t],Zt(t)},Uo=()=>{for(const e in G)G[e]={}},x=[];for(let e=0;e<15;++e)x.push(new Image);x[0].src=to;x[1].src=oo;x[2].src=so;x[3].src=no;x[4].src=ao;x[5].src=ro;x[6].src=io;x[7].src=co;x[8].src=lo;x[9].src=mo;x[10].src=uo;x[11].src=ho;x[12].src=go;x[13].src=po;x[14].src=fo;const Mt=new Image;Mt.src=yo;const Ho=()=>{X.width=X.clientWidth,X.height=X.clientHeight,r.clearRect(0,0,X.width,X.height);for(const e in G)for(const t of Object.values(G[e])){switch(e){case de:_o(t);break;case me:Wo(t);break;case C:Oo(t);break;case F:No(t);break;case ue:case oe:qo(t);break;case ne:Go(t);break;case Se:$o(t);case be:zo(t);break;case Pe:Yo(t);break}Qt(t.id,se(t))}if(yt){r.strokeStyle=R[ft].color,r.lineWidth=1,r.beginPath();for(const e in G){for(const t of Object.values(G[e])){if("velocity"in t){const{position:o,velocity:s}=t,{x:a,y:n}=o,{x:c,y:d}=s;r.moveTo(a,n),r.lineTo(a+c*200,n+d*100)}if("angularVelocity"in t){const{position:o,angularVelocity:s}=t,{x:a,y:n}=o;s>0?(r.moveTo(a+20,n),r.arc(a,n,20,0,s*300)):(r.moveTo(a+20*Math.cos(s*300),n+20*Math.sin(s*300)),r.arc(a,n,20,s*300,0))}}r.stroke()}}xt&&eo(r)},_o=e=>{const{width:t,height:o,radius:s,texture:a,textureReady:n,voronoiData:c}=e;if(!n)return;const d=se(e);r.save(),r.translate(d.x,d.y),r.rotate(d.rotation);const l=t!=0?t:s*2,u=o!=0?o:s*2,p=vt&&c?c.heatMap:a;r.drawImage(p,-s,-s,l,u),he&&(r.strokeStyle=ye,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,s,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(Mt,-s-10,-s-10,l+20,u+20),r.globalAlpha=1),r.restore(),bt&&vo(r,e)},Oo=e=>{var a;const{length:t}=R[C],o=Math.cos(e.rotation)*t/2,s=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?R[C].color:"red",r.strokeStyle=e.friendly?R[C].color:"red",r.lineWidth=(a=R[C])==null?void 0:a.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+s),r.lineTo(e.position.x-o,e.position.y-s),r.stroke()},No=e=>{var c;const{radius:t}=R[F],o=2*Math.PI/8,s={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},a={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},n={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=R[F].color,r.strokeStyle=R[F].color,r.lineWidth=((c=R[F])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(s.x,s.y),r.lineTo(a.x,a.y),r.lineTo(n.x,n.y),r.lineTo(s.x,s.y),r.stroke(),wt){for(const d of e.targets)r.moveTo(d.position.x,d.position.y),r.arc(d.position.x,d.position.y,4,0,2*Math.PI);r.fill(),r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const d of e.pathPoints)r.lineTo(d.x,d.y),r.arc(d.x,d.y,2,0,2*Math.PI),r.moveTo(d.x,d.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},Wo=e=>{r.translate(e.position.x,e.position.y);const s=x[e.frame];r.drawImage(s,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<x.length-1?e.frame++:D(me,e.id)},qo=e=>{const{width:t,height:o,texture:s,textureReady:a}=e;if(!a)return;const n=se(e);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.drawImage(s,-t/2,-o/2,t,o),he&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},Go=e=>{var u,p,m;const{width:t,height:o}=e,s=se(e),a=((u=e==null?void 0:e.parent)==null?void 0:u.velocity)??{x:0,y:1},n=((m=(p=e==null?void 0:e.parent)==null?void 0:p.parent)==null?void 0:m.velocity)??{x:0,y:0},c={x:a.x+n.x,y:a.y+n.y},d=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.beginPath();const l=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+l)*d),r.lineTo(t,(o+l)*d),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+l)*d),r.lineTo(t/2,(o/2+l)*d),r.closePath(),r.fillStyle="yellow",r.fill(),he&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+l)),r.restore()},$o=e=>{const{width:t,height:o}=e,s=se(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation);const a=5;for(let n=0;n<a;n++){const c=(Math.random()-.5)*t*2,d=Math.random()+o,l=1+Math.random()*2;r.globalAlpha=.2+Math.random()*.3,r.fillStyle="blue",r.beginPath(),r.arc(c,d,l,0,Math.PI*2),r.fill()}r.globalAlpha=1,r.restore()},zo=e=>{const t=e.position,o=e.rotation,s=3,a=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(s,s),r.lineTo(a,0),r.lineTo(s,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,s),r.lineTo(0,a),r.resetTransform(),r.closePath(),r.fill()},kt=new Image;kt.src=xo;const Yo=e=>{const{radius:t}=e,o=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(kt,-t,-t,o,o),he&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,o,o)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸ§¡",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸš€",0,7);break}r.restore()},Y=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null,fractureSeeds:[],textureReady:!1,voronoiData:null}),ge=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Et=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),_e=(e,t)=>Et(e,t)<e.radius+t.radius,te=(e,t,o,s)=>{const a=Et(e,t);if(a>=e.radius+t.radius)return!1;const n={x:(t.position.x-e.position.x)/a,y:(t.position.y-e.position.y)/a},c=2*(e.velocity.x*n.x+e.velocity.y*n.y-t.velocity.x*n.x-t.velocity.y*n.y)/(e.mass+t.mass),d=e.radius+t.radius-a;s&&(e.position.x-=n.x*d,e.position.y-=n.y*d,t.position.x+=n.x*d,t.position.y+=n.y*d),e.frozen||(e.velocity.x-=c*o*t.mass*n.x,e.velocity.y-=c*o*t.mass*n.y),t.frozen||(t.velocity.x+=c*o*e.mass*n.x,t.velocity.y+=c*o*e.mass*n.y);const l={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return L(be,l),setTimeout(()=>D(be,l.id),100),!0},Ce=e=>{const t=Math.sqrt(e.x**2+e.y**2);return{x:e.x/t,y:e.y/t}},ve=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),jo=(e,t)=>{e.x*=t,e.y*=t},Xo=(e,t,o)=>({x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}),Fe=e=>({x:Math.cos(e),y:Math.sin(e)}),Jo=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},Qe=e=>Math.sqrt(e.x**2+e.y**2),pe=100,Ko=10,Ze=(e,t,o,s,a)=>.5*(2*o+(-t+s)*e+(2*t-5*o+4*s-a)*e*e+(-t+3*o-3*s+a)*e*e*e),Tt=(e,t,o,s,a)=>({x:Ze(e,t.x,o.x,s.x,a.x),y:Ze(e,t.y,o.y,s.y,a.y)}),It=(e,t,o)=>Tt(o,e.targets[t+0].position,e.targets[t+1].position,e.targets[t+2].position,e.targets[t+3].position),Pt=(e,t)=>{const o=St(e,t),s=e.targets.length-3,a=o*s;let n=Math.floor(a),c=a-n;return n>=s&&(n-=1,c=1),It(e,n,c)},Qo=e=>{e.arcLengthTable=[];let t=0,o=0,s=e.targets[1].position;const a=e.targets.length-3;for(let l=0;l<a;++l)for(let u=0;u<pe;++u){const p=u/pe,m=It(e,l,p),M=Qe(ve(m,s));o+=M,e.arcLengthTable.push({v:t,totalLength:o}),s=m,t=(l*pe+u)/(pe*a)}const n=e.targets.length-4,c=Tt(1,e.targets[n+0].position,e.targets[n+1].position,e.targets[n+2].position,e.targets[n+3].position),d=Qe(ve(c,s));o+=d,e.arcLengthTable.push({v:1,totalLength:o})},Zo=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,St=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let s=1;s<e.arcLengthTable.length;++s){const a=e.arcLengthTable[s-1],n=e.arcLengthTable[s];if(t<n.totalLength){const c=n.totalLength-a.totalLength;if(c===0){o=n.v;break}const l=(t-a.totalLength)/c;o=a.v*(1-l)+n.v*l;break}}return Math.min(1,Math.max(0,Zo(o)))},es=(e,t,o)=>{const s=Pt(e,t);e.velocity=ve(s,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=s;const a=Math.max(Math.floor(St(e,t)*(e.targets.length-3)),0);if(a!==e.currentTarget&&(o(e.targets[a+1]),e.currentTarget=a),a>=e.targets.length-3){e.remove=!0;return}},ts=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=Ko)e.pathPoints.push(Pt(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},W=document.getElementsByTagName("canvas")[0];let Lt=!1;const os=e=>{Lt=e},At=()=>({x:Math.random()*W.width,y:Math.random()*W.height}),et=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*W.width,y:-90};case 1:return{x:W.width+t,y:Math.random()*W.height};case 2:return{x:Math.random()*W.width,y:W.height+t};case 3:return{x:-90,y:Math.random()*W.height}}},Me=e=>(Math.random()*2-1)*e,ss=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},ns=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],o=Math.random();for(let s=0;s<e.length;s++)if(o<t[s])return e[s];return e[e.length-1]},Dt=(e,t)=>{const o=Math.random();let s=0;for(let a=0;a<t.length;a++)if(s+=t[a],o<s)return e[a];return e[t.length-1]},as=()=>Lt?"split":Dt(["default","split","homing","armored","turret"],[.65,.2,.05,.05,.05]),rs=()=>Dt(["homing","armored","turret"],[.34,.33,.33]),V={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},is=JSON.stringify(V),Bt=(e,t,o,s)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(o?"-extreme":"-default")+(s?"-hitless":"-default"),Vt=(e,t,o,s)=>{const a=Bt(e,t,o,s);return JSON.parse(localStorage.getItem(a)||is)},g={...V},cs=(e,t,o,s)=>{const a=Vt(e,t,o,s);a.timePlayed=Math.max(a.timePlayed,g.timePlayed),a.asteroidsDestroyed=Math.max(a.asteroidsDestroyed,g.asteroidsDestroyed),a.damageDealt=Math.max(a.damageDealt,g.damageDealt),a.bulletsFired=Math.max(a.bulletsFired,g.bulletsFired),a.bulletsHit=Math.max(a.bulletsHit,g.bulletsHit),a.rocketsFired=Math.max(a.rocketsFired,g.rocketsFired),a.distanceTraveled=Math.max(a.distanceTraveled,g.distanceTraveled),localStorage.setItem(Bt(e,t,o),JSON.stringify(a))},ls=()=>{g.timePlayed=V.timePlayed,g.asteroidsDestroyed=V.asteroidsDestroyed,g.damageDealt=V.damageDealt,g.bulletsFired=V.bulletsFired,g.bulletsHit=V.bulletsHit,g.rocketsFired=V.rocketsFired,g.distanceTraveled=V.distanceTraveled},ds="/asteroid-pew-pew/audio/propulsion.mp3",ms="/asteroid-pew-pew/audio/explosion.wav",us="/asteroid-pew-pew/audio/shoot.wav",hs="/asteroid-pew-pew/audio/hurt.wav",Ct="/asteroid-pew-pew/audio/hit.wav",gs="/asteroid-pew-pew/audio/click.wav",ps="/asteroid-pew-pew/audio/submit.wav",fs="/asteroid-pew-pew/audio/powerup.wav",ys="/asteroid-pew-pew/audio/CODEX_2015.mp3",xs="/asteroid-pew-pew/audio/armorHit.wav";let P=.5;const ws=e=>{qe.volume=.05*e,P=e},Le=new Audio(ds);Le.volume=0;Le.loop=!0;document.addEventListener("keydown",()=>Le.play().catch(()=>{}),{once:!0});const Ae=e=>{Le.volume=e*P},ie=()=>{const e=new Audio(ps);e.volume=.5*P,e.play().catch(()=>{})},v=()=>{const e=new Audio(gs);e.volume=.5*P,e.play().catch(()=>{})},bs=()=>{const e=new Audio(Ct);e.volume=.1*P,e.play().catch(()=>{})},vs=()=>{const e=new Audio(hs);e.volume=.3*P,e.play().catch(()=>{})},Ft=()=>{const e=new Audio(us);e.volume=.1*P,e.play().catch(()=>{})},tt=()=>{const e=new Audio(Ct);e.volume=.2*P,e.play().catch(()=>{})},Ms=()=>{const e=new Audio(xs);e.volume=.2*P,e.play().catch(()=>{})},xe=()=>{const e=new Audio(ms);e.volume=.3*P,e.play().catch(()=>{})},ks=()=>{const e=new Audio(fs);e.volume=.2*P,e.play().catch(()=>{})},qe=new Audio(ys);qe.volume=.05*P;qe.loop=!0;const Es="/asteroid-pew-pew/img/Asteroid1.png",Ts="/asteroid-pew-pew/img/asteroid_split.png",Is="/asteroid-pew-pew/img/asteroid_red.png",Ps="/asteroid-pew-pew/img/asteroid_armored.png",Ss="/asteroid-pew-pew/img/asteroid_green.png",Ls="/asteroid-pew-pew/img/Spaceship.png",As="/asteroid-pew-pew/img/WingLeft.png",Ds="/asteroid-pew-pew/img/WingRight.png";let Bs=document.getElementById("entity-count"),Vs=document.getElementById("fps"),Cs=document.getElementById("ups"),Fs=document.getElementById("target-fps"),Rs=document.getElementById("target-ups"),Rt=document.getElementById("pause-menu");const Ut=document.getElementById("main-menu"),Us=document.getElementById("pause-resume"),Hs=document.getElementById("debug-velocity"),_s=document.getElementById("debug-hitbox"),Os=document.getElementById("debug-trajectory"),Ns=document.getElementById("debug-spline-paths"),Ws=document.getElementById("debug-rocket-speed"),qs=document.getElementById("debug-draw-seeds"),Gs=document.getElementById("debug-draw-distance"),$s=document.getElementById("debug-disable-noise"),zs=document.getElementById("debug-split-only");document.getElementById("fire-rate");const Ys=document.getElementById("rocket-piercing"),js=document.getElementById("bullet-damage"),ke=document.getElementById("hp"),Ht=document.getElementById("game-over"),Xs=document.getElementById("time-played"),Js=document.getElementById("asteroids-destroyed"),Ks=document.getElementById("distance-traveled"),Qs=document.getElementById("damage-dealt"),Zs=document.getElementById("start"),en=document.getElementById("restart"),tn=document.getElementById("volume"),on=document.getElementById("mode-pacifist"),sn=document.getElementById("mode-stationary"),nn=document.getElementById("mode-extreme"),an=document.getElementById("mode-hitless"),rn=document.getElementById("mark-pacifist"),cn=document.getElementById("mark-stationary"),ln=document.getElementById("mark-extreme"),dn=document.getElementById("mark-hitless"),mn=document.getElementById("back-to-main-menu"),un=document.getElementById("pause-back-to-main-menu"),ot=document.getElementById("controls-move"),st=document.getElementById("controls-bullet"),nt=document.getElementById("controls-rocket"),hn=(e,t,o,s,a,n,c,d,l,u,p)=>{gn(e,l,t,o,u,p),fn(s,a,n,c,d),yn(e,l)},gn=(e,t,o,s,a,n)=>{Zs.addEventListener("click",()=>{ie(),pn(),t(),e()}),on.addEventListener("change",c=>{v(),o(!c.target.checked),c.target.checked?(st.setAttribute("disabled","true"),nt.setAttribute("disabled","true")):(st.removeAttribute("disabled"),nt.removeAttribute("disabled"))}),sn.addEventListener("change",c=>{v(),s(!c.target.checked),c.target.checked?ot.setAttribute("disabled","true"):ot.removeAttribute("disabled")}),nn.addEventListener("change",c=>{v(),a(c.target.checked)}),an.addEventListener("change",c=>{v(),n(c.target.checked)})},_t=()=>{Ut.style.display="grid"},pn=()=>{Ut.style.display="none"},fn=(e,t,o,s,a)=>{tn.addEventListener("input",n=>{e(n.target.value/100)}),Fs.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),t(1e3/n.target.value)}),Rs.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),o(1e3/n.target.value)}),Hs.addEventListener("change",n=>{v(),Do(n.target.checked)}),_s.addEventListener("change",n=>{v(),Bo(n.target.checked)}),Os.addEventListener("change",n=>{v(),Vo(n.target.checked)}),Ns.addEventListener("change",n=>{v(),Co(n.target.checked)}),qs.addEventListener("change",n=>{v(),Fo(n.target.checked)}),Gs.addEventListener("change",n=>{v(),Ro(n.target.checked)}),$s.addEventListener("change",n=>{v(),Zn(n.target.checked)}),zs.addEventListener("change",n=>{v(),os(n.target.checked)}),Ws.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),s(n.target.value)}),Us.addEventListener("click",()=>{ie(),Ee(),a()}),un.addEventListener("click",()=>{ie(),Ee(),_t()})},Ot=()=>{Rt.style.display="flex"},Ee=()=>{Rt.style.display="none"},yn=(e,t)=>{en.addEventListener("click",()=>{ie(),Oe(),t(),e()}),mn.addEventListener("click",()=>{ie(),Oe(),_t()})},xn=()=>{Ht.style.display="grid"},Oe=()=>{Ht.style.display="none"},wn=(e,t,o,s,a,n)=>{rn.style.display=e?"none":"block",cn.style.display=t?"none":"block",ln.style.display=o?"block":"none",dn.style.display=s?"block":"none",fe(Xs,a.timePlayed/1e3,n.timePlayed/1e3,"s",1),fe(Js,a.asteroidsDestroyed,n.asteroidsDestroyed),fe(Ks,a.distanceTraveled,n.distanceTraveled,"m",1),fe(Qs,a.damageDealt,n.damageDealt,"hp",0)},fe=(e,t,o,s,a)=>{e.children.item(1).innerText=s?`${t.toFixed(a)} ${s}`:`${t.toFixed(a)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${s?`${o.toFixed(a)} ${s}`:o.toFixed(a)} )`)},bn=e=>{Ys.innerText=`${e}`},vn=e=>{js.innerText=e.toFixed(1)},Ge=e=>{for(let t=0;t<ke.children.length;t++)ke.children.item(t).style.color=t<e?"red":"grey"},Mn=e=>{ke.innerHTML="";for(let t=0;t<e;t++){const o=document.createElement("li");o.innerText="â¤",o.style.color="red",ke.appendChild(o)}},kn=(e,t,o)=>{Bs.innerText=`${e}`,Vs.innerText=`${t}`,Cs.innerText=`${o}`};let b=document.getElementsByTagName("canvas")[0],z=null,Nt=!1;const Wt=2e3,En=(e,t)=>{const o=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*o};let f=!0;const qt=()=>f=!1;let $e,we=1e3/120;const Tn=e=>we=e;let Gt=1e3/60;const In=e=>Gt=e;let Te=0,at=0,Ne=0,$=!0;const Pn=e=>$=e;let I=!0;const Sn=e=>I=e;let Re=0,Ue=0,rt=0,T=[],K=[],Q=[],i=null,re=[],J=1,it=0,ce=!1,ct=0,Ln=40,lt=80,Ie=3,le=!1,An=3e3,dt=0,$t=300;const Dn=e=>$t=e;let We=1e3,mt=0;const Bn=e=>Math.pow(.99,e/1e3)*1e3;let Z=!1;const Vn=e=>Z=e;let U=!1;const Cn=e=>{U=e};let Fn=1e4,ut=0,h={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const Rn=()=>{document.getElementById("version").innerText="0.3.0",Te=performance.now(),Ne=Te,Hn(),hn(Xn,Pn,Sn,ws,In,Tn,Dn,qt,Kn,Vn,Cn)},Un=e=>{if(z==null)return;const t=navigator.getGamepads()[z];t.buttons[9].value>=.5&&e-300>=rt&&(Jt(),rt=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?ce=!f&&$:ce=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?le=!f&&$:le=!1,t.buttons[12].pressed?h.forwardController=!f&&I:h.forwardController=!1,t.buttons[13].pressed?h.backwardController=!f&&I:h.backwardController=!1,t.buttons[14].pressed?h.leftController=!f&&I:h.leftController=!1,t.buttons[15].pressed?h.rightController=!f&&I:h.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},Hn=()=>{window.addEventListener("gamepadconnected",e=>{z=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{z=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":Jt();break;case" ":ce=!f&&$;break;case"Shift":le=!f&&$;break;case"ArrowUp":case"w":case"W":h.forward=!f&&I;break;case"ArrowDown":case"s":case"S":h.backward=!f&&I;break;case"ArrowLeft":case"a":case"A":h.left=!f&&I;break;case"ArrowRight":case"d":case"D":h.right=!f&&I;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":ce=!1;break;case"Shift":le=!1;break;case"ArrowUp":case"w":case"W":h.forward=!1;break;case"ArrowDown":case"s":case"S":h.backward=!1;break;case"ArrowLeft":case"a":case"A":h.left=!1;break;case"ArrowRight":case"d":case"D":h.right=!1;break}}),document.addEventListener("mousemove",e=>{if(f||i==null)return;const t=e.clientX-b.getBoundingClientRect().left,o=e.clientY-b.getBoundingClientRect().top,s=t-i.position.x,a=o-i.position.y;i.rotation=Math.atan2(a,s)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(f=!0,Ot())})};let y=performance.now();const zt=()=>{for(y=performance.now(),Un(y);at+we/2<=y;)f||(On(we),++Re),at+=we;if(Te+Gt/2<=y&&(f||(Ho(),++Ue),Te=y),y-Ne>=1e3){const e=T.length+K.length+Q.length+(i?1:0);kn(e,Ue,Re),Ue=0,Re=0,Ne=y}$e=requestAnimationFrame(zt)},_n=()=>{if(ce&&y-ct>=Ln&&i){const e=i.rotation+(Math.random()-.5)*.1,t=it%2===0?-1:1,o=Fe(i.rotation+Math.PI/2*t);o.x*=10,o.y*=10,o.x+=i.position.x,o.y+=i.position.y,jt(o,e,Fe(e),0,!0),Ft(),it++,ct=y}if(le&&y-dt>=An&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*1e3,y:i.position.y-Math.sin(i.rotation)*1e3}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(Ie,T.length);t++){let o;do o=T[Math.floor(Math.random()*T.length)];while(e.includes(o));o.frozen=!0,o.velocity.x=0,o.velocity.y=0,e.push(o)}e.push(e.at(-1)),qn({...i.position},i.rotation,jo(Fe(i.rotation),.2),0,e),dt=y}if(y-mt>=We){const e=et(),t=At(),o=Math.random()*Math.PI*2,s={x:t.x-e.x,y:t.y-e.y},a=Math.sqrt(s.x**2+s.y**2);a>0&&(s.x/=a,s.y/=a),s.x*=Math.random()*.1+.1,s.y*=Math.random()*.1+.1,Z&&(s.x*=2,s.y*=2);const n=Me(.005),c=ss(g.timePlayed),d=Z?rs():as();Yt(e,o,{x:0,y:0},s,n,c,d),mt=y,We=Bn(g.timePlayed)}if(y-ut>=Fn){const e=et(),t={x:b.width/2+(Math.random()-.5)*400,y:b.height/2+(Math.random()-.5)*400},o={x:t.x-e.x,y:t.y-e.y},s=Math.sqrt(o.x**2+o.y**2);s>0&&(o.x/=s,o.y/=s),o.x*=.1,o.y*=.1;const a=Me(.005),n=ns();zn(n,e,0,o,a),ut=y}if(i){if(z!=null){const e=navigator.getGamepads()[z];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let o=e.axes[0];Math.abs(e.axes[0])<=.01?o=0:e.axes[0]>=.7?o=1:e.axes[0]<=-.7&&(o=-1),i.force.y+=.004*t,i.force.x+=.004*o}i.force.x==0&&i.force.y==0&&((h.forward||h.forwardController)&&(i.force.y-=.004),(h.backward||h.backwardController)&&(i.force.y+=.004),(h.left||h.leftController)&&(i.force.x-=.004),(h.right||h.rightController)&&(i.force.x+=.004))}},He=e=>e.x<-100||e.x>b.width+100||e.y<-100||e.y>b.height+100,ht=()=>{i.hp-=1,vs(),i.hp>=0&&Ge(i.hp),i.hp<=0&&(xe(),Yn(),Ae(0),L(me,{position:{...i.position},frame:0}),setTimeout(()=>{Jn()},1e3))},On=e=>{_n(),g.timePlayed+=e;for(const t of T){if(t.type==="homing"){const o=Ce(t.velocity),s=Ce(ve(i.position,t.position)),a=Ce(Xo(o,s,.002*e)),n=Math.sqrt(t.velocity.x**2+t.velocity.y**2);let c=a.x,d=a.y;const l=Math.sqrt(c**2+d**2);l>0&&(c/=l,d/=l),c*=n,d*=n,t.velocity.x=c,t.velocity.y=d}ge(t,e),He(t.position)&&(t.remove=!0);for(const o of T)t!==o&&te(t,o,1,!0)&&bs();if(t.type==="turret"&&!t.frozen){const o=t.bulletIndex%5===0?lt*50:lt;if(y-t.lastBulletTime>=o){const s={x:i.position.x-t.position.x,y:i.position.y-t.position.y},a=Math.sqrt(s.x**2+s.y**2);a>0&&(s.x/=a*2,s.y/=a*2);const n={x:t.position.x,y:t.position.y};jt(n,Jo(s),s,0,!1),Ft(),t.lastBulletTime=y,t.bulletIndex++}}}for(const t of K)if(ge(t,e),He(t.position)&&(t.remove=!0),!t.disabled){if(t.friendly)for(const o of T)if(o.type==="armored")te(t,o,1,!1)&&(g.bulletsHit++,t.velocity.x*=.1,t.velocity.y*=.1,t.angularVelocity=Me(.02),t.disabled=!0,Ms(),setTimeout(()=>{t.remove=!0},300));else if(o.type==="split"){if(te(t,o,1,!1)&&(g.bulletsHit++,g.damageDealt+=Math.min(o.hp,J),o.hp-=J,t.remove=!0,tt(),wo(o,t,Nt),o.hp<=0)){const s=Io(o);++g.asteroidsDestroyed,o.remove=!0,o.hp=100,xe(),Qn(s,o)}}else te(t,o,1,!1)&&(g.bulletsHit++,g.damageDealt+=Math.min(o.hp,J),o.hp-=J,o.hp<=0&&(++g.asteroidsDestroyed,o.remove=!0,xe()),t.remove=!0,tt());else if(te(t,i,1,!1)&&(ht(),t.remove=!0,i.hp<=0))break}for(const t of Q)t.progress+=e/1e3*$t,es(t,t.progress,o=>{o.remove=!0,++g.asteroidsDestroyed,g.damageDealt+=o.hp,xe()});for(const t of re)if(ge(t,e),He(t.position)&&(t.remove=!0),_e(t,i))switch(t.remove=!0,ks(),t.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,i.maxHp),Ge(i.hp);break;case"damage":J+=1,vn(J);break;case"rocket-piercing":Ie+=1,bn(Ie);break}if(i!==null&&i.hp>0){const t={...i.position};ge(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},s=Math.sqrt(o.x**2+o.y**2);g.distanceTraveled+=s,Ae(Math.min(s/100,.05));for(const a of T)if(te(i,a,1,!0)&&(ht(),i.hp<=0))break}if(z==null)!h.forward&&!h.backward&&!h.left&&!h.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const t=navigator.getGamepads()[z];Math.abs(t.axes[0])<.01&&Math.abs(t.axes[1])<.01&&!h.forward&&!h.backward&&!h.left&&!h.right&&!h.forwardController&&!h.backwardController&&!h.leftController&&!h.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>b.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,b.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>b.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,b.height)),i.velocity.y*=-1),Nn()},Nn=()=>{T.forEach(e=>{e.remove&&(D(de,e.id),e.frame=0,L(me,e))}),K.forEach(e=>{e.remove&&D(C,e.id)}),Q.forEach(e=>{e.remove&&(D(F,e.id),e.children.forEach(t=>{D(ne,t.id)}))}),re.forEach(e=>{e.remove&&D(Pe,e.id)}),T=T.filter(e=>!e.remove),K=K.filter(e=>!e.remove),Q=Q.filter(e=>!e.remove),re=re.filter(e=>!e.remove)},Wn={default:Es,homing:Is,armored:Ps,turret:Ss,split:Ts},Yt=(e,t,o,s,a,n,c,d=null,l=!1,u=0,p=0)=>{const m=Y();if(m.position=e,m.rotation=t,m.acceleration=o,m.velocity=s,m.angularVelocity=a,m.mass=En(n,c),m.radius=c==="armored"?n*2:n,m.inertia=2/5*m.mass*n**2,m.hp=n/2,m.width=u,m.height=p,d?(m.texture=d,m.textureReady=!0):ze(m,Wn[c],m.radius*2,m.radius*2),m.type=c,c==="turret"&&(m.lastBulletTime=y,m.bulletIndex=0),!(!l&&_e(m,i))){for(const M of T)if(!l&&_e(m,M))return;L(de,m),T.push(m)}},jt=(e,t,o,s,a)=>{const n=Y();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=s,n.mass=Wt,n.radius=5,n.inertia=2/5*n.mass*n.radius**2,n.friendly=a,L(C,n),K.push(n),++g.bulletsFired},qn=(e,t,o,s,a)=>{const n=Y();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=s,n.mass=Wt,n.radius=5,n.targets=a,n.progress=0,n.currentTarget=0,Qo(n),ts(n),L(F,n),Q.push(n),Xt({x:-5,y:0},Math.PI/2,n),++g.rocketsFired},Gn=(e,t,o,s)=>{i=Y(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=s,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.maxHp=5,U&&(i.maxHp=1),i.hp=i.maxHp,ze(i,Ls,i.height,i.width),L(ue,i),gt({x:-5,y:18},0,oe,Ds,i),gt({x:-5,y:-18},0,oe,As,i)},gt=(e,t,o,s,a)=>{const n=Y();n.position=e,n.rotation=t,n.parent=a,n.height=20,n.width=20,L(o,n),ze(n,s,n.height,n.width),a.children??(a.children=a.children||[]),a.children.push(n),Xt({x:-5,y:0},Math.PI/2,n)},Xt=(e,t,o)=>{const s=Y();s.position=e,s.rotation=t,s.parent=o,s.height=10,s.width=5,o.children??(o.children=o.children||[]),o.children.push(s),L(ne,s),$n({x:0,y:0},0,s)},$n=(e,t,o)=>{const s=Y();s.position=e,s.rotation=t,s.parent=o,s.height=5,s.width=5,o.children??(o.children=o.children||[]),o.children.push(s),L(Se,s)},zn=(e,t,o,s,a)=>{if(U&&["health"].includes(e))return;const n=Y();n.type=e,n.position=t,n.rotation=o,n.velocity=s,n.angularVelocity=a,n.radius=25,L(Pe,n),re.push(n)},Jt=()=>{f=!f,f?(Ot(),Ae(0)):Ee()},Yn=()=>{if(i){D(ue,i.id);for(let e of i.children){D(oe,e.id);for(let t of e.children)D(ne,t.id)}}},jn=()=>{b.width=b.clientWidth,b.height=b.clientHeight,Gn({x:b.width/2,y:b.height/2},0,{x:0,y:0},0),console.log(U),console.log("Setting max hp to: "+(U?1:5)),Mn(U?1:5)},Xn=()=>{jn(),qt(),$e=requestAnimationFrame(zt)},Jn=()=>{if(f)return;f=!0,cancelAnimationFrame($e),Ae(0),i=null;const e=Vt(!$,!I,Z,U);wn($,I,Z,U,g,e),xn(),cs(!$,!I,Z,U)},Kn=()=>{ls(),Uo(),T=[],K=[],Q=[],We=1e3,Ie=3,J=1,Ge(5),Ee(),Oe()},ze=(e,t,o,s)=>{const a=new Image;a.src=t,a.onload=()=>{const n=document.createElement("canvas");n.width=s,n.height=o,n.getContext("2d").drawImage(a,0,0,s,o),e.texture=n,e.textureReady=!0}},Qn=(e,t)=>{for(let o=0;o<e.length;o++){const s=e[o],a=t.position,n={x:a.x+Math.random(),y:a.y+Math.random()},c=At(),d=t.rotation,l={x:c.x-n.x,y:c.y-n.y},u=Math.sqrt(l.x**2+l.y**2);u>0&&(l.x/=u,l.y/=u),l.x*=Math.random()*.1+.1,l.y*=Math.random()*.1+.1,Z&&(l.x*=2,l.y*=2);const p=Me(.005),m=Math.max(s.width,s.height)/2;Yt(n,d,{x:0,y:0},l,p,m,"default",s,!0,s.width,s.height)}},Zn=e=>{Nt=e};Rn();
