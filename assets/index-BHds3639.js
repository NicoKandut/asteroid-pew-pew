(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();let B=new Map;const kt=2e3,J=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},s=e.parent;if(s==null)return t;const n=J(s),o=Math.cos(n.rotation),a=Math.sin(n.rotation);return{x:n.x+t.x*o-t.y*a,y:n.y+t.x*a+t.y*o,rotation:n.rotation+t.rotation}},Et=(e,t)=>{B[e]||(B[e]=[]);const s=performance.now();B[e].push({x:t.x,y:t.y,time:s}),B[e]=B[e].filter(n=>s-n.time<kt)},Tt=e=>{delete B[e]},Pt=e=>{for(const t in B){const s=B[t];if(!(!s||s.length<2)){e.beginPath();for(let n=0;n<s.length;n++){const o=s[n];n===0?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},It="/asteroid-pew-pew/img/boom/boom_0.gif",St="/asteroid-pew-pew/img/boom/boom_1.gif",At="/asteroid-pew-pew/img/boom/boom_2.gif",Lt="/asteroid-pew-pew/img/boom/boom_3.gif",Bt="/asteroid-pew-pew/img/boom/boom_4.gif",Vt="/asteroid-pew-pew/img/boom/boom_5.gif",Dt="/asteroid-pew-pew/img/boom/boom_6.gif",Ct="/asteroid-pew-pew/img/boom/boom_7.gif",Ut="/asteroid-pew-pew/img/boom/boom_8.gif",Rt="/asteroid-pew-pew/img/boom/boom_9.gif",Ft="/asteroid-pew-pew/img/boom/boom_10.gif",Ot="/asteroid-pew-pew/img/boom/boom_11.gif",_t="/asteroid-pew-pew/img/boom/boom_12.gif",Ht="/asteroid-pew-pew/img/boom/boom_13.gif",Wt="/asteroid-pew-pew/img/boom/boom_14.gif",Nt="/asteroid-pew-pew/img/ice.png",Gt="/asteroid-pew-pew/img/powerup.png",U=document.getElementsByTagName("canvas")[0],r=U.getContext("2d"),X="asteroid",P="bullet",Y="explosion",se="flash",I="rocket",K="spaceship",qe="velocity",H="spaceshippart",W="flames",le="powerup",qt="#ffffff",$t="#ffff00",te="#ff0000",Te="#00ff00";let jt=0;const zt=()=>`${jt++}`,S={[X]:{color:qt},[P]:{color:$t,length:10,strokeWidth:2},[I]:{color:te,radius:10},[K]:{color:Te},[qe]:{color:te},[H]:{color:Te},[W]:{color:te}},V={[W]:{},[K]:{},[H]:{},[X]:{},[P]:{},[I]:{},[Y]:{},[se]:{},[le]:{}};let $e=!1,Q=!1,je=!1,ze=!1;const Jt=e=>{$e=e},Xt=e=>{Q=e},Yt=e=>{je=e},Kt=e=>{ze=e},k=(e,t)=>{t.id=zt(),V[e][t.id]=t},M=(e,t)=>{delete V[e][t],Tt(t)},Qt=()=>{for(const e in V)V[e]={}},g=[];for(let e=0;e<15;++e)g.push(new Image);g[0].src=It;g[1].src=St;g[2].src=At;g[3].src=Lt;g[4].src=Bt;g[5].src=Vt;g[6].src=Dt;g[7].src=Ct;g[8].src=Ut;g[9].src=Rt;g[10].src=Ft;g[11].src=Ot;g[12].src=_t;g[13].src=Ht;g[14].src=Wt;const Je=new Image;Je.src=Nt;const Zt=()=>{U.width=U.clientWidth,U.height=U.clientHeight,r.clearRect(0,0,U.width,U.height);for(const e in V)for(const t of Object.values(V[e])){switch(e){case X:eo(t);break;case Y:so(t);break;case P:to(t);break;case I:oo(t);break;case K:case H:ao(t);break;case W:no(t);break;case se:ro(t);break;case le:io(t);break}Et(t.id,J(t))}if($e){r.strokeStyle=S[qe].color,r.lineWidth=1,r.beginPath();for(const e in V){for(const t of Object.values(V[e]))if("velocity"in t){const{position:s,velocity:n}=t,{x:o,y:a}=s,{x:c,y:l}=n;r.moveTo(o,a),r.lineTo(o+c*200,a+l*200)}r.stroke()}}je&&Pt(r)},eo=e=>{const{radius:t,texture:s}=e,n=J(e);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.drawImage(s,-t,-t,t*2,t*2),Q&&(r.strokeStyle=te,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(Je,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore()},to=e=>{var o;const{length:t}=S[P],s=Math.cos(e.rotation)*t/2,n=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?S[P].color:"red",r.strokeStyle=e.friendly?S[P].color:"red",r.lineWidth=(o=S[P])==null?void 0:o.strokeWidth,r.beginPath(),r.moveTo(e.position.x+s,e.position.y+n),r.lineTo(e.position.x-s,e.position.y-n),r.stroke()},oo=e=>{var c;const{radius:t}=S[I],s=2*Math.PI/8,n={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},o={x:e.position.x-t*Math.cos(e.rotation+s),y:e.position.y-t*Math.sin(e.rotation+s)},a={x:e.position.x-t*Math.cos(e.rotation-s),y:e.position.y-t*Math.sin(e.rotation-s)};if(r.fillStyle=S[I].color,r.strokeStyle=S[I].color,r.lineWidth=((c=S[I])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(n.x,n.y),r.lineTo(o.x,o.y),r.lineTo(a.x,a.y),r.lineTo(n.x,n.y),r.stroke(),ze){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},so=e=>{r.translate(e.position.x,e.position.y);const n=g[e.frame];r.drawImage(n,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<g.length-1?e.frame++:M(Y,e.id)},ao=e=>{const{width:t,height:s,texture:n}=e,o=J(e);r.save(),r.translate(o.x,o.y),r.rotate(o.rotation),r.drawImage(n,-t/2,-s/2,t,s),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-s/2,t,s)),r.restore()},no=e=>{var y,A,E;const{width:t,height:s}=e,n=J(e),o=((y=e==null?void 0:e.parent)==null?void 0:y.velocity)??{x:0,y:1},a=((E=(A=e==null?void 0:e.parent)==null?void 0:A.parent)==null?void 0:E.velocity)??{x:0,y:0},c={x:o.x+a.x,y:o.y+a.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.beginPath();const u=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(s+u)*l),r.lineTo(t,(s+u)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(s/2+u)*l),r.lineTo(t/2,(s/2+u)*l),r.closePath(),r.fillStyle="yellow",r.fill(),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,s+u)),r.restore()},ro=e=>{const t=e.position,s=e.rotation,n=3,o=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(s),r.moveTo(n,n),r.lineTo(o,0),r.lineTo(n,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,n),r.lineTo(0,o),r.resetTransform(),r.closePath(),r.fill()},Xe=new Image;Xe.src=Gt;const io=e=>{const{radius:t}=e,s=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(Xe,-t,-t,s,s),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,s,s)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸ’š",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.fillStyle="blue",r.textAlign="center",r.font="20px Arial",r.fillText("ðŸš€",0,7);break}r.restore()},O=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),Z=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const s=Math.sqrt(e.velocity.x**2+e.velocity.y**2);s>e.maxVelocity&&(e.velocity.x/=s/e.maxVelocity,e.velocity.y/=s/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Ye=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),fe=(e,t)=>Ye(e,t)<e.radius+t.radius,N=(e,t,s,n)=>{const o=Ye(e,t);if(o>=e.radius+t.radius)return!1;const a={x:(t.position.x-e.position.x)/o,y:(t.position.y-e.position.y)/o},c=2*(e.velocity.x*a.x+e.velocity.y*a.y-t.velocity.x*a.x-t.velocity.y*a.y)/(e.mass+t.mass),l=e.radius+t.radius-o;n&&(e.position.x-=a.x*l,e.position.y-=a.y*l,t.position.x+=a.x*l,t.position.y+=a.y*l),e.frozen||(e.velocity.x-=c*s*t.mass*a.x,e.velocity.y-=c*s*t.mass*a.y),t.frozen||(t.velocity.x+=c*s*e.mass*a.x,t.velocity.y+=c*s*e.mass*a.y);const u={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return k(se,u),setTimeout(()=>M(se,u.id),100),!0},me=e=>{const t=Math.sqrt(e.x**2+e.y**2);return{x:e.x/t,y:e.y/t}},ae=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),lo=(e,t)=>{e.x*=t,e.y*=t},co=(e,t,s)=>({x:e.x+(t.x-e.x)*s,y:e.y+(t.y-e.y)*s}),ue=e=>({x:Math.cos(e),y:Math.sin(e)}),mo=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},Pe=e=>Math.sqrt(e.x**2+e.y**2),Ie=10,uo=30,Se=(e,t,s,n,o)=>.5*(2*s+(-t+n)*e+(2*t-5*s+4*n-o)*e*e+(-t+3*s-3*n+o)*e*e*e),Ke=(e,t,s,n,o)=>({x:Se(e,t.x,s.x,n.x,o.x),y:Se(e,t.y,s.y,n.y,o.y)}),Qe=(e,t)=>{const s=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return Ke(t%1,e.targets[s+0].position,e.targets[s+1].position,e.targets[s+2].position,e.targets[s+3].position)},Ze=(e,t)=>Qe(e,et(e,t)),ho=e=>{e.arcLengthTable=[];let t=0,s=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*Ie;++c){const l=c/Ie,u=Qe(e,l),y=Pe(ae(u,s));t+=y,e.arcLengthTable.push({v:l,totalLength:t}),s=u}const n=e.targets.length-4,o=Ke(1,e.targets[n+0].position,e.targets[n+1].position,e.targets[n+2].position,e.targets[n+3].position),a=Pe(ae(o,s));t+=a,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},po=e=>-(Math.cos(Math.PI*e)-1)/2,et=(e,t)=>{let s=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],u=e.arcLengthTable[c];if(t<u.totalLength){const y=u.totalLength-l.totalLength;if(y===0){s=u.v;break}const E=(t-l.totalLength)/y;s=l.v*(1-E)+u.v*E;break}}const n=Math.floor(s),o=s-n,a=po(o);return n+a},go=(e,t,s)=>{const n=Ze(e,t);e.velocity=ae(n,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=n;const o=Math.max(Math.min(Math.floor(et(e,t)),e.targets.length-3),0);if(o!==e.currentTarget&&(s(e.targets[o+1]),e.currentTarget=o),o>=e.targets.length-3){e.remove=!0;return}},fo=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let s=0;s<=t;s+=uo)e.pathPoints.push(Ze(e,s));e.pathPoints.push(e.targets[e.targets.length-2].position)},L=document.getElementsByTagName("canvas")[0],yo=()=>({x:Math.random()*L.width,y:Math.random()*L.height}),Ae=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*L.width,y:-90};case 1:return{x:L.width+t,y:Math.random()*L.height};case 2:return{x:Math.random()*L.width,y:L.height+t};case 3:return{x:-90,y:Math.random()*L.height}}},ye=e=>(Math.random()*2-1)*e,wo=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},xo=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],s=Math.random();for(let n=0;n<e.length;n++)if(s<t[n])return e[n];return e[e.length-1]},tt=(e,t)=>{const s=Math.random();let n=0;for(let o=0;o<t.length;o++)if(n+=t[o],s<n)return e[o];return e[t.length-1]},bo=()=>tt(["default","homing","armored","turret"],[.85,.05,.05,.05]),vo=()=>tt(["homing","armored","turret"],[.34,.33,.33]),T={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},Mo=JSON.stringify(T),ot=(e,t,s)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(s?"-extreme":"-default"),st=(e,t,s)=>{const n=ot(e,t,s);return JSON.parse(localStorage.getItem(n)||Mo)},m={...T},ko=(e,t,s)=>{const n=st(e,t,s);n.timePlayed=Math.max(n.timePlayed,m.timePlayed),n.asteroidsDestroyed=Math.max(n.asteroidsDestroyed,m.asteroidsDestroyed),n.damageDealt=Math.max(n.damageDealt,m.damageDealt),n.bulletsFired=Math.max(n.bulletsFired,m.bulletsFired),n.bulletsHit=Math.max(n.bulletsHit,m.bulletsHit),n.rocketsFired=Math.max(n.rocketsFired,m.rocketsFired),n.distanceTraveled=Math.max(n.distanceTraveled,m.distanceTraveled),localStorage.setItem(ot(e,t,s),JSON.stringify(n))},Eo=()=>{m.timePlayed=T.timePlayed,m.asteroidsDestroyed=T.asteroidsDestroyed,m.damageDealt=T.damageDealt,m.bulletsFired=T.bulletsFired,m.bulletsHit=T.bulletsHit,m.rocketsFired=T.rocketsFired,m.distanceTraveled=T.distanceTraveled},To="/asteroid-pew-pew/audio/propulsion.mp3",Po="/asteroid-pew-pew/audio/explosion.wav",Io="/asteroid-pew-pew/audio/shoot.wav",So="/asteroid-pew-pew/audio/hurt.wav",at="/asteroid-pew-pew/audio/hit.wav",Ao="/asteroid-pew-pew/audio/click.wav",Lo="/asteroid-pew-pew/audio/submit.wav",Bo="/asteroid-pew-pew/audio/powerup.wav",Vo="/asteroid-pew-pew/audio/CODEX_2015.mp3",Do="/asteroid-pew-pew/audio/armorHit.wav";let b=.5;const Co=e=>{Me.volume=.05*e,b=e},ce=new Audio(To);ce.volume=0;ce.loop=!0;document.addEventListener("keydown",()=>ce.play().catch(()=>{}),{once:!0});const de=e=>{ce.volume=e*b},$=()=>{const e=new Audio(Lo);e.volume=.5*b,e.play().catch(()=>{})},v=()=>{const e=new Audio(Ao);e.volume=.5*b,e.play().catch(()=>{})},Uo=()=>{const e=new Audio(at);e.volume=.1*b,e.play().catch(()=>{})},Ro=()=>{const e=new Audio(So);e.volume=.3*b,e.play().catch(()=>{})},nt=()=>{const e=new Audio(Io);e.volume=.1*b,e.play().catch(()=>{})},Fo=()=>{const e=new Audio(at);e.volume=.2*b,e.play().catch(()=>{})},Oo=()=>{const e=new Audio(Do);e.volume=.2*b,e.play().catch(()=>{})},we=()=>{const e=new Audio(Po);e.volume=.3*b,e.play().catch(()=>{})},_o=()=>{const e=new Audio(Bo);e.volume=.2*b,e.play().catch(()=>{})},Me=new Audio(Vo);Me.volume=.05*b;Me.loop=!0;const Ho="/asteroid-pew-pew/img/Asteroid1.png",Wo="/asteroid-pew-pew/img/asteroid_red.png",No="/asteroid-pew-pew/img/asteroid_armored.png",Go="/asteroid-pew-pew/img/asteroid_green.png",qo="/asteroid-pew-pew/img/Spaceship.png",$o="/asteroid-pew-pew/img/WingLeft.png",jo="/asteroid-pew-pew/img/WingRight.png";let zo=document.getElementById("entity-count"),Jo=document.getElementById("fps"),Xo=document.getElementById("ups"),Yo=document.getElementById("target-fps"),Ko=document.getElementById("target-ups"),rt=document.getElementById("pause-menu");const it=document.getElementById("main-menu"),Qo=document.getElementById("pause-resume"),Zo=document.getElementById("debug-velocity"),es=document.getElementById("debug-hitbox"),ts=document.getElementById("debug-trajectory"),os=document.getElementById("debug-spline-paths"),ss=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const as=document.getElementById("rocket-piercing"),ns=document.getElementById("bullet-damage"),Le=document.getElementById("hp"),lt=document.getElementById("game-over"),rs=document.getElementById("time-played"),is=document.getElementById("asteroids-destroyed"),ls=document.getElementById("distance-traveled"),cs=document.getElementById("damage-dealt"),ds=document.getElementById("start"),ms=document.getElementById("restart"),us=document.getElementById("volume"),hs=document.getElementById("mode-pacifist"),ps=document.getElementById("mode-stationary"),gs=document.getElementById("mode-extreme"),fs=document.getElementById("mark-pacifist"),ys=document.getElementById("mark-stationary"),ws=document.getElementById("mark-extreme"),xs=document.getElementById("back-to-main-menu"),bs=document.getElementById("pause-back-to-main-menu"),Be=document.getElementById("controls-move"),Ve=document.getElementById("controls-bullet"),De=document.getElementById("controls-rocket"),vs=(e,t,s,n,o,a,c,l,u,y)=>{Ms(e,u,t,s,y),Es(n,o,a,c,l),Ts(e,u)},Ms=(e,t,s,n,o)=>{ds.addEventListener("click",()=>{$(),ks(),t(),e()}),hs.addEventListener("change",a=>{v(),s(!a.target.checked),a.target.checked?(Ve.setAttribute("disabled","true"),De.setAttribute("disabled","true")):(Ve.removeAttribute("disabled"),De.removeAttribute("disabled"))}),ps.addEventListener("change",a=>{v(),n(!a.target.checked),a.target.checked?Be.setAttribute("disabled","true"):Be.removeAttribute("disabled")}),gs.addEventListener("change",a=>{v(),o(a.target.checked)})},ct=()=>{it.style.display="grid"},ks=()=>{it.style.display="none"},Es=(e,t,s,n,o)=>{us.addEventListener("input",a=>{e(a.target.value/100)}),Yo.addEventListener("change",a=>{v(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),t(1e3/a.target.value)}),Ko.addEventListener("change",a=>{v(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),s(1e3/a.target.value)}),Zo.addEventListener("change",a=>{v(),Jt(a.target.checked)}),es.addEventListener("change",a=>{v(),Xt(a.target.checked)}),ts.addEventListener("change",a=>{v(),Yt(a.target.checked)}),os.addEventListener("change",a=>{v(),Kt(a.target.checked)}),ss.addEventListener("change",a=>{v(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),n(a.target.value)}),Qo.addEventListener("click",()=>{$(),ne(),o()}),bs.addEventListener("click",()=>{$(),ne(),ct()})},dt=()=>{rt.style.display="flex"},ne=()=>{rt.style.display="none"},Ts=(e,t)=>{ms.addEventListener("click",()=>{$(),xe(),t(),e()}),xs.addEventListener("click",()=>{$(),xe(),ct()})},Ps=()=>{lt.style.display="grid"},xe=()=>{lt.style.display="none"},Is=(e,t,s,n,o)=>{fs.style.display=e?"none":"block",ys.style.display=t?"none":"block",ws.style.display=s?"block":"none",ee(rs,n.timePlayed/1e3,o.timePlayed/1e3,"s",1),ee(is,n.asteroidsDestroyed,o.asteroidsDestroyed),ee(ls,n.distanceTraveled,o.distanceTraveled,"m",1),ee(cs,n.damageDealt,o.damageDealt,"hp",0)},ee=(e,t,s,n,o)=>{e.children.item(1).innerText=n?`${t.toFixed(o)} ${n}`:`${t.toFixed(o)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>s?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${n?`${s.toFixed(o)} ${n}`:s.toFixed(o)} )`)},Ss=e=>{as.innerText=`${e}`},As=e=>{ns.innerText=e.toFixed(1)},ke=e=>{for(let t=0;t<Le.children.length;t++)Le.children.item(t).style.color=t<e?"red":"grey"},Ls=(e,t,s)=>{zo.innerText=`${e}`,Jo.innerText=`${t}`,Xo.innerText=`${s}`};let f=document.getElementsByTagName("canvas")[0],C=null;const mt=2e3,Bs=(e,t)=>{const s=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*s};let h=!0;const ut=()=>h=!1;let Ee,oe=1e3/120;const Vs=e=>oe=e;let ht=1e3/60;const Ds=e=>ht=e;let re=0,Ce=0,be=0,D=!0;const Cs=e=>D=e;let x=!0;const Us=e=>x=e;let he=0,pe=0,Ue=0,w=[],R=[],F=[],i=null,q=[],G=1,Re=0,j=!1,Fe=0,Rs=40,Oe=80,ie=3,z=!1,Fs=3e3,_e=0,pt=300;const Os=e=>pt=e;let ve=1e3,He=0;const _s=e=>Math.pow(.99,e/1e3)*1e3;let _=!1;const Hs=e=>_=e;let Ws=1e4,We=0,d={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const Ns=()=>{document.getElementById("version").innerText="0.2.0",re=performance.now(),be=re,qs(),vs(ta,Cs,Us,Co,Ds,Vs,Os,ut,sa,Hs)},Gs=e=>{if(C==null)return;const t=navigator.getGamepads()[C];t.buttons[9].value>=.5&&e-300>=Ue&&(Mt(),Ue=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?j=!h&&D:j=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?z=!h&&D:z=!1,t.buttons[12].pressed?d.forwardController=!h&&x:d.forwardController=!1,t.buttons[13].pressed?d.backwardController=!h&&x:d.backwardController=!1,t.buttons[14].pressed?d.leftController=!h&&x:d.leftController=!1,t.buttons[15].pressed?d.rightController=!h&&x:d.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},qs=()=>{window.addEventListener("gamepadconnected",e=>{C=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{C=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":Mt();break;case" ":j=!h&&D;break;case"Shift":z=!h&&D;break;case"ArrowUp":case"w":case"W":d.forward=!h&&x;break;case"ArrowDown":case"s":case"S":d.backward=!h&&x;break;case"ArrowLeft":case"a":case"A":d.left=!h&&x;break;case"ArrowRight":case"d":case"D":d.right=!h&&x;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":j=!1;break;case"Shift":z=!1;break;case"ArrowUp":case"w":case"W":d.forward=!1;break;case"ArrowDown":case"s":case"S":d.backward=!1;break;case"ArrowLeft":case"a":case"A":d.left=!1;break;case"ArrowRight":case"d":case"D":d.right=!1;break}}),document.addEventListener("mousemove",e=>{if(h||i==null)return;const t=e.clientX-f.getBoundingClientRect().left,s=e.clientY-f.getBoundingClientRect().top,n=t-i.position.x,o=s-i.position.y;i.rotation=Math.atan2(o,n)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(h=!0,dt())})};let p=performance.now();const gt=()=>{for(p=performance.now(),Gs(p);Ce+oe/2<=p;)h||(js(oe),++he),Ce+=oe;if(re+ht/2<=p&&(h||(Zt(),++pe),re=p),p-be>=1e3){const e=w.length+R.length+F.length+(i?1:0);Ls(e,pe,he),pe=0,he=0,be=p}Ee=requestAnimationFrame(gt)},$s=()=>{if(j&&p-Fe>=Rs&&i){const e=i.rotation+(Math.random()-.5)*.1,t=Re%2===0?-1:1,s=ue(i.rotation+Math.PI/2*t);s.x*=10,s.y*=10,s.x+=i.position.x,s.y+=i.position.y,bt(s,e,ue(e),0,!0),nt(),Re++,Fe=p}if(z&&p-_e>=Fs&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(ie,w.length);t++){let s;do s=w[Math.floor(Math.random()*w.length)];while(e.includes(s));s.frozen=!0,s.velocity.x=0,s.velocity.y=0,e.push(s)}e.push(i),Ys({...i.position},i.rotation,lo(ue(i.rotation),.2),0,e),_e=p}if(p-He>=ve){const e=Ae(),t=yo(),s=Math.random()*Math.PI*2,n={x:t.x-e.x,y:t.y-e.y},o=Math.sqrt(n.x**2+n.y**2);o>0&&(n.x/=o,n.y/=o),n.x*=Math.random()*.1+.1,n.y*=Math.random()*.1+.1,_&&(n.x*=2,n.y*=2);const a=ye(.005),c=wo(m.timePlayed),l=_?vo():bo();Xs(e,s,{x:0,y:0},n,a,c,l),He=p,ve=_s(m.timePlayed)}if(p-We>=Ws){const e=Ae(),t={x:f.width/2+(Math.random()-.5)*400,y:f.height/2+(Math.random()-.5)*400},s={x:t.x-e.x,y:t.y-e.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=.1,s.y*=.1;const o=ye(.005),a=xo();Qs(a,e,0,s,o),We=p}if(i){if(C!=null){const e=navigator.getGamepads()[C];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let s=e.axes[0];Math.abs(e.axes[0])<=.01?s=0:e.axes[0]>=.7?s=1:e.axes[0]<=-.7&&(s=-1),i.force.y+=.004*t,i.force.x+=.004*s}i.force.x==0&&i.force.y==0&&((d.forward||d.forwardController)&&(i.force.y-=.004),(d.backward||d.backwardController)&&(i.force.y+=.004),(d.left||d.leftController)&&(i.force.x-=.004),(d.right||d.rightController)&&(i.force.x+=.004))}},ge=e=>e.x<-100||e.x>f.width+100||e.y<-100||e.y>f.height+100,Ne=()=>{i.hp-=1,Ro(),i.hp>=0&&ke(i.hp),i.hp<=0&&(we(),Zs(),de(0),k(Y,{position:{...i.position},frame:0}),setTimeout(()=>{oa()},1e3))},js=e=>{$s(),m.timePlayed+=e;for(const o of w){if(o.type==="homing"){const a=me(o.velocity),c=me(ae(i.position,o.position)),l=me(co(a,c,.002*e)),u=Math.sqrt(o.velocity.x**2+o.velocity.y**2);let y=l.x,A=l.y;const E=Math.sqrt(y**2+A**2);E>0&&(y/=E,A/=E),y*=u,A*=u,o.velocity.x=y,o.velocity.y=A}Z(o,e),ge(o.position)&&(o.remove=!0);for(const a of w)o!==a&&N(o,a,1,!0)&&Uo();if(o.type==="turret"&&!o.frozen){const a=o.bulletIndex%5===0?Oe*50:Oe;if(p-o.lastBulletTime>=a){const c={x:i.position.x-o.position.x,y:i.position.y-o.position.y},l=Math.sqrt(c.x**2+c.y**2);l>0&&(c.x/=l*2,c.y/=l*2);const u={x:o.position.x,y:o.position.y};bt(u,mo(c),c,0,!1),nt(),o.lastBulletTime=p,o.bulletIndex++}}}for(const o of R)if(Z(o,e),ge(o.position)&&(o.remove=!0),!o.disabled){if(o.friendly)for(const a of w)a.type==="armored"?N(o,a,1,!1)&&(m.bulletsHit++,o.velocity.x*=.1,o.velocity.y*=.1,o.angularVelocity=ye(.02),o.disabled=!0,Oo(),setTimeout(()=>{o.remove=!0},300)):N(o,a,1,!1)&&(m.bulletsHit++,m.damageDealt+=Math.min(a.hp,G),a.hp-=G,a.hp<=0&&(++m.asteroidsDestroyed,a.remove=!0,we()),o.remove=!0,Fo());else if(N(o,i,1,!1)&&(Ne(),o.remove=!0,i.hp<=0))break}for(const o of F)o.progress+=e/1e3*pt,go(o,o.progress,a=>{a.remove=!0,++m.asteroidsDestroyed,m.damageDealt+=a.hp,we()});for(const o of q)if(Z(o,e),ge(o.position)&&(o.remove=!0),fe(o,i))switch(o.remove=!0,_o(),o.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,5),ke(i.hp);break;case"damage":G+=1,As(G);break;case"rocket-piercing":ie+=1,Ss(ie);break}const t={...i.position};Z(i,e);const s={x:i.position.x-t.x,y:i.position.y-t.y},n=Math.sqrt(s.x**2+s.y**2);m.distanceTraveled+=n,de(Math.min(n/100,.05));for(const o of w)if(N(i,o,1,!0)&&(Ne(),i.hp<=0))break;if(C==null)!d.forward&&!d.backward&&!d.left&&!d.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const o=navigator.getGamepads()[C];Math.abs(o.axes[0])<.01&&Math.abs(o.axes[1])<.01&&!d.forward&&!d.backward&&!d.left&&!d.right&&!d.forwardController&&!d.backwardController&&!d.leftController&&!d.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>f.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,f.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>f.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,f.height)),i.velocity.y*=-1),zs()},zs=()=>{w.forEach(e=>{e.remove&&(M(X,e.id),e.frame=0,k(Y,e))}),R.forEach(e=>{e.remove&&M(P,e.id)}),F.forEach(e=>{e.remove&&(M(I,e.id),e.children.forEach(t=>{M(W,t.id)}))}),q.forEach(e=>{e.remove&&M(le,e.id)}),w=w.filter(e=>!e.remove),R=R.filter(e=>!e.remove),F=F.filter(e=>!e.remove),q=q.filter(e=>!e.remove)},ft=new Image;ft.src=Ho;const yt=new Image;yt.src=Wo;const wt=new Image;wt.src=No;const xt=new Image;xt.src=Go;const Js={default:ft,homing:yt,armored:wt,turret:xt},Xs=(e,t,s,n,o,a,c)=>{const l=O();if(l.position=e,l.rotation=t,l.acceleration=s,l.velocity=n,l.angularVelocity=o,l.mass=Bs(a,c),l.radius=c==="armored"?a*2:a,l.inertia=2/5*l.mass*a**2,l.hp=a/2,l.texture=Js[c],l.type=c,c==="turret"&&(l.lastBulletTime=p,l.bulletIndex=0),!fe(l,i)){for(const u of w)if(fe(l,u))return;k(X,l),w.push(l)}},bt=(e,t,s,n,o)=>{const a=O();a.position=e,a.rotation=t,a.velocity=s,a.angularVelocity=n,a.mass=mt,a.radius=5,a.inertia=2/5*a.mass*a.radius**2,a.friendly=o,k(P,a),R.push(a),++m.bulletsFired},Ys=(e,t,s,n,o)=>{const a=O();a.position=e,a.rotation=t,a.velocity=s,a.angularVelocity=n,a.mass=mt,a.radius=5,a.targets=o,a.progress=0,a.currentTarget=0,ho(a),fo(a),k(I,a),F.push(a),vt({x:-5,y:0},Math.PI/2,a),++m.rocketsFired},Ks=(e,t,s,n)=>{i=O(),i.position=e,i.rotation=t,i.velocity=s,i.angularVelocity=n,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const o=new Image;o.src=qo,i.texture=o,k(K,i),Ge({x:-5,y:18},0,H,jo,i),Ge({x:-5,y:-18},0,H,$o,i)},Ge=(e,t,s,n,o)=>{const a=O();a.position=e,a.rotation=t,a.parent=o,a.height=20,a.width=20,k(s,a);const c=new Image;c.src=n,a.texture=c,o.children??(o.children=o.children||[]),o.children.push(a),vt({x:-5,y:0},Math.PI/2,a)},vt=(e,t,s)=>{const n=O();n.position=e,n.rotation=t,n.parent=s,n.height=10,n.width=5,s.children??(s.children=s.children||[]),s.children.push(n),k(W,n)},Qs=(e,t,s,n,o)=>{const a=O();a.type=e,a.position=t,a.rotation=s,a.velocity=n,a.angularVelocity=o,a.radius=25,k(le,a),q.push(a)},Mt=()=>{h=!h,h?(dt(),de(0)):ne()},Zs=()=>{if(i){M(K,i.id);for(let e of i.children){M(H,e.id);for(let t of e.children)M(W,t.id)}}},ea=()=>{f.width=f.clientWidth,f.height=f.clientHeight,Ks({x:f.width/2,y:f.height/2},0,{x:0,y:0},0)},ta=()=>{ea(),ut(),Ee=requestAnimationFrame(gt)},oa=()=>{if(h)return;h=!0,cancelAnimationFrame(Ee),de(0),i=null;const e=st(!D,!x,_);Is(D,x,_,m,e),Ps(),ko(!D,!x,_)},sa=()=>{Eo(),Qt(),w=[],R=[],F=[],ve=1e3,ie=3,G=1,ke(5),ne(),xe()};Ns();
