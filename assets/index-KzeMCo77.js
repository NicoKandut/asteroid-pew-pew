(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const re=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Xe=(e,t)=>{e.x*=t,e.y*=t},q=e=>({x:Math.cos(e),y:Math.sin(e)}),ge=e=>Math.sqrt(e.x**2+e.y**2);let S=new Map;const Ye=2e3,N=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const a=N(o),s=Math.cos(a.rotation),n=Math.sin(a.rotation);return{x:a.x+t.x*s-t.y*n,y:a.y+t.x*n+t.y*s,rotation:a.rotation+t.rotation}},Qe=(e,t)=>{S[e]||(S[e]=[]);const o=performance.now();S[e].push({x:t.x,y:t.y,time:o}),S[e]=S[e].filter(a=>o-a.time<Ye)},Ze=e=>{delete S[e]},et=e=>{for(const t in S){const o=S[t];if(!(!o||o.length<2)){e.beginPath();for(let a=0;a<o.length;a++){const s=o[a];a===0?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},tt="/asteroid-pew-pew/img/boom/boom_0.gif",ot="/asteroid-pew-pew/img/boom/boom_1.gif",st="/asteroid-pew-pew/img/boom/boom_2.gif",at="/asteroid-pew-pew/img/boom/boom_3.gif",nt="/asteroid-pew-pew/img/boom/boom_4.gif",rt="/asteroid-pew-pew/img/boom/boom_5.gif",it="/asteroid-pew-pew/img/boom/boom_6.gif",ct="/asteroid-pew-pew/img/boom/boom_7.gif",lt="/asteroid-pew-pew/img/boom/boom_8.gif",dt="/asteroid-pew-pew/img/boom/boom_9.gif",mt="/asteroid-pew-pew/img/boom/boom_10.gif",ut="/asteroid-pew-pew/img/boom/boom_11.gif",ht="/asteroid-pew-pew/img/boom/boom_12.gif",gt="/asteroid-pew-pew/img/boom/boom_13.gif",pt="/asteroid-pew-pew/img/boom/boom_14.gif",A=document.getElementsByTagName("canvas")[0],r=A.getContext("2d"),H="asteroid",b="bullet",W="explosion",J="flash",M="rocket",G="spaceship",Se="velocity",R="spaceshippart",F="flames",ft="#ffffff",yt="#ffff00",j="#ff0000",pe="#00ff00";let wt=0;const xt=()=>`${wt++}`,k={[H]:{color:ft},[b]:{color:yt,length:10,strokeWidth:2},[M]:{color:j,radius:10},[G]:{color:pe},[Se]:{color:j},[R]:{color:pe},[F]:{color:j}},L={[F]:{},[G]:{},[R]:{},[H]:{},[b]:{},[M]:{},[W]:{},[J]:{}};let Le=!1,Q=!1,Ie=!1,Be=!1;const vt=e=>{Le=e},bt=e=>{Q=e},Mt=e=>{Ie=e},kt=e=>{Be=e},T=(e,t)=>{t.id=xt(),L[e][t.id]=t},E=(e,t)=>{delete L[e][t],Ze(t)},Et=()=>{for(const e in L)L[e]={}},u=[];for(let e=0;e<15;++e)u.push(new Image);u[0].src=tt;u[1].src=ot;u[2].src=st;u[3].src=at;u[4].src=nt;u[5].src=rt;u[6].src=it;u[7].src=ct;u[8].src=lt;u[9].src=dt;u[10].src=mt;u[11].src=ut;u[12].src=ht;u[13].src=gt;u[14].src=pt;const Tt=()=>{A.width=A.clientWidth,A.height=A.clientHeight,r.clearRect(0,0,A.width,A.height);for(const e in L)for(const t of Object.values(L[e])){switch(e){case H:Pt(t);break;case W:It(t);break;case b:St(t);break;case M:Lt(t);break;case G:case R:Bt(t);break;case F:At(t);break;case J:Dt(t);break}Qe(t.id,N(t))}if(Le){r.strokeStyle=k[Se].color,r.lineWidth=1,r.beginPath();for(const e in L){for(const t of Object.values(L[e]))if("velocity"in t){const{position:o,velocity:a}=t,{x:s,y:n}=o,{x:c,y:l}=a;r.moveTo(s,n),r.lineTo(s+c*200,n+l*200)}r.stroke()}}Ie&&et(r)},Pt=e=>{const{radius:t,texture:o}=e,a=N(e);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.drawImage(o,-t,-t,t*2,t*2),Q&&(r.strokeStyle=j,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),r.restore()},St=e=>{var s;const{length:t}=k[b],o=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;r.fillStyle=k[b].color,r.strokeStyle=k[b].color,r.lineWidth=(s=k[b])==null?void 0:s.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+a),r.lineTo(e.position.x-o,e.position.y-a),r.stroke()},Lt=e=>{var c;const{radius:t}=k[M],o=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},s={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},n={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=k[M].color,r.strokeStyle=k[M].color,r.lineWidth=((c=k[M])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(a.x,a.y),r.lineTo(s.x,s.y),r.lineTo(n.x,n.y),r.lineTo(a.x,a.y),r.stroke(),Be){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},It=e=>{r.translate(e.position.x,e.position.y);const a=u[e.frame];r.drawImage(a,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<u.length-1?e.frame++:E(W,e.id)},Bt=e=>{const{width:t,height:o,texture:a}=e,s=N(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(a,-t/2,-o/2,t,o),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},At=e=>{var B,ee,_;const{width:t,height:o}=e,a=N(e),s=((B=e==null?void 0:e.parent)==null?void 0:B.velocity)??{x:0,y:1},n=((_=(ee=e==null?void 0:e.parent)==null?void 0:ee.parent)==null?void 0:_.velocity)??{x:0,y:0},c={x:s.x+n.x,y:s.y+n.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.beginPath();const m=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+m)*l),r.lineTo(t,(o+m)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+m)*l),r.lineTo(t/2,(o/2+m)*l),r.closePath(),r.fillStyle="yellow",r.fill(),Q&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+m)),r.restore()},Dt=e=>{const t=e.position,o=e.rotation,a=3,s=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(a,a),r.lineTo(s,0),r.lineTo(a,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,a),r.lineTo(0,s),r.resetTransform(),r.closePath(),r.fill()},O=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),te=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Vt=(e,t,o)=>{e.force.x+=t.x,e.force.y+=t.y,e.torque+=o},Ae=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),fe=(e,t)=>Ae(e,t)<e.radius+t.radius,oe=(e,t,o,a)=>{if(e.frozen||t.frozen)return!1;const s=Ae(e,t);if(s>=e.radius+t.radius)return!1;const n={x:(t.position.x-e.position.x)/s,y:(t.position.y-e.position.y)/s},c=2*(e.velocity.x*n.x+e.velocity.y*n.y-t.velocity.x*n.x-t.velocity.y*n.y)/(e.mass+t.mass),l=e.radius+t.radius-s;a&&(e.position.x-=n.x*l,e.position.y-=n.y*l,t.position.x+=n.x*l,t.position.y+=n.y*l),e.velocity.x-=c*o*t.mass*n.x,e.velocity.y-=c*o*t.mass*n.y,t.velocity.x+=c*o*e.mass*n.x,t.velocity.y+=c*o*e.mass*n.y;const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return T(J,m),setTimeout(()=>E(J,m.id),100),!0},ye=10,Ut=30,we=(e,t,o,a,s)=>.5*(2*o+(-t+a)*e+(2*t-5*o+4*a-s)*e*e+(-t+3*o-3*a+s)*e*e*e),De=(e,t,o,a,s)=>({x:we(e,t.x,o.x,a.x,s.x),y:we(e,t.y,o.y,a.y,s.y)}),Ve=(e,t)=>{const o=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return De(t%1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position)},Ue=(e,t)=>Ve(e,Re(e,t)),Rt=e=>{e.arcLengthTable=[];let t=0,o=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*ye;++c){const l=c/ye,m=Ve(e,l),B=ge(re(m,o));t+=B,e.arcLengthTable.push({v:l,totalLength:t}),o=m}const a=e.targets.length-4,s=De(1,e.targets[a+0].position,e.targets[a+1].position,e.targets[a+2].position,e.targets[a+3].position),n=ge(re(s,o));t+=n,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},Ft=e=>-(Math.cos(Math.PI*e)-1)/2,Re=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const B=m.totalLength-l.totalLength;if(B===0){o=m.v;break}const _=(t-l.totalLength)/B;o=l.v*(1-_)+m.v*_;break}}const a=Math.floor(o),s=o-a,n=Ft(s);return a+n},Ot=(e,t,o)=>{const a=Ue(e,t);e.velocity=re(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const s=Math.max(Math.min(Math.floor(Re(e,t)),e.targets.length-3),0);if(s!==e.currentTarget&&(o(e.targets[s+1]),e.currentTarget=s),s>=e.targets.length-3){e.remove=!0;return}},_t=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=Ut)e.pathPoints.push(Ue(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},P=document.getElementsByTagName("canvas")[0],Ct=()=>({x:Math.random()*P.width,y:Math.random()*P.height}),Nt=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*P.width,y:-90};case 1:return{x:P.width+t,y:Math.random()*P.height};case 2:return{x:Math.random()*P.width,y:P.height+t};case 3:return{x:-90,y:Math.random()*P.height}}},Ht=e=>(Math.random()*2-1)*e,Wt=()=>{const e=[20,30,40];return e[Math.floor(Math.random()*e.length)]},x={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},Gt=JSON.stringify(x),Fe=(e,t)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default"),Oe=(e,t)=>{const o=Fe(e,t);return JSON.parse(localStorage.getItem(o)||Gt)},d={...x},qt=(e,t)=>{const o=Oe(e,t);o.timePlayed=Math.max(o.timePlayed,d.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,d.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,d.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,d.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,d.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,d.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,d.distanceTraveled),localStorage.setItem(Fe(e,t),JSON.stringify(o))},$t=()=>{d.timePlayed=x.timePlayed,d.asteroidsDestroyed=x.asteroidsDestroyed,d.damageDealt=x.damageDealt,d.bulletsFired=x.bulletsFired,d.bulletsHit=x.bulletsHit,d.rocketsFired=x.rocketsFired,d.distanceTraveled=x.distanceTraveled},jt="/asteroid-pew-pew/audio/propulsion.mp3",zt="/asteroid-pew-pew/audio/explosion.wav",Jt="/asteroid-pew-pew/audio/shoot.wav",Kt="/asteroid-pew-pew/audio/hurt.wav",_e="/asteroid-pew-pew/audio/hit.wav",Xt="/asteroid-pew-pew/audio/click.wav",Yt="/asteroid-pew-pew/audio/submit.wav",Qt="/asteroid-pew-pew/audio/CODEX_2015.mp3";let w=.5;const Zt=e=>{ue.volume=.05*e,w=e},Z=new Audio(jt);Z.volume=0;Z.loop=!0;document.addEventListener("keydown",()=>Z.play().catch(()=>{}),{once:!0});const K=e=>{Z.volume=Number(e)*w},C=()=>{const e=new Audio(Yt);e.volume=.5*w,e.play().catch(()=>{})},v=()=>{const e=new Audio(Xt);e.volume=.5*w,e.play().catch(()=>{})},eo=()=>{const e=new Audio(_e);e.volume=.1*w,e.play().catch(()=>{})},to=()=>{const e=new Audio(Kt);e.volume=.3*w,e.play().catch(()=>{})},oo=()=>{const e=new Audio(Jt);e.volume=.1*w,e.play().catch(()=>{})},so=()=>{const e=new Audio(_e);e.volume=.2*w,e.play().catch(()=>{})},se=()=>{const e=new Audio(zt);e.volume=.3*w,e.play().catch(()=>{})},ue=new Audio(Qt);ue.volume=.05*w;ue.loop=!0;const ao="/asteroid-pew-pew/img/Asteroid1.png",no="/asteroid-pew-pew/img/Spaceship.png",ro="/asteroid-pew-pew/img/WingLeft.png",io="/asteroid-pew-pew/img/WingRight.png";document.getElementsByTagName("canvas")[0];let co=document.getElementById("entity-count"),lo=document.getElementById("fps"),mo=document.getElementById("ups"),uo=document.getElementById("target-fps"),ho=document.getElementById("target-ups"),Ce=document.getElementById("pause-menu");const Ne=document.getElementById("main-menu"),go=document.getElementById("pause-resume"),po=document.getElementById("debug-velocity"),fo=document.getElementById("debug-hitbox"),yo=document.getElementById("debug-trajectory"),wo=document.getElementById("debug-spline-paths"),xo=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const xe=document.getElementById("hp"),He=document.getElementById("game-over"),vo=document.getElementById("time-played"),bo=document.getElementById("asteroids-destroyed"),Mo=document.getElementById("distance-traveled"),ko=document.getElementById("damage-dealt"),Eo=document.getElementById("start"),To=document.getElementById("restart"),Po=document.getElementById("volume"),So=document.getElementById("mode-pacifist"),Lo=document.getElementById("mode-stationary"),Io=document.getElementById("mark-pacifist"),Bo=document.getElementById("mark-stationary"),Ao=document.getElementById("back-to-main-menu"),Do=document.getElementById("pause-back-to-main-menu"),Vo=(e,t,o,a,s,n,c,l,m)=>{Uo(e,m,t,o),Fo(a,s,n,c,l),_o(e,m)},Uo=(e,t,o,a)=>{Eo.addEventListener("click",()=>{C(),Ro(),t(),e()}),So.addEventListener("change",s=>{v(),o(!s.target.checked)}),Lo.addEventListener("change",s=>{v(),a(!s.target.checked)})},We=()=>{Ne.style.display="grid"},Ro=()=>{Ne.style.display="none"},Fo=(e,t,o,a,s)=>{Po.addEventListener("input",n=>{e(n.target.value/100)}),uo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),t(1e3/n.target.value)}),ho.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),o(1e3/n.target.value)}),po.addEventListener("change",n=>{v(),vt(n.target.checked)}),fo.addEventListener("change",n=>{v(),bt(n.target.checked)}),yo.addEventListener("change",n=>{v(),Mt(n.target.checked)}),wo.addEventListener("change",n=>{v(),kt(n.target.checked)}),xo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),a(n.target.value)}),go.addEventListener("click",()=>{C(),X(),s()}),Do.addEventListener("click",()=>{C(),X(),We()})},Oo=()=>{Ce.style.display="flex"},X=()=>{Ce.style.display="none"},_o=(e,t)=>{To.addEventListener("click",()=>{C(),ie(),t(),e()}),Ao.addEventListener("click",()=>{C(),ie(),We()})},Co=()=>{He.style.display="grid"},ie=()=>{He.style.display="none"},No=(e,t,o,a)=>{Io.style.display=e?"none":"block",Bo.style.display=t?"none":"block",$(vo,(o.timePlayed/1e3).toFixed(1),(a.timePlayed/1e3).toFixed(1),"s"),$(bo,o.asteroidsDestroyed,a.asteroidsDestroyed),$(Mo,o.distanceTraveled.toFixed(1),a.distanceTraveled.toFixed(1),"m"),$(ko,o.damageDealt,a.damageDealt,"hp")},$=(e,t,o,a)=>{e.children.item(1).innerText=a?`${t} ${a}`:`${t}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${o} ${a}`:o} )`)},Ge=e=>{if(e==5)for(let t of xe.children)t.style.color="red";else xe.children.item(e).style.color="grey"},Ho=(e,t,o)=>{co.innerText=`${e}`,lo.innerText=`${t}`,mo.innerText=`${o}`};let p=document.getElementsByTagName("canvas")[0];const qe=2e3,Wo=3,Go=e=>4/3*Math.PI*e**3*3.5;let g=!0;const $e=()=>g=!1;let he,z=1e3/120;const qo=e=>z=e;let je=1e3/60;const $o=e=>je=e;let Y=0,ve=0,ce=0,U=!0;const jo=e=>U=e;let I=!0;const zo=e=>I=e;let ae=0,ne=0,f=[],D=[],V=[],i=null,be=0,le=!1,Me=0,Jo=40,de=!1,Ko=3e3,ke=0,ze=300;const Xo=e=>ze=e;let me=1e3,Ee=0;const Yo=e=>Math.pow(.99,e/1e3)*1e3;let h={forward:!1,backward:!1,left:!1,right:!1};const Qo=()=>{Y=performance.now(),ce=Y,Zo(),Vo(ds,jo,zo,Zt,$o,qo,Xo,$e,us)},Zo=()=>{document.addEventListener("keydown",e=>{switch(e.key){case"Escape":is();break;case" ":le=!g&&U;break;case"Shift":de=!g&&U;break;case"ArrowUp":case"w":h.forward=!g&&I;break;case"ArrowDown":case"s":h.backward=!g&&I;break;case"ArrowLeft":case"a":h.left=!g&&I;break;case"ArrowRight":case"d":h.right=!g&&I;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":le=!1;break;case"Shift":de=!1;break;case"ArrowUp":case"w":h.forward=!1;break;case"ArrowDown":case"s":h.backward=!1;break;case"ArrowLeft":case"a":h.left=!1;break;case"ArrowRight":case"d":h.right=!1;break}}),document.addEventListener("mousemove",e=>{if(g||i==null)return;const t=e.clientX-p.getBoundingClientRect().left,o=e.clientY-p.getBoundingClientRect().top,a=t-i.position.x,s=o-i.position.y;i.rotation=Math.atan2(s,a)})};let y=performance.now();const Je=()=>{for(y=performance.now();ve+z/2<=y;)g||(ts(z),++ae),ve+=z;if(Y+je/2<=y&&(g||(Tt(),++ne),Y=y),y-ce>=1e3){const e=f.length+D.length+V.length+(i?1:0);Ho(e,ne,ae),ne=0,ae=0,ce=y}he=requestAnimationFrame(Je)},es=e=>{if(le&&y-Me>=Jo&&i){const t=i.rotation+(Math.random()-.5)*.1,o=be%2===0?-1:1,a=q(i.rotation+Math.PI/2*o);a.x*=10,a.y*=10,a.x+=i.position.x,a.y+=i.position.y,as(a,t,q(t),0);const s=q(t+Math.PI);s.x*=.01,s.y*=.01,Vt(i,s,0),oo(),be++,Me=y}if(de&&y-ke>=Ko&&i){const t=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let o=0;o<Math.min(Wo,f.length);o++){let a;do a=f[Math.floor(Math.random()*f.length)];while(t.includes(a));a.frozen=!0,a.velocity.x=0,a.velocity.y=0,t.push(a)}t.push(i),ns({...i.position},i.rotation,Xe(q(i.rotation),.2),0,t),ke=y}if(y-Ee>=me){const t=Nt(),o=Ct(),a=Math.random()*Math.PI*2,s={x:o.x-t.x,y:o.y-t.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=Math.random()*.1+.1,s.y*=Math.random()*.1+.1;const c=Ht(.01),l=Wt();ss(t,a,{x:0,y:0},s,c,l),Ee=y,me=Yo(d.timePlayed)}i&&(h.forward&&(i.force.y-=.004),h.backward&&(i.force.y+=.004),h.left&&(i.force.x-=.004),h.right&&(i.force.x+=.004))},Te=e=>e.x<-100||e.x>p.width+100||e.y<-100||e.y>p.height+100,ts=e=>{es(),d.timePlayed+=e;for(const s of f){te(s,e),Te(s.position)&&(s.remove=!0);for(const n of f)s!==n&&oe(s,n,1,!0)&&eo()}for(const s of D){te(s,e),Te(s.position)&&(s.remove=!0);for(const n of f)oe(s,n,1,!1)&&(s.remove=!0,n.hp-=1,d.bulletsHit++,d.damageDealt++,so(),n.hp<=0&&(++d.asteroidsDestroyed,n.remove=!0,se()))}for(const s of V)s.progress+=e/1e3*ze,Ot(s,s.progress,n=>{n.remove=!0,++d.asteroidsDestroyed,d.damageDealt+=(n==null?void 0:n.hp)??0,se()});const t={...i.position};te(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},a=Math.sqrt(o.x**2+o.y**2);d.distanceTraveled+=a,K(Math.min(a/100,.05));for(const s of f)if(oe(i,s,1,!0)&&(i.hp-=1,to(),i.hp>=0&&Ge(i.hp),i.hp<=0)){se(),cs(),K(0),T(W,{position:{...i.position},frame:0}),setTimeout(()=>{ms()},1e3);break}!h.forward&&!h.backward&&!h.left&&!h.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3)),(i.position.x<0||i.position.x>p.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,p.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>p.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,p.height)),i.velocity.y*=-1),os()},os=()=>{f.forEach(e=>{e.remove&&(E(H,e.id),e.frame=0,T(W,e))}),D.forEach(e=>{e.remove&&E(b,e.id)}),V.forEach(e=>{e.remove&&(E(M,e.id),e.children.forEach(t=>{E(F,t.id)}))}),f=f.filter(e=>!e.remove),D=D.filter(e=>!e.remove),V=V.filter(e=>!e.remove)},ss=(e,t,o,a,s,n)=>{const c=O();c.position=e,c.rotation=t,c.acceleration=o,c.velocity=a,c.angularVelocity=s,c.mass=Go(n),c.radius=n,c.inertia=2/5*c.mass*n**2,c.hp=n/2;const l=new Image;if(l.src=ao,c.texture=l,!fe(c,i)){for(const m of f)if(fe(c,m))return;T(H,c),f.push(c)}},as=(e,t,o,a)=>{const s=O();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=qe,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,T(b,s),D.push(s),++d.bulletsFired},ns=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=a,n.mass=qe,n.radius=5,n.targets=s,n.progress=0,n.currentTarget=0,Rt(n),_t(n),T(M,n),V.push(n),Ke({x:-5,y:0},Math.PI/2,n),++d.rocketsFired},rs=(e,t,o,a)=>{i=O(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=a,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const s=new Image;s.src=no,i.texture=s,T(G,i),Pe({x:-5,y:18},0,R,io,i),Pe({x:-5,y:-18},0,R,ro,i)},Pe=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.parent=s,n.height=20,n.width=20,T(o,n);const c=new Image;c.src=a,n.texture=c,s.children??(s.children=s.children||[]),s.children.push(n),Ke({x:-5,y:0},1.5707964,n)},Ke=(e,t,o)=>{const a=O();a.position=e,a.rotation=t,a.parent=o,a.height=10,a.width=5,o.children??(o.children=o.children||[]),o.children.push(a),T(F,a)},is=()=>{g=!g,g?(Oo(),K(0)):X()},cs=()=>{if(i){E(G,i.id);for(let e of i.children){E(R,e.id);for(let t of e.children)E(F,t.id)}}},ls=()=>{p.width=p.clientWidth,p.height=p.clientHeight,rs({x:p.width/2,y:p.height/2},0,{x:0,y:0},0)},ds=()=>{ls(),$e(),he=requestAnimationFrame(Je)},ms=()=>{cancelAnimationFrame(he),g=!0,K(0),i=null;const e=Oe(!U,!I);No(U,I,d,e),Co(),qt(!U,!I)},us=()=>{$t(),Et(),f=[],D=[],V=[],me=1e3,Ge(5),X(),ie()};Qo();
