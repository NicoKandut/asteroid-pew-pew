(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();let F=new Map;const Xt=2e3,oe=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const a=oe(o),n=Math.cos(a.rotation),s=Math.sin(a.rotation);return{x:a.x+t.x*n-t.y*s,y:a.y+t.x*s+t.y*n,rotation:a.rotation+t.rotation}},Yt=(e,t)=>{F[e]||(F[e]=[]);const o=performance.now();F[e].push({x:t.x,y:t.y,time:o}),F[e]=F[e].filter(a=>o-a.time<Xt)},Jt=e=>{delete F[e]},Kt=e=>{for(const t in F){const o=F[t];if(!(!o||o.length<2)){e.beginPath();for(let a=0;a<o.length;a++){const n=o[a];a===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},Qt="/asteroid-pew-pew/img/boom/boom_0.gif",Zt="/asteroid-pew-pew/img/boom/boom_1.gif",eo="/asteroid-pew-pew/img/boom/boom_2.gif",to="/asteroid-pew-pew/img/boom/boom_3.gif",oo="/asteroid-pew-pew/img/boom/boom_4.gif",so="/asteroid-pew-pew/img/boom/boom_5.gif",no="/asteroid-pew-pew/img/boom/boom_6.gif",ao="/asteroid-pew-pew/img/boom/boom_7.gif",ro="/asteroid-pew-pew/img/boom/boom_8.gif",io="/asteroid-pew-pew/img/boom/boom_9.gif",co="/asteroid-pew-pew/img/boom/boom_10.gif",lo="/asteroid-pew-pew/img/boom/boom_11.gif",mo="/asteroid-pew-pew/img/boom/boom_12.gif",uo="/asteroid-pew-pew/img/boom/boom_13.gif",ho="/asteroid-pew-pew/img/boom/boom_14.gif",go="/asteroid-pew-pew/img/ice.png",po="/asteroid-pew-pew/img/powerup.png",ut=5,ze=.7,U=10;function fo(e,t){const o=[];for(let a=0;a<ut;a++){const n=Math.random()*2*Math.PI,s=Math.sqrt(Math.random())*t,c=Math.cos(n)*s,d=Math.sin(n)*s,l=ze*e.x,u=ze*e.y,g=l+c,v=u+d;g*g+v*v<=Math.pow(t,2)?o.push({x:g,y:v}):a--}return o}function yo(e,t){const{position:o,rotation:a,fractureSeeds:n}=t,s=Math.cos(a),c=Math.sin(a);e.fillStyle="red";for(const d of n){const l={x:o.x+d.x*s-d.y*c,y:o.y+d.x*c+d.y*s};e.beginPath(),e.arc(l.x,l.y,2,0,Math.PI*2),e.fill()}}function xo(e,t){const o=t.position.x-e.position.x,a=t.position.y-e.position.y,n=Math.sin(-e.rotation),s=Math.cos(-e.rotation);return{x:o*s-a*n,y:o*n+a*s}}function wo(e,t=null){const{fractureSeeds:o,radius:a}=e,n=a*2,s=a*2,c=new Uint8Array(n*s),d=document.createElement("canvas");d.width=n,d.height=s;const l=d.getContext("2d"),u=l.getImageData(0,0,n,s),g=u.data,v=n/2,f=s/2;for(let y=0;y<s;y++)for(let x=0;x<n;x++){const k=x-v,J=y-f;if(k*k+J*J>a*a)continue;let K=1/0,ie=-1;for(let le=0;le<o.length;le++){const We=o[le];let Se=x-v-We.x,Le=y-f-We.y;if(t){const $e=t(x,y);Se+=($e-.5)*10,Le+=($e-.5)*10}const Ge=Se*Se+Le*Le;Ge<K&&(K=Ge,ie=le)}c[y*n+x]=ie;const Ie=Math.sqrt(K),Pe=Math.min(1,Ie/a),ce=(y*n+x)*4,[$t,zt,jt]=bo(Pe);g[ce]=$t,g[ce+1]=zt,g[ce+2]=jt,g[ce+3]=255}return l.putImageData(u,0,0),{heatMap:d,cellMap:c}}function bo(e){if(e=Math.max(0,Math.min(1,e)),e<.33){const t=e/.33;return[255,Math.round(255*t),0]}else if(e<.66){const t=(e-.33)/.33;return[Math.round(255*(1-t)),255,0]}else{const t=(e-.66)/.34;return[0,Math.round(255*(1-t)),Math.round(255*t)]}}function vo(e){const t=e.radius*2,o=e.radius*2,a=new Float32Array(o*t),n=Math.floor(o/U)+2,s=Math.floor(t/U)+2,c=[];for(let l=0;l<s*n;l++)c.push(Math.random());for(let l=0;l<t;l++)for(let u=0;u<o;u++){const g=Math.floor(u/U),v=Math.floor(l/U),f=u%U/U,y=l%U/U,x=v*n+g,k=c[x],J=c[x+1],K=c[x+n],ie=c[x+n+1],Ie=k*(1-f)+J*f,Pe=K*(1-f)+ie*f;a[l*o+u]=Ie*(1-y)+Pe*y}return(l,u)=>a[u*o+l]}function Mo(e,t,o){const a=[],n=o.radius*2,s=o.radius*2;t.length!==n*s&&console.error("Cell map size mismatch");for(let c=0;c<ut;c++){const d=document.createElement("canvas");d.width=n,d.height=s;const l=d.getContext("2d"),u=l.createImageData(n,s);let g=u.data;const y=e.getContext("2d").getImageData(0,0,n,s).data;for(let x=0;x<t.length;x++){if(t[x]!==c)continue;const k=x*4;g[k]=y[k],g[k+1]=y[k+1],g[k+2]=y[k+2],g[k+3]=y[k+3]}l.putImageData(u,0,0),a.push(d)}return a}const N=document.getElementsByTagName("canvas")[0],r=N.getContext("2d"),se="asteroid",B="bullet",ne="explosion",fe="flash",V="rocket",ae="spaceship",ht="velocity",X="spaceshippart",Y="flames",ke="powerup",ko="#ffffff",Eo="#ffff00",he="#ff0000",je="#00ff00";let To=0;const Io=()=>`${To++}`,D={[se]:{color:ko},[B]:{color:Eo,length:10,strokeWidth:2},[V]:{color:he,radius:10},[ae]:{color:je},[ht]:{color:he},[X]:{color:je},[Y]:{color:he}},H={[Y]:{},[ae]:{},[X]:{},[se]:{},[B]:{},[V]:{},[ne]:{},[fe]:{},[ke]:{}};let gt=!1,re=!1,pt=!1,ft=!1,yt=!1;const Po=e=>{gt=e},So=e=>{re=e},Lo=e=>{pt=e},Ao=e=>{ft=e},Bo=e=>{yt=e},L=(e,t)=>{t.id=Io(),H[e][t.id]=t},S=(e,t)=>{delete H[e][t],Jt(t)},Vo=()=>{for(const e in H)H[e]={}},b=[];for(let e=0;e<15;++e)b.push(new Image);b[0].src=Qt;b[1].src=Zt;b[2].src=eo;b[3].src=to;b[4].src=oo;b[5].src=so;b[6].src=no;b[7].src=ao;b[8].src=ro;b[9].src=io;b[10].src=co;b[11].src=lo;b[12].src=mo;b[13].src=uo;b[14].src=ho;const xt=new Image;xt.src=go;const Do=()=>{N.width=N.clientWidth,N.height=N.clientHeight,r.clearRect(0,0,N.width,N.height);for(const e in H)for(const t of Object.values(H[e])){switch(e){case se:Co(t);break;case ne:Fo(t);break;case B:Uo(t);break;case V:Ro(t);break;case ae:case X:Ho(t);break;case Y:Oo(t);break;case fe:_o(t);break;case ke:qo(t);break}Yt(t.id,oe(t))}if(gt){r.strokeStyle=D[ht].color,r.lineWidth=1,r.beginPath();for(const e in H){for(const t of Object.values(H[e])){if("velocity"in t){const{position:o,velocity:a}=t,{x:n,y:s}=o,{x:c,y:d}=a;r.moveTo(n,s),r.lineTo(n+c*200,s+d*100)}if("angularVelocity"in t){const{position:o,angularVelocity:a}=t,{x:n,y:s}=o;a>0?(r.moveTo(n+20,s),r.arc(n,s,20,0,a*300)):(r.moveTo(n+20*Math.cos(a*300),s+20*Math.sin(a*300)),r.arc(n,s,20,a*300,0))}}r.stroke()}}pt&&Kt(r)},Co=e=>{const{radius:t,texture:o,textureReady:a}=e;if(!a)return;const n=oe(e);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.drawImage(o,-t,-t,t*2,t*2),re&&(r.strokeStyle=he,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(xt,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore(),yt&&yo(r,e)},Uo=e=>{var n;const{length:t}=D[B],o=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?D[B].color:"red",r.strokeStyle=e.friendly?D[B].color:"red",r.lineWidth=(n=D[B])==null?void 0:n.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+a),r.lineTo(e.position.x-o,e.position.y-a),r.stroke()},Ro=e=>{var c;const{radius:t}=D[V],o=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},n={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},s={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=D[V].color,r.strokeStyle=D[V].color,r.lineWidth=((c=D[V])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(a.x,a.y),r.lineTo(n.x,n.y),r.lineTo(s.x,s.y),r.lineTo(a.x,a.y),r.stroke(),ft){for(const d of e.targets)r.moveTo(d.position.x,d.position.y),r.arc(d.position.x,d.position.y,4,0,2*Math.PI);r.fill(),r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const d of e.pathPoints)r.lineTo(d.x,d.y),r.arc(d.x,d.y,2,0,2*Math.PI),r.moveTo(d.x,d.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},Fo=e=>{r.translate(e.position.x,e.position.y);const a=b[e.frame];r.drawImage(a,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<b.length-1?e.frame++:S(ne,e.id)},Ho=e=>{const{width:t,height:o,texture:a,textureReady:n}=e;if(!n)return;const s=oe(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(a,-t/2,-o/2,t,o),re&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},Oo=e=>{var u,g,v;const{width:t,height:o}=e,a=oe(e),n=((u=e==null?void 0:e.parent)==null?void 0:u.velocity)??{x:0,y:1},s=((v=(g=e==null?void 0:e.parent)==null?void 0:g.parent)==null?void 0:v.velocity)??{x:0,y:0},c={x:n.x+s.x,y:n.y+s.y},d=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.beginPath();const l=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+l)*d),r.lineTo(t,(o+l)*d),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+l)*d),r.lineTo(t/2,(o/2+l)*d),r.closePath(),r.fillStyle="yellow",r.fill(),re&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+l)),r.restore()},_o=e=>{const t=e.position,o=e.rotation,a=3,n=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(a,a),r.lineTo(n,0),r.lineTo(a,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,a),r.lineTo(0,n),r.resetTransform(),r.closePath(),r.fill()},wt=new Image;wt.src=po;const qo=e=>{const{radius:t}=e,o=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(wt,-t,-t,o,o),re&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,o,o)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("🧡",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.textAlign="center",r.font="20px Arial",r.fillText("🚀",0,7);break}r.restore()},q=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null,fractureSeeds:[],textureReady:!1}),de=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},bt=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),Ue=(e,t)=>bt(e,t)<e.radius+t.radius,j=(e,t,o,a)=>{const n=bt(e,t);if(n>=e.radius+t.radius)return!1;const s={x:(t.position.x-e.position.x)/n,y:(t.position.y-e.position.y)/n},c=2*(e.velocity.x*s.x+e.velocity.y*s.y-t.velocity.x*s.x-t.velocity.y*s.y)/(e.mass+t.mass),d=e.radius+t.radius-n;a&&(e.position.x-=s.x*d,e.position.y-=s.y*d,t.position.x+=s.x*d,t.position.y+=s.y*d),e.frozen||(e.velocity.x-=c*o*t.mass*s.x,e.velocity.y-=c*o*t.mass*s.y),t.frozen||(t.velocity.x+=c*o*e.mass*s.x,t.velocity.y+=c*o*e.mass*s.y);const l={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return L(fe,l),setTimeout(()=>S(fe,l.id),100),!0},Ae=e=>{const t=Math.sqrt(e.x**2+e.y**2);return{x:e.x/t,y:e.y/t}},ye=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),No=(e,t)=>{e.x*=t,e.y*=t},Wo=(e,t,o)=>({x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}),Be=e=>({x:Math.cos(e),y:Math.sin(e)}),Go=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},Xe=e=>Math.sqrt(e.x**2+e.y**2),me=100,$o=10,Ye=(e,t,o,a,n)=>.5*(2*o+(-t+a)*e+(2*t-5*o+4*a-n)*e*e+(-t+3*o-3*a+n)*e*e*e),vt=(e,t,o,a,n)=>({x:Ye(e,t.x,o.x,a.x,n.x),y:Ye(e,t.y,o.y,a.y,n.y)}),Mt=(e,t,o)=>vt(o,e.targets[t+0].position,e.targets[t+1].position,e.targets[t+2].position,e.targets[t+3].position),kt=(e,t)=>{const o=Et(e,t),a=e.targets.length-3,n=o*a;let s=Math.floor(n),c=n-s;return s>=a&&(s-=1,c=1),Mt(e,s,c)},zo=e=>{e.arcLengthTable=[];let t=0,o=0,a=e.targets[1].position;const n=e.targets.length-3;for(let l=0;l<n;++l)for(let u=0;u<me;++u){const g=u/me,v=Mt(e,l,g),f=Xe(ye(v,a));o+=f,e.arcLengthTable.push({v:t,totalLength:o}),a=v,t=(l*me+u)/(me*n)}const s=e.targets.length-4,c=vt(1,e.targets[s+0].position,e.targets[s+1].position,e.targets[s+2].position,e.targets[s+3].position),d=Xe(ye(c,a));o+=d,e.arcLengthTable.push({v:1,totalLength:o})},jo=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,Et=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let a=1;a<e.arcLengthTable.length;++a){const n=e.arcLengthTable[a-1],s=e.arcLengthTable[a];if(t<s.totalLength){const c=s.totalLength-n.totalLength;if(c===0){o=s.v;break}const l=(t-n.totalLength)/c;o=n.v*(1-l)+s.v*l;break}}return Math.min(1,Math.max(0,jo(o)))},Xo=(e,t,o)=>{const a=kt(e,t);e.velocity=ye(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const n=Math.max(Math.floor(Et(e,t)*(e.targets.length-3)),0);if(n!==e.currentTarget&&(o(e.targets[n+1]),e.currentTarget=n),n>=e.targets.length-3){e.remove=!0;return}},Yo=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=$o)e.pathPoints.push(kt(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},R=document.getElementsByTagName("canvas")[0],Tt=()=>({x:Math.random()*R.width,y:Math.random()*R.height}),Je=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*R.width,y:-90};case 1:return{x:R.width+t,y:Math.random()*R.height};case 2:return{x:Math.random()*R.width,y:R.height+t};case 3:return{x:-90,y:Math.random()*R.height}}},xe=e=>(Math.random()*2-1)*e,Jo=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},Ko=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],o=Math.random();for(let a=0;a<e.length;a++)if(o<t[a])return e[a];return e[e.length-1]},It=(e,t)=>{const o=Math.random();let a=0;for(let n=0;n<t.length;n++)if(a+=t[n],o<a)return e[n];return e[t.length-1]},Qo=()=>It(["default","homing","armored","turret"],[.85,.05,.05,.05]),Zo=()=>It(["homing","armored","turret"],[.34,.33,.33]),A={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},es=JSON.stringify(A),Pt=(e,t,o,a)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(o?"-extreme":"-default")+(a?"-hitless":"-default"),St=(e,t,o,a)=>{const n=Pt(e,t,o,a);return JSON.parse(localStorage.getItem(n)||es)},h={...A},ts=(e,t,o,a)=>{const n=St(e,t,o,a);n.timePlayed=Math.max(n.timePlayed,h.timePlayed),n.asteroidsDestroyed=Math.max(n.asteroidsDestroyed,h.asteroidsDestroyed),n.damageDealt=Math.max(n.damageDealt,h.damageDealt),n.bulletsFired=Math.max(n.bulletsFired,h.bulletsFired),n.bulletsHit=Math.max(n.bulletsHit,h.bulletsHit),n.rocketsFired=Math.max(n.rocketsFired,h.rocketsFired),n.distanceTraveled=Math.max(n.distanceTraveled,h.distanceTraveled),localStorage.setItem(Pt(e,t,o),JSON.stringify(n))},os=()=>{h.timePlayed=A.timePlayed,h.asteroidsDestroyed=A.asteroidsDestroyed,h.damageDealt=A.damageDealt,h.bulletsFired=A.bulletsFired,h.bulletsHit=A.bulletsHit,h.rocketsFired=A.rocketsFired,h.distanceTraveled=A.distanceTraveled},ss="/asteroid-pew-pew/audio/propulsion.mp3",ns="/asteroid-pew-pew/audio/explosion.wav",as="/asteroid-pew-pew/audio/shoot.wav",rs="/asteroid-pew-pew/audio/hurt.wav",Lt="/asteroid-pew-pew/audio/hit.wav",is="/asteroid-pew-pew/audio/click.wav",cs="/asteroid-pew-pew/audio/submit.wav",ls="/asteroid-pew-pew/audio/powerup.wav",ds="/asteroid-pew-pew/audio/CODEX_2015.mp3",ms="/asteroid-pew-pew/audio/armorHit.wav";let P=.5;const us=e=>{Oe.volume=.05*e,P=e},Ee=new Audio(ss);Ee.volume=0;Ee.loop=!0;document.addEventListener("keydown",()=>Ee.play().catch(()=>{}),{once:!0});const Te=e=>{Ee.volume=e*P},Z=()=>{const e=new Audio(cs);e.volume=.5*P,e.play().catch(()=>{})},T=()=>{const e=new Audio(is);e.volume=.5*P,e.play().catch(()=>{})},hs=()=>{const e=new Audio(Lt);e.volume=.1*P,e.play().catch(()=>{})},gs=()=>{const e=new Audio(rs);e.volume=.3*P,e.play().catch(()=>{})},At=()=>{const e=new Audio(as);e.volume=.1*P,e.play().catch(()=>{})},Ke=()=>{const e=new Audio(Lt);e.volume=.2*P,e.play().catch(()=>{})},ps=()=>{const e=new Audio(ms);e.volume=.2*P,e.play().catch(()=>{})},ge=()=>{const e=new Audio(ns);e.volume=.3*P,e.play().catch(()=>{})},fs=()=>{const e=new Audio(ls);e.volume=.2*P,e.play().catch(()=>{})},Oe=new Audio(ds);Oe.volume=.05*P;Oe.loop=!0;const Qe="/asteroid-pew-pew/img/Asteroid1.png",ys="/asteroid-pew-pew/img/asteroid_red.png",xs="/asteroid-pew-pew/img/asteroid_armored.png",ws="/asteroid-pew-pew/img/asteroid_green.png",bs="/asteroid-pew-pew/img/Spaceship.png",vs="/asteroid-pew-pew/img/WingLeft.png",Ms="/asteroid-pew-pew/img/WingRight.png";let ks=document.getElementById("entity-count"),Es=document.getElementById("fps"),Ts=document.getElementById("ups"),Is=document.getElementById("target-fps"),Ps=document.getElementById("target-ups"),Bt=document.getElementById("pause-menu");const Vt=document.getElementById("main-menu"),Ss=document.getElementById("pause-resume"),Ls=document.getElementById("debug-velocity"),As=document.getElementById("debug-hitbox"),Bs=document.getElementById("debug-trajectory"),Vs=document.getElementById("debug-spline-paths"),Ds=document.getElementById("debug-rocket-speed"),Cs=document.getElementById("debug-draw-seeds");document.getElementById("fire-rate");const Us=document.getElementById("rocket-piercing"),Rs=document.getElementById("bullet-damage"),we=document.getElementById("hp"),Dt=document.getElementById("game-over"),Fs=document.getElementById("time-played"),Hs=document.getElementById("asteroids-destroyed"),Os=document.getElementById("distance-traveled"),_s=document.getElementById("damage-dealt"),qs=document.getElementById("start"),Ns=document.getElementById("restart"),Ws=document.getElementById("volume"),Gs=document.getElementById("mode-pacifist"),$s=document.getElementById("mode-stationary"),zs=document.getElementById("mode-extreme"),js=document.getElementById("mode-hitless"),Xs=document.getElementById("mark-pacifist"),Ys=document.getElementById("mark-stationary"),Js=document.getElementById("mark-extreme"),Ks=document.getElementById("mark-hitless"),Qs=document.getElementById("back-to-main-menu"),Zs=document.getElementById("pause-back-to-main-menu"),Ze=document.getElementById("controls-move"),et=document.getElementById("controls-bullet"),tt=document.getElementById("controls-rocket"),en=(e,t,o,a,n,s,c,d,l,u,g)=>{tn(e,l,t,o,u,g),sn(a,n,s,c,d),nn(e,l)},tn=(e,t,o,a,n,s)=>{qs.addEventListener("click",()=>{Z(),on(),t(),e()}),Gs.addEventListener("change",c=>{T(),o(!c.target.checked),c.target.checked?(et.setAttribute("disabled","true"),tt.setAttribute("disabled","true")):(et.removeAttribute("disabled"),tt.removeAttribute("disabled"))}),$s.addEventListener("change",c=>{T(),a(!c.target.checked),c.target.checked?Ze.setAttribute("disabled","true"):Ze.removeAttribute("disabled")}),zs.addEventListener("change",c=>{T(),n(c.target.checked)}),js.addEventListener("change",c=>{T(),s(c.target.checked)})},Ct=()=>{Vt.style.display="grid"},on=()=>{Vt.style.display="none"},sn=(e,t,o,a,n)=>{Ws.addEventListener("input",s=>{e(s.target.value/100)}),Is.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),t(1e3/s.target.value)}),Ps.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),o(1e3/s.target.value)}),Ls.addEventListener("change",s=>{T(),Po(s.target.checked)}),As.addEventListener("change",s=>{T(),So(s.target.checked)}),Bs.addEventListener("change",s=>{T(),Lo(s.target.checked)}),Vs.addEventListener("change",s=>{T(),Ao(s.target.checked)}),Cs.addEventListener("change",s=>{T(),Bo(s.target.checked)}),Ds.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),a(s.target.value)}),Ss.addEventListener("click",()=>{Z(),be(),n()}),Zs.addEventListener("click",()=>{Z(),be(),Ct()})},Ut=()=>{Bt.style.display="flex"},be=()=>{Bt.style.display="none"},nn=(e,t)=>{Ns.addEventListener("click",()=>{Z(),Re(),t(),e()}),Qs.addEventListener("click",()=>{Z(),Re(),Ct()})},an=()=>{Dt.style.display="grid"},Re=()=>{Dt.style.display="none"},rn=(e,t,o,a,n,s)=>{Xs.style.display=e?"none":"block",Ys.style.display=t?"none":"block",Js.style.display=o?"block":"none",Ks.style.display=a?"block":"none",ue(Fs,n.timePlayed/1e3,s.timePlayed/1e3,"s",1),ue(Hs,n.asteroidsDestroyed,s.asteroidsDestroyed),ue(Os,n.distanceTraveled,s.distanceTraveled,"m",1),ue(_s,n.damageDealt,s.damageDealt,"hp",0)},ue=(e,t,o,a,n)=>{e.children.item(1).innerText=a?`${t.toFixed(n)} ${a}`:`${t.toFixed(n)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${o.toFixed(n)} ${a}`:o.toFixed(n)} )`)},cn=e=>{Us.innerText=`${e}`},ln=e=>{Rs.innerText=e.toFixed(1)},_e=e=>{for(let t=0;t<we.children.length;t++)we.children.item(t).style.color=t<e?"red":"grey"},dn=e=>{we.innerHTML="";for(let t=0;t<e;t++){const o=document.createElement("li");o.innerText="❤",o.style.color="red",we.appendChild(o)}},mn=(e,t,o)=>{ks.innerText=`${e}`,Es.innerText=`${t}`,Ts.innerText=`${o}`};let M=document.getElementsByTagName("canvas")[0],_=null;const Rt=2e3,un=(e,t)=>{const o=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*o};let p=!0;const Ft=()=>p=!1;let qe,pe=1e3/120;const hn=e=>pe=e;let Ht=1e3/60;const gn=e=>Ht=e;let ve=0,ot=0,Fe=0,O=!0;const pn=e=>O=e;let I=!0;const fn=e=>I=e;let Ve=0,De=0,st=0,E=[],G=[],$=[],i=null,Q=[],W=1,nt=0,ee=!1,at=0,yn=40,rt=80,Me=3,te=!1,xn=3e3,it=0,Ot=300;const wn=e=>Ot=e;let He=1e3,ct=0;const bn=e=>Math.pow(.99,e/1e3)*1e3;let z=!1;const vn=e=>z=e;let C=!1;const Mn=e=>{C=e};let kn=1e4,lt=0,m={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const En=()=>{document.getElementById("version").innerText="0.3.0",ve=performance.now(),Fe=ve,In(),en(Rn,pn,fn,us,gn,hn,wn,Ft,Hn,vn,Mn)},Tn=e=>{if(_==null)return;const t=navigator.getGamepads()[_];t.buttons[9].value>=.5&&e-300>=st&&(Gt(),st=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?ee=!p&&O:ee=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?te=!p&&O:te=!1,t.buttons[12].pressed?m.forwardController=!p&&I:m.forwardController=!1,t.buttons[13].pressed?m.backwardController=!p&&I:m.backwardController=!1,t.buttons[14].pressed?m.leftController=!p&&I:m.leftController=!1,t.buttons[15].pressed?m.rightController=!p&&I:m.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},In=()=>{window.addEventListener("gamepadconnected",e=>{_=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{_=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":Gt();break;case" ":ee=!p&&O;break;case"Shift":te=!p&&O;break;case"ArrowUp":case"w":case"W":m.forward=!p&&I;break;case"ArrowDown":case"s":case"S":m.backward=!p&&I;break;case"ArrowLeft":case"a":case"A":m.left=!p&&I;break;case"ArrowRight":case"d":case"D":m.right=!p&&I;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":ee=!1;break;case"Shift":te=!1;break;case"ArrowUp":case"w":case"W":m.forward=!1;break;case"ArrowDown":case"s":case"S":m.backward=!1;break;case"ArrowLeft":case"a":case"A":m.left=!1;break;case"ArrowRight":case"d":case"D":m.right=!1;break}}),document.addEventListener("mousemove",e=>{if(p||i==null)return;const t=e.clientX-M.getBoundingClientRect().left,o=e.clientY-M.getBoundingClientRect().top,a=t-i.position.x,n=o-i.position.y;i.rotation=Math.atan2(n,a)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(p=!0,Ut())})};let w=performance.now();const _t=()=>{for(w=performance.now(),Tn(w);ot+pe/2<=w;)p||(Sn(pe),++Ve),ot+=pe;if(ve+Ht/2<=w&&(p||(Do(),++De),ve=w),w-Fe>=1e3){const e=E.length+G.length+$.length+(i?1:0);mn(e,De,Ve),De=0,Ve=0,Fe=w}qe=requestAnimationFrame(_t)},Pn=()=>{if(ee&&w-at>=yn&&i){const e=i.rotation+(Math.random()-.5)*.1,t=nt%2===0?-1:1,o=Be(i.rotation+Math.PI/2*t);o.x*=10,o.y*=10,o.x+=i.position.x,o.y+=i.position.y,Nt(o,e,Be(e),0,!0),At(),nt++,at=w}if(te&&w-it>=xn&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*1e3,y:i.position.y-Math.sin(i.rotation)*1e3}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(Me,E.length);t++){let o;do o=E[Math.floor(Math.random()*E.length)];while(e.includes(o));o.frozen=!0,o.velocity.x=0,o.velocity.y=0,e.push(o)}e.push(e.at(-1)),Bn({...i.position},i.rotation,No(Be(i.rotation),.2),0,e),it=w}if(w-ct>=He){const e=Je(),t=Tt(),o=Math.random()*Math.PI*2,a={x:t.x-e.x,y:t.y-e.y},n=Math.sqrt(a.x**2+a.y**2);n>0&&(a.x/=n,a.y/=n),a.x*=Math.random()*.1+.1,a.y*=Math.random()*.1+.1,z&&(a.x*=2,a.y*=2);const s=xe(.005),c=Jo(h.timePlayed),d=z?Zo():Qo();qt(e,o,{x:0,y:0},a,s,c,d),ct=w,He=bn(h.timePlayed)}if(w-lt>=kn){const e=Je(),t={x:M.width/2+(Math.random()-.5)*400,y:M.height/2+(Math.random()-.5)*400},o={x:t.x-e.x,y:t.y-e.y},a=Math.sqrt(o.x**2+o.y**2);a>0&&(o.x/=a,o.y/=a),o.x*=.1,o.y*=.1;const n=xe(.005),s=Ko();Dn(s,e,0,o,n),lt=w}if(i){if(_!=null){const e=navigator.getGamepads()[_];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let o=e.axes[0];Math.abs(e.axes[0])<=.01?o=0:e.axes[0]>=.7?o=1:e.axes[0]<=-.7&&(o=-1),i.force.y+=.004*t,i.force.x+=.004*o}i.force.x==0&&i.force.y==0&&((m.forward||m.forwardController)&&(i.force.y-=.004),(m.backward||m.backwardController)&&(i.force.y+=.004),(m.left||m.leftController)&&(i.force.x-=.004),(m.right||m.rightController)&&(i.force.x+=.004))}},Ce=e=>e.x<-100||e.x>M.width+100||e.y<-100||e.y>M.height+100,dt=()=>{i.hp-=1,gs(),i.hp>=0&&_e(i.hp),i.hp<=0&&(ge(),Cn(),Te(0),L(ne,{position:{...i.position},frame:0}),setTimeout(()=>{Fn()},1e3))},Sn=e=>{Pn(),h.timePlayed+=e;for(const t of E){if(t.type==="homing"){const o=Ae(t.velocity),a=Ae(ye(i.position,t.position)),n=Ae(Wo(o,a,.002*e)),s=Math.sqrt(t.velocity.x**2+t.velocity.y**2);let c=n.x,d=n.y;const l=Math.sqrt(c**2+d**2);l>0&&(c/=l,d/=l),c*=s,d*=s,t.velocity.x=c,t.velocity.y=d}de(t,e),Ce(t.position)&&(t.remove=!0);for(const o of E)t!==o&&j(t,o,1,!0)&&hs();if(t.type==="turret"&&!t.frozen){const o=t.bulletIndex%5===0?rt*50:rt;if(w-t.lastBulletTime>=o){const a={x:i.position.x-t.position.x,y:i.position.y-t.position.y},n=Math.sqrt(a.x**2+a.y**2);n>0&&(a.x/=n*2,a.y/=n*2);const s={x:t.position.x,y:t.position.y};Nt(s,Go(a),a,0,!1),At(),t.lastBulletTime=w,t.bulletIndex++}}}for(const t of G)if(de(t,e),Ce(t.position)&&(t.remove=!0),!t.disabled){if(t.friendly)for(const o of E)if(o.type==="armored")j(t,o,1,!1)&&(h.bulletsHit++,t.velocity.x*=.1,t.velocity.y*=.1,t.angularVelocity=xe(.02),t.disabled=!0,ps(),setTimeout(()=>{t.remove=!0},300));else if(o.type==="split"){if(j(t,o,1,!1)){console.log("Test"),h.bulletsHit++,h.damageDealt+=Math.min(o.hp,W),o.hp-=W,o.fractureSeeds=fo(xo(o,t),o.radius);const a=vo(o),n=wo(o,a);if(o.hp<=0){++h.asteroidsDestroyed,o.remove=!0,ge();const s=Mo(o.texture,n.cellMap,o);for(let c=0;c<s.length;c++){const d=s[c],u=q().position,g=Tt(),v=Math.random()*Math.PI*2,f={x:g.x-u.x,y:g.y-u.y},y=Math.sqrt(f.x**2+f.y**2);y>0&&(f.x/=y,f.y/=y),f.x*=Math.random()*.1+.1,f.y*=Math.random()*.1+.1,z&&(f.x*=2,f.y*=2);const x=xe(.005);qt(u,v,{x:0,y:0},f,x,40,"default",d)}}t.remove=!0,Ke(),console.log(o.fractureSeeds)}}else j(t,o,1,!1)&&(h.bulletsHit++,h.damageDealt+=Math.min(o.hp,W),o.hp-=W,o.hp<=0&&(++h.asteroidsDestroyed,o.remove=!0,ge()),t.remove=!0,Ke());else if(j(t,i,1,!1)&&(dt(),t.remove=!0,i.hp<=0))break}for(const t of $)t.progress+=e/1e3*Ot,Xo(t,t.progress,o=>{o.remove=!0,++h.asteroidsDestroyed,h.damageDealt+=o.hp,ge()});for(const t of Q)if(de(t,e),Ce(t.position)&&(t.remove=!0),Ue(t,i))switch(t.remove=!0,fs(),t.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,i.maxHp),_e(i.hp);break;case"damage":W+=1,ln(W);break;case"rocket-piercing":Me+=1,cn(Me);break}if(i!==null&&i.hp>0){const t={...i.position};de(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},a=Math.sqrt(o.x**2+o.y**2);h.distanceTraveled+=a,Te(Math.min(a/100,.05));for(const n of E)if(j(i,n,1,!0)&&(dt(),i.hp<=0))break}if(_==null)!m.forward&&!m.backward&&!m.left&&!m.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const t=navigator.getGamepads()[_];Math.abs(t.axes[0])<.01&&Math.abs(t.axes[1])<.01&&!m.forward&&!m.backward&&!m.left&&!m.right&&!m.forwardController&&!m.backwardController&&!m.leftController&&!m.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>M.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,M.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>M.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,M.height)),i.velocity.y*=-1),Ln()},Ln=()=>{E.forEach(e=>{e.remove&&(S(se,e.id),e.frame=0,L(ne,e))}),G.forEach(e=>{e.remove&&S(B,e.id)}),$.forEach(e=>{e.remove&&(S(V,e.id),e.children.forEach(t=>{S(Y,t.id)}))}),Q.forEach(e=>{e.remove&&S(ke,e.id)}),E=E.filter(e=>!e.remove),G=G.filter(e=>!e.remove),$=$.filter(e=>!e.remove),Q=Q.filter(e=>!e.remove)},An={default:Qe,homing:ys,armored:xs,turret:ws,split:Qe},qt=(e,t,o,a,n,s,c,d=null)=>{const l=q();if(l.position=e,l.rotation=t,l.acceleration=o,l.velocity=a,l.angularVelocity=n,l.mass=un(s,c),l.radius=c==="armored"?s*2:s,l.inertia=2/5*l.mass*s**2,l.hp=s/2,l.texture=d||Ne(l,An[c],l.radius*2,l.radius*2),l.type=c,c==="turret"&&(l.lastBulletTime=w,l.bulletIndex=0),!Ue(l,i)){for(const u of E)if(Ue(l,u))return;L(se,l),E.push(l)}},Nt=(e,t,o,a,n)=>{const s=q();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=Rt,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,s.friendly=n,L(B,s),G.push(s),++h.bulletsFired},Bn=(e,t,o,a,n)=>{const s=q();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=Rt,s.radius=5,s.targets=n,s.progress=0,s.currentTarget=0,zo(s),Yo(s),L(V,s),$.push(s),Wt({x:-5,y:0},Math.PI/2,s),++h.rocketsFired},Vn=(e,t,o,a)=>{i=q(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=a,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.maxHp=5,C&&(i.maxHp=1),i.hp=i.maxHp,Ne(i,bs,i.height,i.width),L(ae,i),mt({x:-5,y:18},0,X,Ms,i),mt({x:-5,y:-18},0,X,vs,i)},mt=(e,t,o,a,n)=>{const s=q();s.position=e,s.rotation=t,s.parent=n,s.height=20,s.width=20,L(o,s),Ne(s,a,s.height,s.width),n.children??(n.children=n.children||[]),n.children.push(s),Wt({x:-5,y:0},Math.PI/2,s)},Wt=(e,t,o)=>{const a=q();a.position=e,a.rotation=t,a.parent=o,a.height=10,a.width=5,o.children??(o.children=o.children||[]),o.children.push(a),L(Y,a)},Dn=(e,t,o,a,n)=>{if(C&&["health"].includes(e))return;const s=q();s.type=e,s.position=t,s.rotation=o,s.velocity=a,s.angularVelocity=n,s.radius=25,L(ke,s),Q.push(s)},Gt=()=>{p=!p,p?(Ut(),Te(0)):be()},Cn=()=>{if(i){S(ae,i.id);for(let e of i.children){S(X,e.id);for(let t of e.children)S(Y,t.id)}}},Un=()=>{M.width=M.clientWidth,M.height=M.clientHeight,Vn({x:M.width/2,y:M.height/2},0,{x:0,y:0},0),console.log(C),console.log("Setting max hp to: "+(C?1:5)),dn(C?1:5)},Rn=()=>{Un(),Ft(),qe=requestAnimationFrame(_t)},Fn=()=>{if(p)return;p=!0,cancelAnimationFrame(qe),Te(0),i=null;const e=St(!O,!I,z,C);rn(O,I,z,C,h,e),an(),ts(!O,!I,z,C)},Hn=()=>{os(),Vo(),E=[],G=[],$=[],He=1e3,Me=3,W=1,_e(5),be(),Re()},Ne=(e,t,o,a)=>{const n=new Image;n.src=t,n.onload=()=>{const s=document.createElement("canvas");s.width=a,s.height=o,s.getContext("2d").drawImage(n,0,0,a,o),e.texture=s,e.textureReady=!0}};En();
