(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();let j=new Map;const oo=2e3,le=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const s=le(o),n=Math.cos(s.rotation),a=Math.sin(s.rotation);return{x:s.x+t.x*n-t.y*a,y:s.y+t.x*a+t.y*n,rotation:s.rotation+t.rotation}},so=(e,t)=>{j[e]||(j[e]=[]);const o=performance.now();j[e].push({x:t.x,y:t.y,time:o}),j[e]=j[e].filter(s=>o-s.time<oo)},no=e=>{delete j[e]},io=e=>{for(const t in j){const o=j[t];if(!(!o||o.length<2)){e.beginPath();for(let s=0;s<o.length;s++){const n=o[s];s===0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},ao="/asteroid-pew-pew/img/boom/boom_0.gif",ro="/asteroid-pew-pew/img/boom/boom_1.gif",co="/asteroid-pew-pew/img/boom/boom_2.gif",lo="/asteroid-pew-pew/img/boom/boom_3.gif",mo="/asteroid-pew-pew/img/boom/boom_4.gif",uo="/asteroid-pew-pew/img/boom/boom_5.gif",ho="/asteroid-pew-pew/img/boom/boom_6.gif",go="/asteroid-pew-pew/img/boom/boom_7.gif",po="/asteroid-pew-pew/img/boom/boom_8.gif",fo="/asteroid-pew-pew/img/boom/boom_9.gif",yo="/asteroid-pew-pew/img/boom/boom_10.gif",xo="/asteroid-pew-pew/img/boom/boom_11.gif",wo="/asteroid-pew-pew/img/boom/boom_12.gif",bo="/asteroid-pew-pew/img/boom/boom_13.gif",vo="/asteroid-pew-pew/img/boom/boom_14.gif",Mo="/asteroid-pew-pew/img/ice.png",ko="/asteroid-pew-pew/img/powerup.png",vt=5,at=.7,G=2;function To(e,t,o){e.fractureSeeds=Eo(Po(e,t),e.radius);const s=o?null:Vo(e);e.voronoiData=So(e,s)}function Eo(e,t){const o=[];for(let s=0;s<vt;s++){const n=Math.random()*2*Math.PI,a=Math.sqrt(Math.random())*t,r=Math.cos(n)*a,l=Math.sin(n)*a,d=at*e.x,m=at*e.y,h=d+r,u=m+l;h*h+u*u<=Math.pow(t,2)?o.push({x:h,y:u}):s--}return o}function Io(e,t){const{position:o,rotation:s,fractureSeeds:n}=t,a=Math.cos(s),r=Math.sin(s);e.fillStyle="red";for(const l of n){const d={x:o.x+l.x*a-l.y*r,y:o.y+l.x*r+l.y*a};e.beginPath(),e.arc(d.x,d.y,2,0,Math.PI*2),e.fill()}}function Po(e,t){const o=t.position.x-e.position.x,s=t.position.y-e.position.y,n=Math.sin(-e.rotation),a=Math.cos(-e.rotation);return{x:o*a-s*n,y:o*n+s*a}}function So(e,t=null){const{fractureSeeds:o,radius:s}=e,n=s*2,a=s*2,r=new Int16Array(n*a).fill(-1),l=document.createElement("canvas");l.width=n,l.height=a;const d=l.getContext("2d"),m=d.getImageData(0,0,n,a),h=m.data,u=n/2,x=a/2;for(let w=0;w<a;w++)for(let f=0;f<n;f++){const I=f-u,P=w-x;if(I*I+P*P>s*s)continue;let B=1/0,W=-1;for(let R=0;R<o.length;R++){const Q=o[R];let Oe=I-Q.x,_e=P-Q.y;if(t){const it=t(f,w);Oe+=(it-.5)*10,_e+=(it-.5)*10}const nt=Oe*Oe+_e*_e;nt<B&&(B=nt,W=R)}r[w*n+f]=W;const F=Math.sqrt(B),b=Math.min(1,F/s),S=(w*n+f)*4,[N,He,st]=Lo(b);h[S]=N,h[S+1]=He,h[S+2]=st,h[S+3]=255}return d.putImageData(m,0,0),{heatMap:l,cellMap:r}}function Lo(e){if(e=Math.max(0,Math.min(1,e)),e<.33){const t=e/.33;return[255,Math.round(255*t),0]}else if(e<.66){const t=(e-.33)/.33;return[Math.round(255*(1-t)),255,0]}else{const t=(e-.66)/.34;return[0,Math.round(255*(1-t)),Math.round(255*t)]}}function Vo(e){const t=e.radius*2,o=e.radius*2,s=new Float32Array(o*t),n=Math.floor(o/G)+2,a=Math.floor(t/G)+2,r=[];for(let d=0;d<a*n;d++)r.push(Math.random());for(let d=0;d<t;d++)for(let m=0;m<o;m++){const h=Math.floor(m/G),u=Math.floor(d/G),x=m%G/G,w=d%G/G,f=u*n+h,I=r[f],P=r[f+1],B=r[f+n],W=r[f+n+1],F=I*(1-x)+P*x,b=B*(1-x)+W*x;s[d*o+m]=F*(1-w)+b*w}return(d,m)=>s[m*o+d]}function Ao(e){const t=[],o=e.texture,s=e.voronoiData.cellMap,n=e.radius*2,a=e.radius*2;for(let r=0;r<vt;r++){let l=n,d=a,m=0,h=0;for(let b=0;b<s.length;b++){if(s[b]===-1||s[b]!==r)continue;const S=b%n,N=Math.floor(b/n);l=S<l?S:l,d=N<d?N:d,m=S>m?S:m,h=N>h?N:h}const u=m-l+1,x=h-d+1,w=document.createElement("canvas");w.width=u,w.height=x;const f=w.getContext("2d"),I=f.createImageData(u,x);let P=I.data;const F=o.getContext("2d").getImageData(0,0,n,a).data;for(let b=0;b<s.length;b++){if(s[b]!==r)continue;const S=b%n,N=Math.floor(b/n),He=S-l,R=((N-d)*u+He)*4,Q=b*4;P[R]=F[Q],P[R+1]=F[Q+1],P[R+2]=F[Q+2],P[R+3]=F[Q+3]}f.putImageData(I,0,0),t.push(w)}return t}const Z=document.getElementsByTagName("canvas")[0],i=Z.getContext("2d"),we="asteroid",O="bullet",re="explosion",ge="flash",_="rocket",be="spaceship",Mt="velocity",ce="spaceshippart",de="flames",Fe="powerup",Ne="flame_particles",pe="collision",Bo="#ffffff",Do="#ffff00",Ee="#ff0000",rt="#00ff00";let Co=0;const Fo=()=>`${Co++}`,q={[we]:{color:Bo},[O]:{color:Do,length:10,strokeWidth:2},[_]:{color:Ee,radius:10},[be]:{color:rt},[Mt]:{color:Ee},[ce]:{color:rt},[de]:{color:Ee},[Ne]:{color:"blue"}},Y={[de]:{},[Ne]:{},[be]:{},[ce]:{},[we]:{},[O]:{},[_]:{},[re]:{},[ge]:{},[Fe]:{},[pe]:{}};let kt=!1,ve=!1,Tt=!1,Et=!0,It=!1,Pt=!1;const No=e=>{kt=e},Uo=e=>{ve=e},Ro=e=>{Tt=e},Ho=e=>{Et=e},Oo=e=>{It=e},_o=e=>{Pt=e},V=(e,t)=>{t.id=Fo(),Y[e][t.id]=t},D=(e,t)=>{delete Y[e][t],no(t)},qo=()=>{for(const e in Y)Y[e]={}},M=[];for(let e=0;e<15;++e)M.push(new Image);M[0].src=ao;M[1].src=ro;M[2].src=co;M[3].src=lo;M[4].src=mo;M[5].src=uo;M[6].src=ho;M[7].src=go;M[8].src=po;M[9].src=fo;M[10].src=yo;M[11].src=xo;M[12].src=wo;M[13].src=bo;M[14].src=vo;const St=new Image;St.src=Mo;const Wo=()=>{Z.width=Z.clientWidth,Z.height=Z.clientHeight,i.clearRect(0,0,Z.width,Z.height);for(const e in Y)for(const t of Object.values(Y[e])){switch(e){case we:Go(t);break;case re:jo(t);break;case O:$o(t);break;case _:zo(t);break;case be:case ce:Yo(t);break;case de:Xo(t);break;case Ne:Jo(t);case ge:Ko(t);break;case Fe:Qo(t);break;case pe:Zo(t);break}e!==pe&&e!==re&&e!==ge&&so(t.id,le(t))}if(kt){i.strokeStyle=q[Mt].color,i.lineWidth=1,i.beginPath();for(const e in Y){for(const t of Object.values(Y[e])){if("velocity"in t){const{position:o,velocity:s}=t,{x:n,y:a}=o,{x:r,y:l}=s;i.moveTo(n,a),i.lineTo(n+r*200,a+l*200)}if("angularVelocity"in t){const{position:o,angularVelocity:s}=t,{x:n,y:a}=o;s>0?(i.moveTo(n+20,a),i.arc(n,a,20,0,s*300)):(i.moveTo(n+20*Math.cos(s*300),a+20*Math.sin(s*300)),i.arc(n,a,20,s*300,0))}}i.stroke()}}Tt&&io(i)},Go=e=>{const{width:t,height:o,radius:s,texture:n,textureReady:a,voronoiData:r}=e;if(!a)return;const l=le(e);i.save(),i.translate(l.x,l.y),i.rotate(l.rotation);const d=t!=0?t:s*2,m=o!=0?o:s*2,h=Pt&&r?r.heatMap:n;i.drawImage(h,-s,-s,d,m),ve&&(i.strokeStyle=Ee,i.lineWidth=1,i.beginPath(),i.moveTo(0,0),i.arc(0,0,s,0,2*Math.PI),i.stroke()),e.frozen&&(i.globalAlpha=.2,i.drawImage(St,-s-10,-s-10,d+20,m+20),i.globalAlpha=1),i.restore(),It&&Io(i,e)},$o=e=>{var n;const{length:t}=q[O],o=Math.cos(e.rotation)*t/2,s=Math.sin(e.rotation)*t/2;i.fillStyle=e.friendly?q[O].color:"red",i.strokeStyle=e.friendly?q[O].color:"red",i.lineWidth=(n=q[O])==null?void 0:n.strokeWidth,i.beginPath(),i.moveTo(e.position.x+o,e.position.y+s),i.lineTo(e.position.x-o,e.position.y-s),i.stroke()},zo=e=>{var r;const{radius:t}=q[_],o=2*Math.PI/8,s={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},n={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},a={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(i.fillStyle=q[_].color,i.strokeStyle=q[_].color,i.lineWidth=((r=q[_])==null?void 0:r.strokeWidth)??0,i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(n.x,n.y),i.lineTo(a.x,a.y),i.lineTo(s.x,s.y),i.stroke(),Et){for(const l of e.targets)i.moveTo(l.position.x,l.position.y),i.arc(l.position.x,l.position.y,4,0,2*Math.PI);i.fill(),i.strokeStyle="grey",i.beginPath(),i.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)i.lineTo(l.x,l.y),i.arc(l.x,l.y,2,0,2*Math.PI),i.moveTo(l.x,l.y);i.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),i.stroke()}},jo=e=>{i.translate(e.position.x,e.position.y);const s=M[e.frame];i.drawImage(s,-100/2,-100/2,100,100),i.translate(-e.position.x,-e.position.y),e.frame<M.length-1?e.frame++:D(re,e.id)},Yo=e=>{const{width:t,height:o,texture:s,textureReady:n}=e;if(!n)return;const a=le(e);i.save(),i.translate(a.x,a.y),i.rotate(a.rotation),i.drawImage(s,-t/2,-o/2,t,o),ve&&(i.strokeStyle="lime",i.lineWidth=1,i.strokeRect(-t/2,-o/2,t,o)),i.restore()},Xo=e=>{var m,h,u;const{width:t,height:o}=e,s=le(e),n=((m=e==null?void 0:e.parent)==null?void 0:m.velocity)??{x:0,y:1},a=((u=(h=e==null?void 0:e.parent)==null?void 0:h.parent)==null?void 0:u.velocity)??{x:0,y:0},r={x:n.x+a.x,y:n.y+a.y},l=Math.min(Math.sqrt(r.x**2+r.y**2)*5,2);i.save(),i.translate(s.x,s.y),i.rotate(s.rotation),i.beginPath();const d=Math.random()*5;i.moveTo(0,0),i.lineTo(-t,(o+d)*l),i.lineTo(t,(o+d)*l),i.closePath(),i.fillStyle="orange",i.fill(),i.beginPath(),i.moveTo(0,0),i.lineTo(-t/2,(o/2+d)*l),i.lineTo(t/2,(o/2+d)*l),i.closePath(),i.fillStyle="yellow",i.fill(),ve&&(i.strokeStyle="lime",i.lineWidth=1,i.strokeRect(-t,0,t*2,o+d)),i.restore()},Jo=e=>{const{width:t,height:o}=e,s=le(e);i.save(),i.translate(s.x,s.y),i.rotate(s.rotation);const n=5;for(let a=0;a<n;a++){const r=(Math.random()-.5)*t*2,l=Math.random()+o,d=1+Math.random()*2;i.globalAlpha=.2+Math.random()*.3,i.fillStyle="blue",i.beginPath(),i.arc(r,l,d,0,Math.PI*2),i.fill()}i.globalAlpha=1,i.restore()},Ko=e=>{const t=e.position,o=e.rotation,s=3,n=15;i.fillStyle="white",i.strokeStyle="none",i.beginPath(),i.translate(t.x,t.y),i.rotate(o),i.moveTo(s,s),i.lineTo(n,0),i.lineTo(s,-3),i.lineTo(0,-15),i.lineTo(-3,-3),i.lineTo(-15,0),i.lineTo(-3,s),i.lineTo(0,n),i.resetTransform(),i.closePath(),i.fill()},Lt=new Image;Lt.src=ko;const Qo=e=>{const{radius:t}=e,o=t*2;switch(i.save(),i.translate(e.position.x,e.position.y),i.rotate(e.rotation),i.drawImage(Lt,-t,-t,o,o),ve&&(i.strokeStyle="lime",i.lineWidth=1,i.strokeRect(-t,-t,o,o)),e.type){case"health":i.textAlign="center",i.font="20px Arial",i.fillText("🧡",0,7);break;case"damage":i.fillStyle="yellow",i.textAlign="center",i.font="20px Arial",i.fillText("=",0,7);break;case"rocket-piercing":i.textAlign="center",i.font="20px Arial",i.fillText("🚀",0,7);break}i.restore()},Me=(e,t,o,s,n=300)=>{o>0?(i.moveTo(e+s,t),i.arc(e,t,s,0,o*n)):(i.moveTo(e+s*Math.cos(o*n),t+s*Math.sin(o*n)),i.arc(e,t,s,o*n,0))},Zo=e=>{const{a:t,b:o,collisionPoint:s,normal:n,lifetime:a}=e;if(a==0){D(pe,e.id);return}e.lifetime--,i.strokeStyle="white",i.lineWidth=1,i.beginPath(),i.moveTo(t.position.x+t.radius,t.position.y),i.arc(t.position.x,t.position.y,t.radius,0,2*Math.PI),i.moveTo(o.position.x+o.radius,o.position.y),i.arc(o.position.x,o.position.y,o.radius,0,2*Math.PI),i.stroke(),i.strokeStyle="magenta",i.lineWidth=1,i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(s.x+n.x*20,s.y+n.y*20),i.stroke(),i.strokeStyle="red",i.beginPath(),i.moveTo(t.position.x,t.position.y),i.lineTo(t.position.x+t.oldVelocity.x*200,t.position.y+t.oldVelocity.y*200),i.moveTo(o.position.x,o.position.y),i.lineTo(o.position.x+o.oldVelocity.x*200,o.position.y+o.oldVelocity.y*200),Me(t.position.x,t.position.y,t.oldAngularVelocity,20),Me(o.position.x,o.position.y,o.oldAngularVelocity,20),i.stroke(),i.strokeStyle="green",i.beginPath(),i.moveTo(t.position.x,t.position.y),i.lineTo(t.position.x+t.newVelocity.x*200,t.position.y+t.newVelocity.y*200),i.moveTo(o.position.x,o.position.y),i.lineTo(o.position.x+o.newVelocity.x*200,o.position.y+o.newVelocity.y*200),Me(t.position.x,t.position.y,t.newAngularVelocity,25),Me(o.position.x,o.position.y,o.newAngularVelocity,25),i.stroke()},ct=(e,t)=>e.x*t.x+e.y*t.y,Ie=e=>{const t=me(e);return{x:e.x/t,y:e.y/t}},C=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Vt=(e,t,o)=>({x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}),lt=e=>({x:Math.cos(e),y:Math.sin(e)}),es=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},me=e=>Math.sqrt(e.x**2+e.y**2),K=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null,fractureSeeds:[],textureReady:!1,voronoiData:null}),ke=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.force.x=0,e.force.y=0,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.angularVelocity+=e.angularAcceleration*t,e.angularAcceleration=e.torque/e.inertia,e.torque=0;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),(isNaN(e.position.x)||isNaN(e.position.y))&&(console.warn("Entity position is NaN",e),e.position.x=0,e.position.y=0)},$e=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),ze=(e,t)=>$e(e,t)<e.radius+t.radius,ie=(e,t,o)=>{const s=$e(e,t),n=e.radius+t.radius;if(s>=n)return!1;const a=Vt(e.position,t.position,e.radius/s),r=Ie(C(t.position,e.position)),l={x:-r.y,y:r.x},d=n-s+1e-5,m=e.mass+t.mass;e.position.x-=r.x*d*t.mass/m,e.position.y-=r.y*d*t.mass/m,t.position.x+=r.x*d*e.mass/m,t.position.y+=r.y*d*e.mass/m,$e(e,t)<n&&console.warn("Collision resolution failed");const h=C(e.velocity,t.velocity),u=2*t.mass/m*ct(h,r),x=2*e.mass/m*ct(h,r),w=C(a,e.position),f=C(a,t.position),I=w.x*u*l.x+w.y*u*l.y,P=f.x*x*l.x+f.y*x*l.y,B={...e.velocity},W={...t.velocity},F=e.angularVelocity,b=t.angularVelocity;e.frozen||(e.velocity.x-=u*r.x,e.velocity.y-=u*r.y,e.torque+=I),t.frozen||(t.velocity.x+=x*r.x,t.velocity.y+=x*r.y,t.torque+=P);const S={radius:e.radius,position:{...e.position},newVelocity:{...e.velocity},oldVelocity:B,newAngularVelocity:e.angularVelocity,oldAngularVelocity:F},N={radius:t.radius,position:{...t.position},newVelocity:{...t.velocity},oldVelocity:W,newAngularVelocity:t.angularVelocity,oldAngularVelocity:b};return o(S,N,a,r),(isNaN(e.position.x)||isNaN(e.position.y)||isNaN(t.position.x)||isNaN(t.position.y))&&(console.warn("Entity position is NaN after collision resolution",e,t),e.position.x=0,e.position.y=0,t.position.x=0,t.position.y=0),!0},ts=40,$=0,dt=(e,t,o,s,n)=>1*o*1+(-0*t+$*s)*e+(2*$*t+($-3)*o+(3-2*$)*s-$*n)*e*e+(-0*t+(2-$)*o+($-2)*s+$*n)*e*e*e,ue=(e,t,o,s,n)=>({x:dt(e,t.x,o.x,s.x,n.x),y:dt(e,t.y,o.y,s.y,n.y)}),At=(e,t)=>{const{v:o,offset:s}=Bt(e,t);t=o*e.arcLengthTable.cordLength;const n=s===0?0:e.targetCordLengths[s-1],a=e.targetCordLengths[s],r=t-n,l=a-n,d=r/l;return ue(d,e.targets[s+0].position,e.targets[s+1].position,e.targets[s+2].position,e.targets[s+3].position)},os=e=>{e.arcLengthTable=[],e.targetCordLengths=[],e.arcLengthTable.cordLength=0;let t=e.targets[1].position;for(let o=0;o<e.targets.length-3;++o){const s=ue(0,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position),n=ue(1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position),a=me(C(n,s)),r=[{fromProgress:0,toProgress:1,from:s,to:n,distance:a}],l=new Set;for(l.add(0),l.add(1);r.length>0;){const{fromProgress:m,toProgress:h,from:u,to:x,distance:w}=r.pop(),f=(m+h)/2,I=ue(f,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position),P=me(C(I,u)),B=me(C(x,I));Math.abs(P+B-w)>.01?(r.push({fromProgress:m,toProgress:f,from:u,to:I,distance:P}),r.push({fromProgress:f,toProgress:h,from:I,to:x,distance:B})):l.add(f)}const d=[...l.values()];d.sort((m,h)=>m-h);for(const m of d){const h=ue(m,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position);e.arcLengthTable.cordLength+=me(C(h,t)),e.arcLengthTable.push({v:0,cordLength:e.arcLengthTable.cordLength,offset:o}),t=h}e.targetCordLengths.push(e.arcLengthTable.cordLength)}for(const o of e.arcLengthTable)o.v=o.cordLength/e.arcLengthTable.cordLength},ss=e=>e,Bt=(e,t)=>{let{v:o,offset:s}=e.arcLengthTable[e.arcLengthTable.length-1];for(let n=1;n<e.arcLengthTable.length;++n){const a=e.arcLengthTable[n-1],r=e.arcLengthTable[n];if(t<r.cordLength){const l=r.cordLength-a.cordLength,m=(t-a.cordLength)/l;o=a.v*(1-m)+r.v*m,s=r.offset;break}}return o=ss(o),o=Math.min(1,Math.max(0,o)),{v:o,offset:s}},ns=(e,t,o)=>{const s=At(e,t);e.velocity=C(s,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=s;const{v:n}=Bt(e,t);t=n*e.arcLengthTable.cordLength,t>=e.targetCordLengths[e.currentTarget]&&(o(e.targets[e.currentTarget+2]),++e.currentTarget)},is=e=>{e.pathPoints=[];const t=Math.ceil(e.arcLengthTable.cordLength/ts);for(let o=0;o<t;++o){const s=o/t*e.arcLengthTable.cordLength;e.pathPoints.push(At(e,s))}e.pathPoints.push(e.targets[e.targets.length-2].position)},z=document.getElementsByTagName("canvas")[0];let Dt=!1;const as=e=>{Dt=e},Ct=()=>({x:Math.random()*z.width,y:Math.random()*z.height}),mt=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*z.width,y:-90};case 1:return{x:z.width+t,y:Math.random()*z.height};case 2:return{x:Math.random()*z.width,y:z.height+t};case 3:return{x:-90,y:Math.random()*z.height}}},Le=e=>(Math.random()*2-1)*e,rs=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},cs=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],o=Math.random();for(let s=0;s<e.length;s++)if(o<t[s])return e[s];return e[e.length-1]},Ft=(e,t)=>{const o=Math.random();let s=0;for(let n=0;n<t.length;n++)if(s+=t[n],o<s)return e[n];return e[t.length-1]},ls=()=>Dt?"split":Ft(["default","split","homing","armored","turret"],[.65,.2,.05,.05,.05]),ds=()=>Ft(["homing","armored","turret"],[.34,.33,.33]),H={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},ms=JSON.stringify(H),Nt=(e,t,o,s)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(o?"-extreme":"-default")+(s?"-hitless":"-default"),Ut=(e,t,o,s)=>{const n=Nt(e,t,o,s);return JSON.parse(localStorage.getItem(n)||ms)},p={...H},us=(e,t,o,s)=>{const n=Ut(e,t,o,s);n.timePlayed=Math.max(n.timePlayed,p.timePlayed),n.asteroidsDestroyed=Math.max(n.asteroidsDestroyed,p.asteroidsDestroyed),n.damageDealt=Math.max(n.damageDealt,p.damageDealt),n.bulletsFired=Math.max(n.bulletsFired,p.bulletsFired),n.bulletsHit=Math.max(n.bulletsHit,p.bulletsHit),n.rocketsFired=Math.max(n.rocketsFired,p.rocketsFired),n.distanceTraveled=Math.max(n.distanceTraveled,p.distanceTraveled),localStorage.setItem(Nt(e,t,o),JSON.stringify(n))},hs=()=>{p.timePlayed=H.timePlayed,p.asteroidsDestroyed=H.asteroidsDestroyed,p.damageDealt=H.damageDealt,p.bulletsFired=H.bulletsFired,p.bulletsHit=H.bulletsHit,p.rocketsFired=H.rocketsFired,p.distanceTraveled=H.distanceTraveled},gs="/asteroid-pew-pew/audio/propulsion.mp3",ps="/asteroid-pew-pew/audio/explosion.wav",fs="/asteroid-pew-pew/audio/shoot.wav",ys="/asteroid-pew-pew/audio/hurt.wav",Rt="/asteroid-pew-pew/audio/hit.wav",xs="/asteroid-pew-pew/audio/click.wav",ws="/asteroid-pew-pew/audio/submit.wav",bs="/asteroid-pew-pew/audio/powerup.wav",vs="/asteroid-pew-pew/audio/CODEX_2015.mp3",Ms="/asteroid-pew-pew/audio/armorHit.wav";let A=.5;const ks=e=>{Ze.volume=.05*e,A=e},Ue=new Audio(gs);Ue.volume=0;Ue.loop=!0;document.addEventListener("keydown",()=>Ue.play().catch(()=>{}),{once:!0});const Re=e=>{Ue.volume=e*A},fe=()=>{const e=new Audio(ws);e.volume=.5*A,e.play().catch(()=>{})},k=()=>{const e=new Audio(xs);e.volume=.5*A,e.play().catch(()=>{})},Ts=()=>{const e=new Audio(Rt);e.volume=.1*A,e.play().catch(()=>{})},Es=()=>{const e=new Audio(ys);e.volume=.3*A,e.play().catch(()=>{})},Ht=()=>{const e=new Audio(fs);e.volume=.1*A,e.play().catch(()=>{})},ut=()=>{const e=new Audio(Rt);e.volume=.2*A,e.play().catch(()=>{})},Is=()=>{const e=new Audio(Ms);e.volume=.2*A,e.play().catch(()=>{})},Pe=()=>{const e=new Audio(ps);e.volume=.3*A,e.play().catch(()=>{})},Ps=()=>{const e=new Audio(bs);e.volume=.2*A,e.play().catch(()=>{})},Ze=new Audio(vs);Ze.volume=.05*A;Ze.loop=!0;const Ss="/asteroid-pew-pew/img/Asteroid1.png",Ls="/asteroid-pew-pew/img/asteroid_split.png",Vs="/asteroid-pew-pew/img/asteroid_red.png",As="/asteroid-pew-pew/img/asteroid_armored.png",Bs="/asteroid-pew-pew/img/asteroid_green.png",Ds="/asteroid-pew-pew/img/Spaceship.png",Cs="/asteroid-pew-pew/img/WingLeft.png",Fs="/asteroid-pew-pew/img/WingRight.png";let Ns=document.getElementById("entity-count"),Us=document.getElementById("fps"),Rs=document.getElementById("ups"),Hs=document.getElementById("target-fps"),Os=document.getElementById("target-ups"),Ot=document.getElementById("pause-menu");const _t=document.getElementById("main-menu"),_s=document.getElementById("pause-resume"),qs=document.getElementById("debug-velocity"),Ws=document.getElementById("debug-hitbox"),Gs=document.getElementById("debug-trajectory"),$s=document.getElementById("debug-spline-paths"),zs=document.getElementById("debug-rocket-speed"),js=document.getElementById("debug-draw-seeds"),Ys=document.getElementById("debug-draw-distance"),Xs=document.getElementById("debug-disable-noise"),Js=document.getElementById("debug-split-only"),Ks=document.getElementById("debug-draw-collisions");document.getElementById("fire-rate");const Qs=document.getElementById("rocket-piercing"),Zs=document.getElementById("bullet-damage"),Ve=document.getElementById("hp"),qt=document.getElementById("game-over"),en=document.getElementById("time-played"),tn=document.getElementById("asteroids-destroyed"),on=document.getElementById("distance-traveled"),sn=document.getElementById("damage-dealt"),nn=document.getElementById("start"),an=document.getElementById("restart"),rn=document.getElementById("volume"),cn=document.getElementById("mode-pacifist"),ln=document.getElementById("mode-stationary"),dn=document.getElementById("mode-extreme"),mn=document.getElementById("mode-hitless"),un=document.getElementById("mark-pacifist"),hn=document.getElementById("mark-stationary"),gn=document.getElementById("mark-extreme"),pn=document.getElementById("mark-hitless"),fn=document.getElementById("back-to-main-menu"),yn=document.getElementById("pause-back-to-main-menu"),ht=document.getElementById("controls-move"),gt=document.getElementById("controls-bullet"),pt=document.getElementById("controls-rocket"),xn=(e,t,o,s,n,a,r,l,d,m,h,u)=>{wn(e,d,t,o,m,h),vn(s,n,a,r,l,u),Mn(e,d)},wn=(e,t,o,s,n,a)=>{nn.addEventListener("click",()=>{fe(),bn(),t(),e()}),cn.addEventListener("change",r=>{k(),o(!r.target.checked),r.target.checked?(gt.setAttribute("disabled","true"),pt.setAttribute("disabled","true")):(gt.removeAttribute("disabled"),pt.removeAttribute("disabled"))}),ln.addEventListener("change",r=>{k(),s(!r.target.checked),r.target.checked?ht.setAttribute("disabled","true"):ht.removeAttribute("disabled")}),dn.addEventListener("change",r=>{k(),n(r.target.checked)}),mn.addEventListener("change",r=>{k(),a(r.target.checked)})},Wt=()=>{_t.style.display="grid"},bn=()=>{_t.style.display="none"},vn=(e,t,o,s,n,a)=>{rn.addEventListener("input",r=>{e(r.target.value/100)}),Hs.addEventListener("change",r=>{k(),r.target.value=Math.max(0,Math.min(1e3,Number(r.target.value))),t(1e3/r.target.value)}),Os.addEventListener("change",r=>{k(),r.target.value=Math.max(0,Math.min(1e3,Number(r.target.value))),o(1e3/r.target.value)}),qs.addEventListener("change",r=>{k(),No(r.target.checked)}),Ws.addEventListener("change",r=>{k(),Uo(r.target.checked)}),Gs.addEventListener("change",r=>{k(),Ro(r.target.checked)}),$s.addEventListener("change",r=>{k(),Ho(r.target.checked)}),js.addEventListener("change",r=>{k(),Oo(r.target.checked)}),Ys.addEventListener("change",r=>{k(),_o(r.target.checked)}),Xs.addEventListener("change",r=>{k(),ii(r.target.checked)}),Js.addEventListener("change",r=>{k(),as(r.target.checked)}),zs.addEventListener("change",r=>{k(),r.target.value=Math.max(0,Math.min(1e3,Number(r.target.value))),s(r.target.value)}),_s.addEventListener("click",()=>{fe(),Ae(),n()}),yn.addEventListener("click",()=>{fe(),Ae(),Wt()}),Ks.addEventListener("change",r=>{k(),a(r.target.checked)})},Gt=()=>{Ot.style.display="flex"},Ae=()=>{Ot.style.display="none"},Mn=(e,t)=>{an.addEventListener("click",()=>{fe(),je(),t(),e()}),fn.addEventListener("click",()=>{fe(),je(),Wt()})},kn=()=>{qt.style.display="grid"},je=()=>{qt.style.display="none"},Tn=(e,t,o,s,n,a)=>{un.style.display=e?"none":"block",hn.style.display=t?"none":"block",gn.style.display=o?"block":"none",pn.style.display=s?"block":"none",Te(en,n.timePlayed/1e3,a.timePlayed/1e3,"s",1),Te(tn,n.asteroidsDestroyed,a.asteroidsDestroyed),Te(on,n.distanceTraveled,a.distanceTraveled,"m",1),Te(sn,n.damageDealt,a.damageDealt,"hp",0)},Te=(e,t,o,s,n)=>{e.children.item(1).innerText=s?`${t.toFixed(n)} ${s}`:`${t.toFixed(n)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${s?`${o.toFixed(n)} ${s}`:o.toFixed(n)} )`)},En=e=>{Qs.innerText=`${e}`},In=e=>{Zs.innerText=e.toFixed(1)},et=e=>{for(let t=0;t<Ve.children.length;t++)Ve.children.item(t).style.color=t<e?"red":"grey"},Pn=e=>{Ve.innerHTML="";for(let t=0;t<e;t++){const o=document.createElement("li");o.innerText="❤",o.style.color="red",Ve.appendChild(o)}},Sn=(e,t,o)=>{Ns.innerText=`${e}`,Us.innerText=`${t}`,Rs.innerText=`${o}`};let T=document.getElementsByTagName("canvas")[0],J=null,$t=!1;const zt=1e3,Ln=(e,t)=>{const o=t==="armored"?4:3.5;return 4/3*Math.PI*e**3*o};let y=!0;const jt=()=>y=!1;let tt,Se=1e3/120;const Vn=e=>Se=e;let Yt=1e3/60;const An=e=>Yt=e;let U=0,Be=0,De=0,X=!0;const Bn=e=>X=e;let L=!0;const Dn=e=>L=e;let qe=0,We=0,ft=0,E=[],te=[],oe=[],c=null,he=[],ee=1,yt=0,ye=!1,Ye=0,Cn=40,xt=80,Ce=3,xe=!1,Fn=3e3,Xe=0,Xt=300;const Nn=e=>Xt=e;let Je=1e3,Ke=0;const Un=e=>Math.pow(.99,e/1e3)*1e3,Rn={default:Ss,homing:Vs,armored:As,turret:Bs,split:Ls};let se=!1;const Hn=e=>se=e;let ne=!1;const On=e=>{ne=e};let _n=1e4,Qe=0,g={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1},Jt=!1;const qn=e=>{Jt=e},Wn=()=>{document.getElementById("version").innerText="0.3.0",U=performance.now(),De=U,$n(),xn(ti,Bn,Dn,ks,An,Vn,Nn,jt,si,Hn,On,qn)},Gn=e=>{if(J==null)return;const t=navigator.getGamepads()[J];t.buttons[9].value>=.5&&e-300>=ft&&(to(),ft=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?ye=!y&&X:ye=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?xe=!y&&X:xe=!1,t.buttons[12].pressed?g.forwardController=!y&&L:g.forwardController=!1,t.buttons[13].pressed?g.backwardController=!y&&L:g.backwardController=!1,t.buttons[14].pressed?g.leftController=!y&&L:g.leftController=!1,t.buttons[15].pressed?g.rightController=!y&&L:g.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(c.rotation=Math.atan2(t.axes[3],t.axes[2]))},$n=()=>{window.addEventListener("gamepadconnected",e=>{J=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{J=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":to();break;case" ":ye=!y&&X;break;case"Shift":xe=!y&&X;break;case"ArrowUp":case"w":case"W":g.forward=!y&&L;break;case"ArrowDown":case"s":case"S":g.backward=!y&&L;break;case"ArrowLeft":case"a":case"A":g.left=!y&&L;break;case"ArrowRight":case"d":case"D":g.right=!y&&L;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":ye=!1;break;case"Shift":xe=!1;break;case"ArrowUp":case"w":case"W":g.forward=!1;break;case"ArrowDown":case"s":case"S":g.backward=!1;break;case"ArrowLeft":case"a":case"A":g.left=!1;break;case"ArrowRight":case"d":case"D":g.right=!1;break}}),document.addEventListener("mousemove",e=>{if(y||c==null)return;const t=e.clientX-T.getBoundingClientRect().left,o=e.clientY-T.getBoundingClientRect().top,s=t-c.position.x,n=o-c.position.y;c.rotation=Math.atan2(n,s)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(y=!0,Gt())})};let v=performance.now();const Kt=()=>{for(v=performance.now(),Gn(v);Be+Se/2<=v;)y||(jn(Se),++qe),Be+=Se;if(U+Yt/2<=v&&(y||(Wo(),++We),U=v),v-De>=1e3){const e=E.length+te.length+oe.length+(c?1:0);Sn(e,We,qe),We=0,qe=0,De=v}tt=requestAnimationFrame(Kt)},zn=()=>{if(ye&&v-Ye>=Cn&&c){const e=c.rotation+(Math.random()-.5)*.1,t=yt%2===0?-1:1,o=lt(c.rotation+Math.PI/2*t);o.x*=10,o.y*=10,o.x+=c.position.x,o.y+=c.position.y,Zt(o,e,lt(e),0,!0),Ht(),yt++,Ye=v}if(xe&&v-Xe>=Fn&&c){const e=[{position:{x:c.position.x-Math.cos(c.rotation)*1e3,y:c.position.y-Math.sin(c.rotation)*1e3}},{position:{x:c.position.x,y:c.position.y}}];for(let t=0;t<Math.min(Ce,E.length);t++){let o;do o=E[Math.floor(Math.random()*E.length)];while(e.includes(o));o.frozen=!0,o.velocity.x=0,o.velocity.y=0,e.push(o)}e.push(e.at(-1)),Xn({...c.position},c.rotation,{x:0,y:0},0,e),Xe=v}if(v-Ke>=Je){const e=mt(),t=Ct(),o=Math.random()*Math.PI*2,s={x:t.x-e.x,y:t.y-e.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=Math.random()*.1+.1,s.y*=Math.random()*.1+.1,se&&(s.x*=2,s.y*=2);const a=Le(.005),r=rs(p.timePlayed),l=se?ds():ls();Qt(e,o,{x:0,y:0},s,a,r,l),Ke=v,Je=Un(p.timePlayed)}if(v-Qe>=_n){const e=mt(),t={x:T.width/2+(Math.random()-.5)*400,y:T.height/2+(Math.random()-.5)*400},o={x:t.x-e.x,y:t.y-e.y},s=Math.sqrt(o.x**2+o.y**2);s>0&&(o.x/=s,o.y/=s),o.x*=.1,o.y*=.1;const n=Le(.005),a=cs();Qn(a,e,0,o,n),Qe=v}if(c){if(J!=null){const e=navigator.getGamepads()[J];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let o=e.axes[0];Math.abs(e.axes[0])<=.01?o=0:e.axes[0]>=.7?o=1:e.axes[0]<=-.7&&(o=-1),c.force.y+=.004*t,c.force.x+=.004*o}c.force.x==0&&c.force.y==0&&((g.forward||g.forwardController)&&(c.force.y-=.004),(g.backward||g.backwardController)&&(c.force.y+=.004),(g.left||g.leftController)&&(c.force.x-=.004),(g.right||g.rightController)&&(c.force.x+=.004))}},Ge=e=>e.x<-100||e.x>T.width+100||e.y<-100||e.y>T.height+100,wt=()=>{c.hp-=1,Es(),c.hp>=0&&et(c.hp),c.hp<=0&&(Pe(),Zn(),Re(0),V(re,{position:{...c.position},frame:0}),setTimeout(()=>{oi()},1e3))},jn=e=>{zn(),p.timePlayed+=e;for(let t=0;t<E.length;t++){const o=E[t];if(o.type==="homing"&&c!==null&&!o.frozen){const s=Ie(o.velocity),n=Ie(C(c.position,o.position)),a=Ie(Vt(s,n,.002*e)),r=Math.sqrt(o.velocity.x**2+o.velocity.y**2);let l=a.x,d=a.y;const m=Math.sqrt(l**2+d**2);m>0&&(l/=m,d/=m),l*=r,d*=r,o.velocity.x=l,o.velocity.y=d,(isNaN(o.velocity.x)||isNaN(o.velocity.y))&&(console.warn("Homing asteroid velocity is NaN, resetting to 0"),o.velocity.x=0,o.velocity.y=0)}ke(o,e),Ge(o.position)&&(o.remove=!0);for(let s=t+1;s<E.length;s++){const n=E[s];ie(o,n,ae)&&Ts()}if(o.type==="turret"&&!o.frozen){const s=o.bulletIndex%5===0?xt*50:xt;if(v-o.lastBulletTime>=s){const n={x:c.position.x-o.position.x,y:c.position.y-o.position.y},a=Math.sqrt(n.x**2+n.y**2);a>0&&(n.x/=a*2,n.y/=a*2);const r={x:o.position.x,y:o.position.y};Zt(r,es(n),n,0,!1),Ht(),o.lastBulletTime=v,o.bulletIndex++}}}for(const t of te)if(ke(t,e),Ge(t.position)&&(t.remove=!0),!t.disabled){if(t.friendly)for(const o of E)if(o.type==="armored")ie(t,o,ae)&&(p.bulletsHit++,t.velocity.x*=.1,t.velocity.y*=.1,t.angularVelocity=Le(.02),t.disabled=!0,Is(),setTimeout(()=>{t.remove=!0},300));else if(o.type==="split"){if(ie(t,o,ae)&&(p.bulletsHit++,p.damageDealt+=Math.min(o.hp,ee),o.hp-=ee,t.remove=!0,ut(),To(o,t,$t),o.hp<=0)){const s=Ao(o);++p.asteroidsDestroyed,o.remove=!0,o.hp=100,Pe(),ni(s,o)}}else ie(t,o,ae)&&(p.bulletsHit++,p.damageDealt+=Math.min(o.hp,ee),o.hp-=ee,o.hp<=0&&(++p.asteroidsDestroyed,o.remove=!0,Pe()),t.remove=!0,ut());else if(ie(t,c,ae)&&(wt(),t.remove=!0,c.hp<=0))break}for(const t of oe){t.progress+=e/1e3*Xt;const o={...t.position};ns(t,t.progress,a=>{if(a.remove=!0,++p.asteroidsDestroyed,p.damageDealt+=a.hp,Pe(),t.currentTarget>=t.targets.length-3){t.remove=!0;return}});const s=C(t.position,o),n=Math.sqrt(s.x**2+s.y**2);console.log("rocket distance",n)}for(const t of he)if(ke(t,e),Ge(t.position)&&(t.remove=!0),ze(t,c))switch(t.remove=!0,Ps(),t.type){case"health":c.hp+=1,c.hp=Math.min(c.hp,c.maxHp),et(c.hp);break;case"damage":ee+=1,In(ee);break;case"rocket-piercing":Ce+=1,En(Ce);break}if(c!==null&&c.hp>0){const t={...c.position};ke(c,e);const o={x:c.position.x-t.x,y:c.position.y-t.y},s=Math.sqrt(o.x**2+o.y**2);p.distanceTraveled+=s,Re(Math.min(s/100,.05));for(const n of E)if(ie(c,n,ae)&&(wt(),c.hp<=0))break}if(J==null)!g.forward&&!g.backward&&!g.left&&!g.right&&(c.velocity.x*=Math.pow(.25,e/1e3),c.velocity.y*=Math.pow(.25,e/1e3));else{const t=navigator.getGamepads()[J];Math.abs(t.axes[0])<.01&&Math.abs(t.axes[1])<.01&&!g.forward&&!g.backward&&!g.left&&!g.right&&!g.forwardController&&!g.backwardController&&!g.leftController&&!g.rightController&&(c.velocity.x*=Math.pow(.25,e/1e3),c.velocity.y*=Math.pow(.25,e/1e3))}(c.position.x<0||c.position.x>T.width)&&(c.position.x=Math.max(0,Math.min(c.position.x,T.width)),c.velocity.x*=-1),(c.position.y<0||c.position.y>T.height)&&(c.position.y=Math.max(0,Math.min(c.position.y,T.height)),c.velocity.y*=-1),Yn()},Yn=()=>{E.forEach(e=>{e.remove&&(D(we,e.id),e.frame=0,V(re,e))}),te.forEach(e=>{e.remove&&D(O,e.id)}),oe.forEach(e=>{e.remove&&(D(_,e.id),e.children.forEach(t=>{D(de,t.id)}))}),he.forEach(e=>{e.remove&&D(Fe,e.id)}),E=E.filter(e=>!e.remove),te=te.filter(e=>!e.remove),oe=oe.filter(e=>!e.remove),he=he.filter(e=>!e.remove)},Qt=(e,t,o,s,n,a,r,l=null,d=!1,m=0,h=0)=>{const u=K();if(u.position=e,u.rotation=t,u.acceleration=o,u.velocity=s,u.angularVelocity=n,u.mass=Ln(a,r),u.radius=r==="armored"?a*2:a,u.inertia=2/5*u.mass*a**2,u.hp=a/2,u.width=m,u.height=h,l?(u.texture=l,u.textureReady=!0):ot(u,Rn[r],u.radius*2,u.radius*2),u.type=r,r==="turret"&&(u.lastBulletTime=v,u.bulletIndex=0),!(!d&&ze(u,c))){for(const x of E)if(!d&&ze(u,x))return;V(we,u),E.push(u)}},Zt=(e,t,o,s,n)=>{const a=K();a.position=e,a.rotation=t,a.velocity=o,a.angularVelocity=s,a.mass=zt,a.radius=5,a.inertia=2/5*a.mass*a.radius**2,a.friendly=n,V(O,a),te.push(a),++p.bulletsFired},Xn=(e,t,o,s,n)=>{const a=K();a.position=e,a.rotation=t,a.velocity=o,a.angularVelocity=s,a.mass=zt,a.radius=5,a.targets=n,a.progress=0,a.currentTarget=0,os(a),is(a),V(_,a),oe.push(a),eo({x:-5,y:0},Math.PI/2,a),++p.rocketsFired},Jn=(e,t,o,s)=>{c=K(),c.position=e,c.rotation=t,c.velocity=o,c.angularVelocity=s,c.mass=10,c.drag=1,c.maxVelocity=.5,c.height=40,c.width=40,c.radius=c.width/2,c.maxHp=5,ne&&(c.maxHp=1),c.hp=c.maxHp,ot(c,Ds,c.height,c.width),V(be,c),bt({x:-5,y:18},0,ce,Fs,c),bt({x:-5,y:-18},0,ce,Cs,c)},bt=(e,t,o,s,n)=>{const a=K();a.position=e,a.rotation=t,a.parent=n,a.height=20,a.width=20,V(o,a),ot(a,s,a.height,a.width),n.children??(n.children=n.children||[]),n.children.push(a),eo({x:-5,y:0},Math.PI/2,a)},eo=(e,t,o)=>{const s=K();s.position=e,s.rotation=t,s.parent=o,s.height=10,s.width=5,o.children??(o.children=o.children||[]),o.children.push(s),V(de,s),Kn({x:0,y:0},0,s)},Kn=(e,t,o)=>{const s=K();s.position=e,s.rotation=t,s.parent=o,s.height=5,s.width=5,o.children??(o.children=o.children||[]),o.children.push(s),V(Ne,s)},Qn=(e,t,o,s,n)=>{if(ne&&["health"].includes(e))return;const a=K();a.type=e,a.position=t,a.rotation=o,a.velocity=s,a.angularVelocity=n,a.radius=25,V(Fe,a),he.push(a)},to=()=>{y=!y,y?(Gt(),Re(0)):Ae()},Zn=()=>{if(c){D(be,c.id);for(let e of c.children){D(ce,e.id);for(let t of e.children)D(de,t.id)}}},ei=()=>{T.width=T.clientWidth,T.height=T.clientHeight,Jn({x:T.width/2,y:T.height/2},0,{x:0,y:0},0),Pn(ne?1:5)},ti=()=>{ei(),jt(),tt=requestAnimationFrame(Kt)},oi=()=>{if(y)return;y=!0,cancelAnimationFrame(tt),Re(0),c=null;const e=Ut(!X,!L,se,ne);Tn(X,L,se,ne,p,e),kn(),us(!X,!L,se,ne)},si=()=>{Be=performance.now(),U=Be,De=U,Ke=U,Ye=U,Xe=U,Qe=U,hs(),qo(),E=[],te=[],oe=[],Je=1e3,Ce=3,ee=1,et(5),Ae(),je()},ot=(e,t,o,s)=>{const n=new Image;n.src=t,n.onload=()=>{const a=document.createElement("canvas");a.width=s,a.height=o,a.getContext("2d").drawImage(n,0,0,s,o),e.texture=a,e.textureReady=!0}},ni=(e,t)=>{for(let o=0;o<e.length;o++){const s=e[o],n=t.position,a={x:n.x+Math.random(),y:n.y+Math.random()},r=Ct(),l=t.rotation,d={x:r.x-a.x,y:r.y-a.y},m=Math.sqrt(d.x**2+d.y**2);m>0&&(d.x/=m,d.y/=m),d.x*=Math.random()*.1+.1,d.y*=Math.random()*.1+.1,se&&(d.x*=2,d.y*=2);const h=Le(.005),u=Math.max(s.width,s.height)/2;Qt(a,l,{x:0,y:0},d,h,u,"default",s,!0,s.width,s.height)}},ii=e=>{$t=e},ae=(e,t,o,s)=>{if(Jt)V(pe,{a:e,b:t,collisionPoint:o,normal:s,lifetime:100});else{const n={position:o,rotation:Math.random()*Math.PI*2};V(ge,n),setTimeout(()=>D(ge,n.id),100)}};Wn();
