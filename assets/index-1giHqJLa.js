(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const ne=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),Ke=(e,t)=>{e.x*=t,e.y*=t},Z=e=>({x:Math.cos(e),y:Math.sin(e)}),ge=e=>Math.sqrt(e.x**2+e.y**2);let S=new Map;const Xe=2e3,C=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const a=C(o),s=Math.cos(a.rotation),n=Math.sin(a.rotation);return{x:a.x+t.x*s-t.y*n,y:a.y+t.x*n+t.y*s,rotation:a.rotation+t.rotation}},Ye=(e,t)=>{S[e]||(S[e]=[]);const o=performance.now();S[e].push({x:t.x,y:t.y,time:o}),S[e]=S[e].filter(a=>o-a.time<Xe)},Qe=e=>{delete S[e]},Ze=e=>{for(const t in S){const o=S[t];if(!(!o||o.length<2)){e.beginPath();for(let a=0;a<o.length;a++){const s=o[a];a===0?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},et="/asteroid-pew-pew/img/boom/boom_0.gif",tt="/asteroid-pew-pew/img/boom/boom_1.gif",ot="/asteroid-pew-pew/img/boom/boom_2.gif",st="/asteroid-pew-pew/img/boom/boom_3.gif",at="/asteroid-pew-pew/img/boom/boom_4.gif",nt="/asteroid-pew-pew/img/boom/boom_5.gif",it="/asteroid-pew-pew/img/boom/boom_6.gif",rt="/asteroid-pew-pew/img/boom/boom_7.gif",ct="/asteroid-pew-pew/img/boom/boom_8.gif",lt="/asteroid-pew-pew/img/boom/boom_9.gif",dt="/asteroid-pew-pew/img/boom/boom_10.gif",mt="/asteroid-pew-pew/img/boom/boom_11.gif",ht="/asteroid-pew-pew/img/boom/boom_12.gif",ut="/asteroid-pew-pew/img/boom/boom_13.gif",gt="/asteroid-pew-pew/img/boom/boom_14.gif",A=document.getElementsByTagName("canvas")[0],i=A.getContext("2d"),N="asteroid",b="bullet",H="explosion",j="flash",M="rocket",W="spaceship",Se="velocity",R="spaceshippart",F="flames",pt="#ffffff",ft="#ffff00",q="#ff0000",pe="#00ff00";let yt=0;const wt=()=>`${yt++}`,k={[N]:{color:pt},[b]:{color:ft,length:10,strokeWidth:2},[M]:{color:q,radius:10},[W]:{color:pe},[Se]:{color:q},[R]:{color:pe},[F]:{color:q}},L={[F]:{},[W]:{},[R]:{},[N]:{},[b]:{},[M]:{},[H]:{},[j]:{}};let Le=!1,X=!1,Ie=!1,Be=!1;const xt=e=>{Le=e},vt=e=>{X=e},bt=e=>{Ie=e},Mt=e=>{Be=e},T=(e,t)=>{t.id=wt(),L[e][t.id]=t},E=(e,t)=>{delete L[e][t],Qe(t)},kt=()=>{for(const e in L)L[e]={}},h=[];for(let e=0;e<15;++e)h.push(new Image);h[0].src=et;h[1].src=tt;h[2].src=ot;h[3].src=st;h[4].src=at;h[5].src=nt;h[6].src=it;h[7].src=rt;h[8].src=ct;h[9].src=lt;h[10].src=dt;h[11].src=mt;h[12].src=ht;h[13].src=ut;h[14].src=gt;const Et=()=>{A.width=A.clientWidth,A.height=A.clientHeight,i.clearRect(0,0,A.width,A.height);for(const e in L)for(const t of Object.values(L[e])){switch(e){case N:Tt(t);break;case H:Lt(t);break;case b:Pt(t);break;case M:St(t);break;case W:case R:It(t);break;case F:Bt(t);break;case j:At(t);break}Ye(t.id,C(t))}if(Le){i.strokeStyle=k[Se].color,i.lineWidth=1,i.beginPath();for(const e in L){for(const t of Object.values(L[e]))if("velocity"in t){const{position:o,velocity:a}=t,{x:s,y:n}=o,{x:c,y:l}=a;i.moveTo(s,n),i.lineTo(s+c*200,n+l*200)}i.stroke()}}Ie&&Ze(i)},Tt=e=>{const{radius:t,texture:o}=e,a=C(e);i.save(),i.translate(a.x,a.y),i.rotate(a.rotation),i.drawImage(o,-t,-t,t*2,t*2),X&&(i.strokeStyle=q,i.lineWidth=1,i.beginPath(),i.moveTo(0,0),i.arc(0,0,t,0,2*Math.PI),i.stroke()),i.restore()},Pt=e=>{var s;const{length:t}=k[b],o=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;i.fillStyle=k[b].color,i.strokeStyle=k[b].color,i.lineWidth=(s=k[b])==null?void 0:s.strokeWidth,i.beginPath(),i.moveTo(e.position.x+o,e.position.y+a),i.lineTo(e.position.x-o,e.position.y-a),i.stroke()},St=e=>{var c;const{radius:t}=k[M],o=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},s={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},n={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(i.fillStyle=k[M].color,i.strokeStyle=k[M].color,i.lineWidth=((c=k[M])==null?void 0:c.strokeWidth)??0,i.beginPath(),i.moveTo(a.x,a.y),i.lineTo(s.x,s.y),i.lineTo(n.x,n.y),i.lineTo(a.x,a.y),i.stroke(),Be){i.strokeStyle="grey",i.beginPath(),i.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)i.lineTo(l.x,l.y),i.arc(l.x,l.y,2,0,2*Math.PI),i.moveTo(l.x,l.y);i.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),i.stroke()}},Lt=e=>{i.translate(e.position.x,e.position.y);const a=h[e.frame];i.drawImage(a,-100/2,-100/2,100,100),i.translate(-e.position.x,-e.position.y),e.frame<h.length-1?e.frame++:E(H,e.id)},It=e=>{const{width:t,height:o,texture:a}=e,s=C(e);i.save(),i.translate(s.x,s.y),i.rotate(s.rotation),i.drawImage(a,-t/2,-o/2,t,o),X&&(i.strokeStyle="lime",i.lineWidth=1,i.strokeRect(-t/2,-o/2,t,o)),i.restore()},Bt=e=>{var B,Q,_;const{width:t,height:o}=e,a=C(e),s=((B=e==null?void 0:e.parent)==null?void 0:B.velocity)??{x:0,y:1},n=((_=(Q=e==null?void 0:e.parent)==null?void 0:Q.parent)==null?void 0:_.velocity)??{x:0,y:0},c={x:s.x+n.x,y:s.y+n.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);i.save(),i.translate(a.x,a.y),i.rotate(a.rotation),i.beginPath();const m=Math.random()*5;i.moveTo(0,0),i.lineTo(-t,(o+m)*l),i.lineTo(t,(o+m)*l),i.closePath(),i.fillStyle="orange",i.fill(),i.beginPath(),i.moveTo(0,0),i.lineTo(-t/2,(o/2+m)*l),i.lineTo(t/2,(o/2+m)*l),i.closePath(),i.fillStyle="yellow",i.fill(),X&&(i.strokeStyle="lime",i.lineWidth=1,i.strokeRect(-t,0,t*2,o+m)),i.restore()},At=e=>{const t=e.position,o=3,a=15;i.fillStyle="white",i.beginPath(),i.moveTo(t.x+o,t.y+o),i.lineTo(t.x+a,t.y),i.lineTo(t.x+o,t.y-o),i.lineTo(t.x,t.y-a),i.lineTo(t.x-o,t.y-o),i.lineTo(t.x-a,t.y),i.lineTo(t.x-o,t.y+o),i.lineTo(t.x,t.y+a),i.closePath(),i.fill()},O=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),ee=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Ae=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),fe=(e,t)=>Ae(e,t)<e.radius+t.radius,te=(e,t,o,a)=>{if(e.frozen||t.frozen)return!1;const s=Ae(e,t);if(s>=e.radius+t.radius)return!1;const n={x:(t.position.x-e.position.x)/s,y:(t.position.y-e.position.y)/s},c=2*(e.velocity.x*n.x+e.velocity.y*n.y-t.velocity.x*n.x-t.velocity.y*n.y)/(e.mass+t.mass),l=e.radius+t.radius-s;a&&(e.position.x-=n.x*l,e.position.y-=n.y*l,t.position.x+=n.x*l,t.position.y+=n.y*l),e.velocity.x-=c*o*t.mass*n.x,e.velocity.y-=c*o*t.mass*n.y,t.velocity.x+=c*o*e.mass*n.x,t.velocity.y+=c*o*e.mass*n.y;const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2}};return T(j,m),setTimeout(()=>E(j,m.id),100),!0},ye=10,Dt=30,we=(e,t,o,a,s)=>.5*(2*o+(-t+a)*e+(2*t-5*o+4*a-s)*e*e+(-t+3*o-3*a+s)*e*e*e),De=(e,t,o,a,s)=>({x:we(e,t.x,o.x,a.x,s.x),y:we(e,t.y,o.y,a.y,s.y)}),Ve=(e,t)=>{const o=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return De(t%1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position)},Ue=(e,t)=>Ve(e,Re(e,t)),Vt=e=>{e.arcLengthTable=[];let t=0,o=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*ye;++c){const l=c/ye,m=Ve(e,l),B=ge(ne(m,o));t+=B,e.arcLengthTable.push({v:l,totalLength:t}),o=m}const a=e.targets.length-4,s=De(1,e.targets[a+0].position,e.targets[a+1].position,e.targets[a+2].position,e.targets[a+3].position),n=ge(ne(s,o));t+=n,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},Ut=e=>-(Math.cos(Math.PI*e)-1)/2,Re=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const B=m.totalLength-l.totalLength;if(B===0){o=m.v;break}const _=(t-l.totalLength)/B;o=l.v*(1-_)+m.v*_;break}}const a=Math.floor(o),s=o-a,n=Ut(s);return a+n},Rt=(e,t,o)=>{const a=Ue(e,t);e.velocity=ne(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const s=Math.max(Math.min(Math.floor(Re(e,t)),e.targets.length-3),0);if(s!==e.currentTarget&&(o(e.targets[s+1]),e.currentTarget=s),s>=e.targets.length-3){e.remove=!0;return}},Ft=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=Dt)e.pathPoints.push(Ue(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},P=document.getElementsByTagName("canvas")[0],Ot=()=>({x:Math.random()*P.width,y:Math.random()*P.height}),_t=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*P.width,y:-90};case 1:return{x:P.width+t,y:Math.random()*P.height};case 2:return{x:Math.random()*P.width,y:P.height+t};case 3:return{x:-90,y:Math.random()*P.height}}},Ct=e=>(Math.random()*2-1)*e,Nt=()=>{const e=[20,30,40];return e[Math.floor(Math.random()*e.length)]},x={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},Ht=JSON.stringify(x),Fe=(e,t)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default"),Oe=(e,t)=>{const o=Fe(e,t);return JSON.parse(localStorage.getItem(o)||Ht)},d={...x},Wt=(e,t)=>{const o=Oe(e,t);o.timePlayed=Math.max(o.timePlayed,d.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,d.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,d.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,d.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,d.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,d.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,d.distanceTraveled),localStorage.setItem(Fe(e,t),JSON.stringify(o))},Gt=()=>{d.timePlayed=x.timePlayed,d.asteroidsDestroyed=x.asteroidsDestroyed,d.damageDealt=x.damageDealt,d.bulletsFired=x.bulletsFired,d.bulletsHit=x.bulletsHit,d.rocketsFired=x.rocketsFired,d.distanceTraveled=x.distanceTraveled},qt="/asteroid-pew-pew/audio/propulsion.mp3",$t="/asteroid-pew-pew/audio/explosion.wav",jt="/asteroid-pew-pew/audio/shoot.wav",zt="/asteroid-pew-pew/audio/hurt.wav",_e="/asteroid-pew-pew/audio/hit.wav",Jt="/asteroid-pew-pew/audio/click.wav",Kt="/asteroid-pew-pew/audio/submit.wav",Xt="/asteroid-pew-pew/audio/CODEX_2015.mp3";let w=.5;const Yt=e=>{me.volume=.05*e,w=e},Y=new Audio(qt);Y.volume=0;Y.loop=!0;document.addEventListener("keydown",()=>Y.play().catch(()=>{}),{once:!0});const z=e=>{Y.volume=e*w},J=()=>{const e=new Audio(Kt);e.volume=.5*w,e.play().catch(()=>{})},v=()=>{const e=new Audio(Jt);e.volume=.5*w,e.play().catch(()=>{})},Qt=()=>{const e=new Audio(_e);e.volume=.1*w,e.play().catch(()=>{})},Zt=()=>{const e=new Audio(zt);e.volume=.3*w,e.play().catch(()=>{})},eo=()=>{const e=new Audio(jt);e.volume=.1*w,e.play().catch(()=>{})},to=()=>{const e=new Audio(_e);e.volume=.2*w,e.play().catch(()=>{})},oe=()=>{const e=new Audio($t);e.volume=.3*w,e.play().catch(()=>{})},me=new Audio(Xt);me.volume=.05*w;me.loop=!0;const oo="/asteroid-pew-pew/img/Asteroid1.png",so="/asteroid-pew-pew/img/Spaceship.png",ao="/asteroid-pew-pew/img/WingLeft.png",no="/asteroid-pew-pew/img/WingRight.png";document.getElementsByTagName("canvas")[0];let io=document.getElementById("entity-count"),ro=document.getElementById("fps"),co=document.getElementById("ups"),lo=document.getElementById("target-fps"),mo=document.getElementById("target-ups"),Ce=document.getElementById("pause-menu");const Ne=document.getElementById("main-menu"),ho=document.getElementById("pause-resume"),uo=document.getElementById("debug-velocity"),go=document.getElementById("debug-hitbox"),po=document.getElementById("debug-trajectory"),fo=document.getElementById("debug-spline-paths"),yo=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const xe=document.getElementById("hp"),He=document.getElementById("game-over"),wo=document.getElementById("time-played"),xo=document.getElementById("asteroids-destroyed"),vo=document.getElementById("distance-traveled"),bo=document.getElementById("damage-dealt"),Mo=document.getElementById("start"),ko=document.getElementById("restart"),Eo=document.getElementById("volume"),To=document.getElementById("mode-pacifist"),Po=document.getElementById("mode-stationary"),So=document.getElementById("mark-pacifist"),Lo=document.getElementById("mark-stationary"),Io=document.getElementById("back-to-main-menu"),Bo=(e,t,o,a,s,n,c,l,m)=>{Ao(e,m,t,o),Uo(a,s,n,c,l),Fo(e,m)},Ao=(e,t,o,a)=>{Mo.addEventListener("click",()=>{J(),Vo(),t(),e()}),To.addEventListener("change",s=>{v(),o(!s.target.checked)}),Po.addEventListener("change",s=>{v(),a(!s.target.checked)})},Do=()=>{Ne.style.display="grid"},Vo=()=>{Ne.style.display="none"},Uo=(e,t,o,a,s)=>{Eo.addEventListener("input",n=>{e(n.target.value/100)}),lo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),t(1e3/n.target.value)}),mo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),o(1e3/n.target.value)}),uo.addEventListener("change",n=>{v(),xt(n.target.checked)}),go.addEventListener("change",n=>{v(),vt(n.target.checked)}),po.addEventListener("change",n=>{v(),bt(n.target.checked)}),fo.addEventListener("change",n=>{v(),Mt(n.target.checked)}),yo.addEventListener("change",n=>{v(),n.target.value=Math.max(0,Math.min(1e3,Number(n.target.value))),a(n.target.value)}),ho.addEventListener("click",()=>{J(),he(),s()})},Ro=()=>{Ce.style.display="flex"},he=()=>{Ce.style.display="none"},Fo=(e,t)=>{ko.addEventListener("click",()=>{J(),ie(),t(),e()}),Io.addEventListener("click",()=>{J(),ie(),Do()})},Oo=()=>{He.style.display="grid"},ie=()=>{He.style.display="none"},_o=(e,t,o,a)=>{So.style.display=e?"none":"block",Lo.style.display=t?"none":"block",G(wo,(o.timePlayed/1e3).toFixed(1),(a.timePlayed/1e3).toFixed(1),"s"),G(xo,o.asteroidsDestroyed,a.asteroidsDestroyed),G(vo,o.distanceTraveled.toFixed(1),a.distanceTraveled.toFixed(1),"m"),G(bo,o.damageDealt,a.damageDealt,"hp")},G=(e,t,o,a)=>{e.children.item(1).innerText=a?`${t} ${a}`:`${t}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${o} ${a}`:o} )`)},We=e=>{if(e==5)for(let t of xe.children)t.style.color="red";else xe.children.item(e).style.color="grey"},Co=(e,t,o)=>{io.innerText=`${e}`,ro.innerText=`${t}`,co.innerText=`${o}`};let p=document.getElementsByTagName("canvas")[0];const Ge=2e3,No=3,Ho=e=>4/3*Math.PI*e**3*3.5;let g=!0;const qe=()=>g=!1;let ue,$=1e3/120;const Wo=e=>$=e;let $e=1e3/60;const Go=e=>$e=e;let K=0,ve=0,re=0,U=!0;const qo=e=>U=e;let I=!0;const $o=e=>I=e;let se=0,ae=0,f=[],D=[],V=[],r=null,be=0,ce=!1,Me=0,jo=40,le=!1,zo=3e3,ke=0,je=300;const Jo=e=>je=e;let de=1e3,Ee=0;const Ko=e=>Math.pow(.99,e/1e3)*1e3;let u={forward:!1,backward:!1,left:!1,right:!1};const Xo=()=>{K=performance.now(),re=K,Yo(),Bo(cs,qo,$o,Yt,Go,Wo,Jo,qe,ds)},Yo=()=>{document.addEventListener("keydown",e=>{switch(e.key){case"Escape":ns();break;case" ":ce=!g&&U;break;case"Shift":le=!g&&U;break;case"ArrowUp":case"w":u.forward=!g&&I;break;case"ArrowDown":case"s":u.backward=!g&&I;break;case"ArrowLeft":case"a":u.left=!g&&I;break;case"ArrowRight":case"d":u.right=!g&&I;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":ce=!1;break;case"Shift":le=!1;break;case"ArrowUp":case"w":u.forward=!1;break;case"ArrowDown":case"s":u.backward=!1;break;case"ArrowLeft":case"a":u.left=!1;break;case"ArrowRight":case"d":u.right=!1;break}}),document.addEventListener("mousemove",e=>{if(g||r==null)return;const t=e.clientX-p.getBoundingClientRect().left,o=e.clientY-p.getBoundingClientRect().top,a=t-r.position.x,s=o-r.position.y;r.rotation=Math.atan2(s,a)})};let y=performance.now();const ze=()=>{for(y=performance.now();ve+$/2<=y;)g||(Zo($),++se),ve+=$;if(K+$e/2<=y&&(g||(Et(),++ae),K=y),y-re>=1e3){const e=f.length+D.length+V.length+(r?1:0);Co(e,ae,se),ae=0,se=0,re=y}ue=requestAnimationFrame(ze)},Qo=e=>{if(ce&&y-Me>=jo&&r){const t=r.rotation+(Math.random()-.5)*.1,o=be%2===0?-1:1,a=Z(r.rotation+Math.PI/2*o);a.x*=10,a.y*=10,a.x+=r.position.x,a.y+=r.position.y,os(a,t,Z(t),0),eo(),be++,Me=y}if(le&&y-ke>=zo&&r){const t=[{position:{x:r.position.x-Math.cos(r.rotation)*100,y:r.position.y-Math.sin(r.rotation)*100}},{position:{x:r.position.x,y:r.position.y}}];for(let o=0;o<Math.min(No,f.length);o++){let a;do a=f[Math.floor(Math.random()*f.length)];while(t.includes(a));a.frozen=!0,a.velocity.x=0,a.velocity.y=0,t.push(a)}t.push(r),ss({...r.position},r.rotation,Ke(Z(r.rotation),.2),0,t),ke=y}if(y-Ee>=de){const t=_t(),o=Ot(),a=Math.random()*Math.PI*2,s={x:o.x-t.x,y:o.y-t.y},n=Math.sqrt(s.x**2+s.y**2);n>0&&(s.x/=n,s.y/=n),s.x*=Math.random()*.1+.1,s.y*=Math.random()*.1+.1;const c=Ct(.01),l=Nt();ts(t,a,{x:0,y:0},s,c,l),Ee=y,de=Ko(d.timePlayed)}r&&(u.forward&&(r.force.y-=.004),u.backward&&(r.force.y+=.004),u.left&&(r.force.x-=.004),u.right&&(r.force.x+=.004))},Te=e=>e.x<-100||e.x>p.width+100||e.y<-100||e.y>p.height+100,Zo=e=>{Qo(),d.timePlayed+=e;for(const s of f){ee(s,e),Te(s.position)&&(s.remove=!0);for(const n of f)s!==n&&te(s,n,1,!0)&&Qt()}for(const s of D){ee(s,e),Te(s.position)&&(s.remove=!0);for(const n of f)te(s,n,1,!1)&&(s.remove=!0,n.hp-=1,d.bulletsHit++,d.damageDealt++,to(),n.hp<=0&&(++d.asteroidsDestroyed,n.remove=!0,oe()))}for(const s of V)s.progress+=e/1e3*je,Rt(s,s.progress,n=>{n.remove=!0,++d.asteroidsDestroyed,d.damageDealt+=(n==null?void 0:n.hp)??0,oe()});const t={...r.position};ee(r,e);const o={x:r.position.x-t.x,y:r.position.y-t.y},a=Math.sqrt(o.x**2+o.y**2);d.distanceTraveled+=a,z(Math.min(a/100,.05));for(const s of f)if(te(r,s,1,!0)&&(r.hp-=1,Zt(),r.hp>=0&&We(r.hp),r.hp<=0)){oe(),is(),z(0),T(H,{position:{...r.position},frame:0}),setTimeout(()=>{ls()},1e3);break}!u.forward&&!u.backward&&!u.left&&!u.right&&(r.velocity.x*=Math.pow(.25,e/1e3),r.velocity.y*=Math.pow(.25,e/1e3)),(r.position.x<0||r.position.x>p.width)&&(r.position.x=Math.max(0,Math.min(r.position.x,p.width)),r.velocity.x*=-1),(r.position.y<0||r.position.y>p.height)&&(r.position.y=Math.max(0,Math.min(r.position.y,p.height)),r.velocity.y*=-1),es()},es=()=>{f.forEach(e=>{e.remove&&(E(N,e.id),e.frame=0,T(H,e))}),D.forEach(e=>{e.remove&&E(b,e.id)}),V.forEach(e=>{e.remove&&(E(M,e.id),e.children.forEach(t=>{E(F,t.id)}))}),f=f.filter(e=>!e.remove),D=D.filter(e=>!e.remove),V=V.filter(e=>!e.remove)},ts=(e,t,o,a,s,n)=>{const c=O();c.position=e,c.rotation=t,c.acceleration=o,c.velocity=a,c.angularVelocity=s,c.mass=Ho(n),c.radius=n,c.inertia=2/5*c.mass*n**2,c.hp=n/2;const l=new Image;if(l.src=oo,c.texture=l,!fe(c,r)){for(const m of f)if(fe(c,m))return;T(N,c),f.push(c)}},os=(e,t,o,a)=>{const s=O();s.position=e,s.rotation=t,s.velocity=o,s.angularVelocity=a,s.mass=Ge,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,T(b,s),D.push(s),++d.bulletsFired},ss=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.velocity=o,n.angularVelocity=a,n.mass=Ge,n.radius=5,n.targets=s,n.progress=0,n.currentTarget=0,Vt(n),Ft(n),T(M,n),V.push(n),Je({x:-5,y:0},Math.PI/2,n),++d.rocketsFired},as=(e,t,o,a)=>{r=O(),r.position=e,r.rotation=t,r.velocity=o,r.angularVelocity=a,r.mass=10,r.drag=1,r.maxVelocity=.5,r.height=40,r.width=40,r.radius=r.width/2,r.hp=5;const s=new Image;s.src=so,r.texture=s,T(W,r),Pe({x:-5,y:18},0,R,no,r),Pe({x:-5,y:-18},0,R,ao,r)},Pe=(e,t,o,a,s)=>{const n=O();n.position=e,n.rotation=t,n.parent=s,n.height=20,n.width=20,T(o,n);const c=new Image;c.src=a,n.texture=c,s.children??(s.children=s.children||[]),s.children.push(n),Je({x:-5,y:0},1.5707964,n)},Je=(e,t,o)=>{const a=O();a.position=e,a.rotation=t,a.parent=o,a.height=10,a.width=5,o.children??(o.children=o.children||[]),o.children.push(a),T(F,a)},ns=()=>{g=!g,g?(Ro(),z(0)):he()},is=()=>{if(r){E(W,r.id);for(let e of r.children){E(R,e.id);for(let t of e.children)E(F,t.id)}}},rs=()=>{p.width=p.clientWidth,p.height=p.clientHeight,as({x:p.width/2,y:p.height/2},0,{x:0,y:0},0)},cs=()=>{rs(),qe(),ue=requestAnimationFrame(ze)},ls=()=>{cancelAnimationFrame(ue),g=!0,z(0),r=null;const e=Oe(!U,!I);_o(U,I,d,e),Oo(),Wt(!U,!I)},ds=()=>{Gt(),kt(),f=[],D=[],V=[],de=1e3,We(5),he(),ie()};Xo();
