(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let H=new Map;const Xt=2e3,se=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},n=e.parent;if(n==null)return t;const a=se(n),o=Math.cos(a.rotation),s=Math.sin(a.rotation);return{x:a.x+t.x*o-t.y*s,y:a.y+t.x*s+t.y*o,rotation:a.rotation+t.rotation}},Yt=(e,t)=>{H[e]||(H[e]=[]);const n=performance.now();H[e].push({x:t.x,y:t.y,time:n}),H[e]=H[e].filter(a=>n-a.time<Xt)},Jt=e=>{delete H[e]},Kt=e=>{for(const t in H){const n=H[t];if(!(!n||n.length<2)){e.beginPath();for(let a=0;a<n.length;a++){const o=n[a];a===0?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},Qt="/asteroid-pew-pew/img/boom/boom_0.gif",Zt="/asteroid-pew-pew/img/boom/boom_1.gif",eo="/asteroid-pew-pew/img/boom/boom_2.gif",to="/asteroid-pew-pew/img/boom/boom_3.gif",oo="/asteroid-pew-pew/img/boom/boom_4.gif",so="/asteroid-pew-pew/img/boom/boom_5.gif",no="/asteroid-pew-pew/img/boom/boom_6.gif",ao="/asteroid-pew-pew/img/boom/boom_7.gif",ro="/asteroid-pew-pew/img/boom/boom_8.gif",io="/asteroid-pew-pew/img/boom/boom_9.gif",co="/asteroid-pew-pew/img/boom/boom_10.gif",lo="/asteroid-pew-pew/img/boom/boom_11.gif",mo="/asteroid-pew-pew/img/boom/boom_12.gif",uo="/asteroid-pew-pew/img/boom/boom_13.gif",ho="/asteroid-pew-pew/img/boom/boom_14.gif",go="/asteroid-pew-pew/img/ice.png",po="/asteroid-pew-pew/img/powerup.png",ut=5,$e=.7,R=10;function fo(e,t){const n=[];for(let a=0;a<ut;a++){const o=Math.random()*2*Math.PI,s=Math.sqrt(Math.random())*t,c=Math.cos(o)*s,d=Math.sin(o)*s,l=$e*e.x,m=$e*e.y,g=l+c,y=m+d;g*g+y*y<=Math.pow(t,2)?n.push({x:g,y}):a--}return n}function yo(e,t){const{position:n,rotation:a,fractureSeeds:o}=t,s=Math.cos(a),c=Math.sin(a);e.fillStyle="red";for(const d of o){const l={x:n.x+d.x*s-d.y*c,y:n.y+d.x*c+d.y*s};e.beginPath(),e.arc(l.x,l.y,2,0,Math.PI*2),e.fill()}}function xo(e,t){const n=t.position.x-e.position.x,a=t.position.y-e.position.y,o=Math.sin(-e.rotation),s=Math.cos(-e.rotation);return{x:n*s-a*o,y:n*o+a*s}}function wo(e,t=null){const{fractureSeeds:n,radius:a}=e,o=a*2,s=a*2,c=new Uint8Array(o*s),d=document.createElement("canvas");d.width=o,d.height=s;const l=d.getContext("2d"),m=l.getImageData(0,0,o,s),g=m.data,y=o/2,E=s/2;for(let w=0;w<s;w++)for(let x=0;x<o;x++){const p=x-y,U=w-E;if(p*p+U*U>a*a)continue;let W=1/0,Q=-1;for(let de=0;de<n.length;de++){const Ne=n[de];let Pe=x-y-Ne.x,Se=w-E-Ne.y;if(t){const Ge=t(x,w);Pe+=(Ge-.5)*10,Se+=(Ge-.5)*10}const We=Pe*Pe+Se*Se;We<W&&(W=We,Q=de)}c[w*o+x]=Q;const ce=Math.sqrt(W),Ie=Math.min(1,ce/a),le=(w*o+x)*4,[$t,zt,jt]=bo(Ie);g[le]=$t,g[le+1]=zt,g[le+2]=jt,g[le+3]=255}return l.putImageData(m,0,0),{heatMap:d,cellMap:c}}function bo(e){if(e=Math.max(0,Math.min(1,e)),e<.33){const t=e/.33;return[255,Math.round(255*t),0]}else if(e<.66){const t=(e-.33)/.33;return[Math.round(255*(1-t)),255,0]}else{const t=(e-.66)/.34;return[0,Math.round(255*(1-t)),Math.round(255*t)]}}function vo(e){const t=e.radius*2,n=e.radius*2,a=new Float32Array(n*t),o=Math.floor(n/R)+2,s=Math.floor(t/R)+2,c=[];for(let l=0;l<s*o;l++)c.push(Math.random());for(let l=0;l<t;l++)for(let m=0;m<n;m++){const g=Math.floor(m/R),y=Math.floor(l/R),E=m%R/R,w=l%R/R,x=y*o+g,p=c[x],U=c[x+1],W=c[x+o],Q=c[x+o+1],ce=p*(1-E)+U*E,Ie=W*(1-E)+Q*E;a[l*n+m]=ce*(1-w)+Ie*w}return(l,m)=>a[m*n+l]}function Mo(e,t,n){const a=[],o=n.radius*2,s=n.radius*2;t.length!==o*s&&console.error("Cell map size mismatch");for(let c=0;c<ut;c++){const d=document.createElement("canvas");d.width=o,d.height=s;const l=d.getContext("2d"),m=l.createImageData(o,s);let g=m.data;const w=e.getContext("2d").getImageData(0,0,o,s).data;for(let x=0;x<t.length;x++){if(t[x]!==c)continue;const p=x*4;g[p]=w[p],g[p+1]=w[p+1],g[p+2]=w[p+2],g[p+3]=w[p+3]}l.putImageData(m,0,0),a.push(d)}return a}const G=document.getElementsByTagName("canvas")[0],r=G.getContext("2d"),ne="asteroid",B="bullet",ae="explosion",fe="flash",D="rocket",re="spaceship",ht="velocity",J="spaceshippart",K="flames",ke="powerup",ko="#ffffff",Eo="#ffff00",he="#ff0000",ze="#00ff00";let To=0;const Io=()=>`${To++}`,V={[ne]:{color:ko},[B]:{color:Eo,length:10,strokeWidth:2},[D]:{color:he,radius:10},[re]:{color:ze},[ht]:{color:he},[J]:{color:ze},[K]:{color:he}},O={[K]:{},[re]:{},[J]:{},[ne]:{},[B]:{},[D]:{},[ae]:{},[fe]:{},[ke]:{}};let gt=!1,ie=!1,pt=!1,ft=!1,yt=!1;const Po=e=>{gt=e},So=e=>{ie=e},Lo=e=>{pt=e},Ao=e=>{ft=e},Bo=e=>{yt=e},L=(e,t)=>{t.id=Io(),O[e][t.id]=t},S=(e,t)=>{delete O[e][t],Jt(t)},Do=()=>{for(const e in O)O[e]={}},v=[];for(let e=0;e<15;++e)v.push(new Image);v[0].src=Qt;v[1].src=Zt;v[2].src=eo;v[3].src=to;v[4].src=oo;v[5].src=so;v[6].src=no;v[7].src=ao;v[8].src=ro;v[9].src=io;v[10].src=co;v[11].src=lo;v[12].src=mo;v[13].src=uo;v[14].src=ho;const xt=new Image;xt.src=go;const Vo=()=>{G.width=G.clientWidth,G.height=G.clientHeight,r.clearRect(0,0,G.width,G.height);for(const e in O)for(const t of Object.values(O[e])){switch(e){case ne:Co(t);break;case ae:Fo(t);break;case B:Uo(t);break;case D:Ro(t);break;case re:case J:Ho(t);break;case K:Oo(t);break;case fe:_o(t);break;case ke:qo(t);break}Yt(t.id,se(t))}if(gt){r.strokeStyle=V[ht].color,r.lineWidth=1,r.beginPath();for(const e in O){for(const t of Object.values(O[e]))if("velocity"in t){const{position:n,velocity:a}=t,{x:o,y:s}=n,{x:c,y:d}=a;r.moveTo(o,s),r.lineTo(o+c*200,s+d*200)}r.stroke()}}pt&&Kt(r)},Co=e=>{const{radius:t,texture:n,textureReady:a}=e;if(!a)return;const o=se(e);r.save(),r.translate(o.x,o.y),r.rotate(o.rotation),r.drawImage(n,-t,-t,t*2,t*2),ie&&(r.strokeStyle=he,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(xt,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore(),yt&&yo(r,e)},Uo=e=>{var o;const{length:t}=V[B],n=Math.cos(e.rotation)*t/2,a=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?V[B].color:"red",r.strokeStyle=e.friendly?V[B].color:"red",r.lineWidth=(o=V[B])==null?void 0:o.strokeWidth,r.beginPath(),r.moveTo(e.position.x+n,e.position.y+a),r.lineTo(e.position.x-n,e.position.y-a),r.stroke()},Ro=e=>{var c;const{radius:t}=V[D],n=2*Math.PI/8,a={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},o={x:e.position.x-t*Math.cos(e.rotation+n),y:e.position.y-t*Math.sin(e.rotation+n)},s={x:e.position.x-t*Math.cos(e.rotation-n),y:e.position.y-t*Math.sin(e.rotation-n)};if(r.fillStyle=V[D].color,r.strokeStyle=V[D].color,r.lineWidth=((c=V[D])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(a.x,a.y),r.lineTo(o.x,o.y),r.lineTo(s.x,s.y),r.lineTo(a.x,a.y),r.stroke(),ft){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const d of e.pathPoints)r.lineTo(d.x,d.y),r.arc(d.x,d.y,2,0,2*Math.PI),r.moveTo(d.x,d.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},Fo=e=>{r.translate(e.position.x,e.position.y);const a=v[e.frame];r.drawImage(a,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<v.length-1?e.frame++:S(ae,e.id)},Ho=e=>{const{width:t,height:n,texture:a,textureReady:o}=e;if(!o)return;const s=se(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(a,-t/2,-n/2,t,n),ie&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-n/2,t,n)),r.restore()},Oo=e=>{var m,g,y;const{width:t,height:n}=e,a=se(e),o=((m=e==null?void 0:e.parent)==null?void 0:m.velocity)??{x:0,y:1},s=((y=(g=e==null?void 0:e.parent)==null?void 0:g.parent)==null?void 0:y.velocity)??{x:0,y:0},c={x:o.x+s.x,y:o.y+s.y},d=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(a.x,a.y),r.rotate(a.rotation),r.beginPath();const l=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(n+l)*d),r.lineTo(t,(n+l)*d),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(n/2+l)*d),r.lineTo(t/2,(n/2+l)*d),r.closePath(),r.fillStyle="yellow",r.fill(),ie&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,n+l)),r.restore()},_o=e=>{const t=e.position,n=e.rotation,a=3,o=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(n),r.moveTo(a,a),r.lineTo(o,0),r.lineTo(a,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,a),r.lineTo(0,o),r.resetTransform(),r.closePath(),r.fill()},wt=new Image;wt.src=po;const qo=e=>{const{radius:t}=e,n=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(wt,-t,-t,n,n),ie&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,n,n)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("💚",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.fillStyle="blue",r.textAlign="center",r.font="20px Arial",r.fillText("🚀",0,7);break}r.restore()},N=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null,fractureSeeds:[],textureReady:!1}),me=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const n=Math.sqrt(e.velocity.x**2+e.velocity.y**2);n>e.maxVelocity&&(e.velocity.x/=n/e.maxVelocity,e.velocity.y/=n/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},bt=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),Ce=(e,t)=>bt(e,t)<e.radius+t.radius,Y=(e,t,n,a)=>{const o=bt(e,t);if(o>=e.radius+t.radius)return!1;const s={x:(t.position.x-e.position.x)/o,y:(t.position.y-e.position.y)/o},c=2*(e.velocity.x*s.x+e.velocity.y*s.y-t.velocity.x*s.x-t.velocity.y*s.y)/(e.mass+t.mass),d=e.radius+t.radius-o;a&&(e.position.x-=s.x*d,e.position.y-=s.y*d,t.position.x+=s.x*d,t.position.y+=s.y*d),e.frozen||(e.velocity.x-=c*n*t.mass*s.x,e.velocity.y-=c*n*t.mass*s.y),t.frozen||(t.velocity.x+=c*n*e.mass*s.x,t.velocity.y+=c*n*e.mass*s.y);const l={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return L(fe,l),setTimeout(()=>S(fe,l.id),100),!0},Le=e=>{const t=Math.sqrt(e.x**2+e.y**2);return{x:e.x/t,y:e.y/t}},ye=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),No=(e,t)=>{e.x*=t,e.y*=t},Wo=(e,t,n)=>({x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}),Ae=e=>({x:Math.cos(e),y:Math.sin(e)}),Go=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},je=e=>Math.sqrt(e.x**2+e.y**2),Xe=10,$o=30,Ye=(e,t,n,a,o)=>.5*(2*n+(-t+a)*e+(2*t-5*n+4*a-o)*e*e+(-t+3*n-3*a+o)*e*e*e),vt=(e,t,n,a,o)=>({x:Ye(e,t.x,n.x,a.x,o.x),y:Ye(e,t.y,n.y,a.y,o.y)}),Mt=(e,t)=>{const n=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return vt(t%1,e.targets[n+0].position,e.targets[n+1].position,e.targets[n+2].position,e.targets[n+3].position)},kt=(e,t)=>Mt(e,Et(e,t)),zo=e=>{e.arcLengthTable=[];let t=0,n=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*Xe;++c){const d=c/Xe,l=Mt(e,d),m=je(ye(l,n));t+=m,e.arcLengthTable.push({v:d,totalLength:t}),n=l}const a=e.targets.length-4,o=vt(1,e.targets[a+0].position,e.targets[a+1].position,e.targets[a+2].position,e.targets[a+3].position),s=je(ye(o,n));t+=s,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},jo=e=>-(Math.cos(Math.PI*e)-1)/2,Et=(e,t)=>{let n=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const d=e.arcLengthTable[c-1],l=e.arcLengthTable[c];if(t<l.totalLength){const m=l.totalLength-d.totalLength;if(m===0){n=l.v;break}const y=(t-d.totalLength)/m;n=d.v*(1-y)+l.v*y;break}}const a=Math.floor(n),o=n-a,s=jo(o);return a+s},Xo=(e,t,n)=>{const a=kt(e,t);e.velocity=ye(a,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=a;const o=Math.max(Math.min(Math.floor(Et(e,t)),e.targets.length-3),0);if(o!==e.currentTarget&&(n(e.targets[o+1]),e.currentTarget=o),o>=e.targets.length-3){e.remove=!0;return}},Yo=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let n=0;n<=t;n+=$o)e.pathPoints.push(kt(e,n));e.pathPoints.push(e.targets[e.targets.length-2].position)},F=document.getElementsByTagName("canvas")[0],Tt=()=>({x:Math.random()*F.width,y:Math.random()*F.height}),Je=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*F.width,y:-90};case 1:return{x:F.width+t,y:Math.random()*F.height};case 2:return{x:Math.random()*F.width,y:F.height+t};case 3:return{x:-90,y:Math.random()*F.height}}},xe=e=>(Math.random()*2-1)*e,Jo=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},Ko=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],n=Math.random();for(let a=0;a<e.length;a++)if(n<t[a])return e[a];return e[e.length-1]},It=(e,t)=>{const n=Math.random();let a=0;for(let o=0;o<t.length;o++)if(a+=t[o],n<a)return e[o];return e[t.length-1]},Qo=()=>It(["default","homing","armored","turret"],[.85,.05,.05,.05]),Zo=()=>It(["homing","armored","turret"],[.34,.33,.33]),A={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},es=JSON.stringify(A),Pt=(e,t,n,a)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default")+(n?"-extreme":"-default")+(a?"-hitless":"-default"),St=(e,t,n,a)=>{const o=Pt(e,t,n,a);return JSON.parse(localStorage.getItem(o)||es)},h={...A},ts=(e,t,n,a)=>{const o=St(e,t,n,a);o.timePlayed=Math.max(o.timePlayed,h.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,h.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,h.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,h.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,h.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,h.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,h.distanceTraveled),localStorage.setItem(Pt(e,t,n),JSON.stringify(o))},os=()=>{h.timePlayed=A.timePlayed,h.asteroidsDestroyed=A.asteroidsDestroyed,h.damageDealt=A.damageDealt,h.bulletsFired=A.bulletsFired,h.bulletsHit=A.bulletsHit,h.rocketsFired=A.rocketsFired,h.distanceTraveled=A.distanceTraveled},ss="/asteroid-pew-pew/audio/propulsion.mp3",ns="/asteroid-pew-pew/audio/explosion.wav",as="/asteroid-pew-pew/audio/shoot.wav",rs="/asteroid-pew-pew/audio/hurt.wav",Lt="/asteroid-pew-pew/audio/hit.wav",is="/asteroid-pew-pew/audio/click.wav",cs="/asteroid-pew-pew/audio/submit.wav",ls="/asteroid-pew-pew/audio/powerup.wav",ds="/asteroid-pew-pew/audio/CODEX_2015.mp3",ms="/asteroid-pew-pew/audio/armorHit.wav";let P=.5;const us=e=>{He.volume=.05*e,P=e},Ee=new Audio(ss);Ee.volume=0;Ee.loop=!0;document.addEventListener("keydown",()=>Ee.play().catch(()=>{}),{once:!0});const Te=e=>{Ee.volume=e*P},ee=()=>{const e=new Audio(cs);e.volume=.5*P,e.play().catch(()=>{})},T=()=>{const e=new Audio(is);e.volume=.5*P,e.play().catch(()=>{})},hs=()=>{const e=new Audio(Lt);e.volume=.1*P,e.play().catch(()=>{})},gs=()=>{const e=new Audio(rs);e.volume=.3*P,e.play().catch(()=>{})},At=()=>{const e=new Audio(as);e.volume=.1*P,e.play().catch(()=>{})},Ke=()=>{const e=new Audio(Lt);e.volume=.2*P,e.play().catch(()=>{})},ps=()=>{const e=new Audio(ms);e.volume=.2*P,e.play().catch(()=>{})},ge=()=>{const e=new Audio(ns);e.volume=.3*P,e.play().catch(()=>{})},fs=()=>{const e=new Audio(ls);e.volume=.2*P,e.play().catch(()=>{})},He=new Audio(ds);He.volume=.05*P;He.loop=!0;const Qe="/asteroid-pew-pew/img/Asteroid1.png",ys="/asteroid-pew-pew/img/asteroid_red.png",xs="/asteroid-pew-pew/img/asteroid_armored.png",ws="/asteroid-pew-pew/img/asteroid_green.png",bs="/asteroid-pew-pew/img/Spaceship.png",vs="/asteroid-pew-pew/img/WingLeft.png",Ms="/asteroid-pew-pew/img/WingRight.png";let ks=document.getElementById("entity-count"),Es=document.getElementById("fps"),Ts=document.getElementById("ups"),Is=document.getElementById("target-fps"),Ps=document.getElementById("target-ups"),Bt=document.getElementById("pause-menu");const Dt=document.getElementById("main-menu"),Ss=document.getElementById("pause-resume"),Ls=document.getElementById("debug-velocity"),As=document.getElementById("debug-hitbox"),Bs=document.getElementById("debug-trajectory"),Ds=document.getElementById("debug-spline-paths"),Vs=document.getElementById("debug-rocket-speed"),Cs=document.getElementById("debug-draw-seeds");document.getElementById("fire-rate");const Us=document.getElementById("rocket-piercing"),Rs=document.getElementById("bullet-damage"),we=document.getElementById("hp"),Vt=document.getElementById("game-over"),Fs=document.getElementById("time-played"),Hs=document.getElementById("asteroids-destroyed"),Os=document.getElementById("distance-traveled"),_s=document.getElementById("damage-dealt"),qs=document.getElementById("start"),Ns=document.getElementById("restart"),Ws=document.getElementById("volume"),Gs=document.getElementById("mode-pacifist"),$s=document.getElementById("mode-stationary"),zs=document.getElementById("mode-extreme"),js=document.getElementById("mode-hitless"),Xs=document.getElementById("mark-pacifist"),Ys=document.getElementById("mark-stationary"),Js=document.getElementById("mark-extreme"),Ks=document.getElementById("mark-hitless"),Qs=document.getElementById("back-to-main-menu"),Zs=document.getElementById("pause-back-to-main-menu"),Ze=document.getElementById("controls-move"),et=document.getElementById("controls-bullet"),tt=document.getElementById("controls-rocket"),en=(e,t,n,a,o,s,c,d,l,m,g)=>{tn(e,l,t,n,m,g),sn(a,o,s,c,d),nn(e,l)},tn=(e,t,n,a,o,s)=>{qs.addEventListener("click",()=>{ee(),on(),t(),e()}),Gs.addEventListener("change",c=>{T(),n(!c.target.checked),c.target.checked?(et.setAttribute("disabled","true"),tt.setAttribute("disabled","true")):(et.removeAttribute("disabled"),tt.removeAttribute("disabled"))}),$s.addEventListener("change",c=>{T(),a(!c.target.checked),c.target.checked?Ze.setAttribute("disabled","true"):Ze.removeAttribute("disabled")}),zs.addEventListener("change",c=>{T(),o(c.target.checked)}),js.addEventListener("change",c=>{T(),s(c.target.checked)})},Ct=()=>{Dt.style.display="grid"},on=()=>{Dt.style.display="none"},sn=(e,t,n,a,o)=>{Ws.addEventListener("input",s=>{e(s.target.value/100)}),Is.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),t(1e3/s.target.value)}),Ps.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),n(1e3/s.target.value)}),Ls.addEventListener("change",s=>{T(),Po(s.target.checked)}),As.addEventListener("change",s=>{T(),So(s.target.checked)}),Bs.addEventListener("change",s=>{T(),Lo(s.target.checked)}),Ds.addEventListener("change",s=>{T(),Ao(s.target.checked)}),Cs.addEventListener("change",s=>{T(),Bo(s.target.checked)}),Vs.addEventListener("change",s=>{T(),s.target.value=Math.max(0,Math.min(1e3,Number(s.target.value))),a(s.target.value)}),Ss.addEventListener("click",()=>{ee(),be(),o()}),Zs.addEventListener("click",()=>{ee(),be(),Ct()})},Ut=()=>{Bt.style.display="flex"},be=()=>{Bt.style.display="none"},nn=(e,t)=>{Ns.addEventListener("click",()=>{ee(),Ue(),t(),e()}),Qs.addEventListener("click",()=>{ee(),Ue(),Ct()})},an=()=>{Vt.style.display="grid"},Ue=()=>{Vt.style.display="none"},rn=(e,t,n,a,o,s)=>{Xs.style.display=e?"none":"block",Ys.style.display=t?"none":"block",Js.style.display=n?"block":"none",Ks.style.display=a?"block":"none",ue(Fs,o.timePlayed/1e3,s.timePlayed/1e3,"s",1),ue(Hs,o.asteroidsDestroyed,s.asteroidsDestroyed),ue(Os,o.distanceTraveled,s.distanceTraveled,"m",1),ue(_s,o.damageDealt,s.damageDealt,"hp",0)},ue=(e,t,n,a,o)=>{e.children.item(1).innerText=a?`${t.toFixed(o)} ${a}`:`${t.toFixed(o)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>n?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${a?`${n.toFixed(o)} ${a}`:n.toFixed(o)} )`)},cn=e=>{Us.innerText=`${e}`},ln=e=>{Rs.innerText=e.toFixed(1)},Oe=e=>{for(let t=0;t<we.children.length;t++)we.children.item(t).style.color=t<e?"red":"grey"},dn=e=>{we.innerHTML="";for(let t=0;t<e;t++){const n=document.createElement("li");n.innerText="❤",n.style.color="red",we.appendChild(n)}},mn=(e,t,n)=>{ks.innerText=`${e}`,Es.innerText=`${t}`,Ts.innerText=`${n}`};let M=document.getElementsByTagName("canvas")[0],q=null;const Rt=2e3,un=(e,t)=>{const n=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*n};let f=!0;const Ft=()=>f=!1;let _e,pe=1e3/120;const hn=e=>pe=e;let Ht=1e3/60;const gn=e=>Ht=e;let ve=0,ot=0,Re=0,_=!0;const pn=e=>_=e;let I=!0;const fn=e=>I=e;let Be=0,De=0,st=0,k=[],z=[],j=[],i=null,Z=[],$=1,nt=0,te=!1,at=0,yn=40,rt=80,Me=3,oe=!1,xn=3e3,it=0,Ot=300;const wn=e=>Ot=e;let Fe=1e3,ct=0;const bn=e=>Math.pow(.99,e/1e3)*1e3;let X=!1;const vn=e=>X=e;let C=!1;const Mn=e=>{C=e};let kn=1e4,lt=0,u={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const En=()=>{document.getElementById("version").innerText="0.2.0",ve=performance.now(),Re=ve,In(),en(Rn,pn,fn,us,gn,hn,wn,Ft,Hn,vn,Mn)},Tn=e=>{if(q==null)return;const t=navigator.getGamepads()[q];t.buttons[9].value>=.5&&e-300>=st&&(Gt(),st=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?te=!f&&_:te=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?oe=!f&&_:oe=!1,t.buttons[12].pressed?u.forwardController=!f&&I:u.forwardController=!1,t.buttons[13].pressed?u.backwardController=!f&&I:u.backwardController=!1,t.buttons[14].pressed?u.leftController=!f&&I:u.leftController=!1,t.buttons[15].pressed?u.rightController=!f&&I:u.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},In=()=>{window.addEventListener("gamepadconnected",e=>{q=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{q=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":Gt();break;case" ":te=!f&&_;break;case"Shift":oe=!f&&_;break;case"ArrowUp":case"w":case"W":u.forward=!f&&I;break;case"ArrowDown":case"s":case"S":u.backward=!f&&I;break;case"ArrowLeft":case"a":case"A":u.left=!f&&I;break;case"ArrowRight":case"d":case"D":u.right=!f&&I;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":te=!1;break;case"Shift":oe=!1;break;case"ArrowUp":case"w":case"W":u.forward=!1;break;case"ArrowDown":case"s":case"S":u.backward=!1;break;case"ArrowLeft":case"a":case"A":u.left=!1;break;case"ArrowRight":case"d":case"D":u.right=!1;break}}),document.addEventListener("mousemove",e=>{if(f||i==null)return;const t=e.clientX-M.getBoundingClientRect().left,n=e.clientY-M.getBoundingClientRect().top,a=t-i.position.x,o=n-i.position.y;i.rotation=Math.atan2(o,a)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(f=!0,Ut())})};let b=performance.now();const _t=()=>{for(b=performance.now(),Tn(b);ot+pe/2<=b;)f||(Sn(pe),++Be),ot+=pe;if(ve+Ht/2<=b&&(f||(Vo(),++De),ve=b),b-Re>=1e3){const e=k.length+z.length+j.length+(i?1:0);mn(e,De,Be),De=0,Be=0,Re=b}_e=requestAnimationFrame(_t)},Pn=()=>{if(te&&b-at>=yn&&i){const e=i.rotation+(Math.random()-.5)*.1,t=nt%2===0?-1:1,n=Ae(i.rotation+Math.PI/2*t);n.x*=10,n.y*=10,n.x+=i.position.x,n.y+=i.position.y,Nt(n,e,Ae(e),0,!0),At(),nt++,at=b}if(oe&&b-it>=xn&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(Me,k.length);t++){let n;do n=k[Math.floor(Math.random()*k.length)];while(e.includes(n));n.frozen=!0,n.velocity.x=0,n.velocity.y=0,e.push(n)}e.push(i),Bn({...i.position},i.rotation,No(Ae(i.rotation),.2),0,e),it=b}if(b-ct>=Fe){const e=Je(),t=Tt(),n=Math.random()*Math.PI*2,a={x:t.x-e.x,y:t.y-e.y},o=Math.sqrt(a.x**2+a.y**2);o>0&&(a.x/=o,a.y/=o),a.x*=Math.random()*.1+.1,a.y*=Math.random()*.1+.1,X&&(a.x*=2,a.y*=2);const s=xe(.005),c=Jo(h.timePlayed),d=X?Zo():Qo();qt(e,n,{x:0,y:0},a,s,c,d),ct=b,Fe=bn(h.timePlayed)}if(b-lt>=kn){const e=Je(),t={x:M.width/2+(Math.random()-.5)*400,y:M.height/2+(Math.random()-.5)*400},n={x:t.x-e.x,y:t.y-e.y},a=Math.sqrt(n.x**2+n.y**2);a>0&&(n.x/=a,n.y/=a),n.x*=.1,n.y*=.1;const o=xe(.005),s=Ko();Vn(s,e,0,n,o),lt=b}if(i){if(q!=null){const e=navigator.getGamepads()[q];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let n=e.axes[0];Math.abs(e.axes[0])<=.01?n=0:e.axes[0]>=.7?n=1:e.axes[0]<=-.7&&(n=-1),i.force.y+=.004*t,i.force.x+=.004*n}i.force.x==0&&i.force.y==0&&((u.forward||u.forwardController)&&(i.force.y-=.004),(u.backward||u.backwardController)&&(i.force.y+=.004),(u.left||u.leftController)&&(i.force.x-=.004),(u.right||u.rightController)&&(i.force.x+=.004))}},Ve=e=>e.x<-100||e.x>M.width+100||e.y<-100||e.y>M.height+100,dt=()=>{i.hp-=1,gs(),i.hp>=0&&Oe(i.hp),i.hp<=0&&(ge(),Cn(),Te(0),L(ae,{position:{...i.position},frame:0}),setTimeout(()=>{Fn()},1e3))},Sn=e=>{Pn(),h.timePlayed+=e;for(const o of k){if(o.type==="homing"){const s=Le(o.velocity),c=Le(ye(i.position,o.position)),d=Le(Wo(s,c,.002*e)),l=Math.sqrt(o.velocity.x**2+o.velocity.y**2);let m=d.x,g=d.y;const y=Math.sqrt(m**2+g**2);y>0&&(m/=y,g/=y),m*=l,g*=l,o.velocity.x=m,o.velocity.y=g}me(o,e),Ve(o.position)&&(o.remove=!0);for(const s of k)o!==s&&Y(o,s,1,!0)&&hs();if(o.type==="turret"&&!o.frozen){const s=o.bulletIndex%5===0?rt*50:rt;if(b-o.lastBulletTime>=s){const c={x:i.position.x-o.position.x,y:i.position.y-o.position.y},d=Math.sqrt(c.x**2+c.y**2);d>0&&(c.x/=d*2,c.y/=d*2);const l={x:o.position.x,y:o.position.y};Nt(l,Go(c),c,0,!1),At(),o.lastBulletTime=b,o.bulletIndex++}}}for(const o of z)if(me(o,e),Ve(o.position)&&(o.remove=!0),!o.disabled){if(o.friendly)for(const s of k)if(s.type==="armored")Y(o,s,1,!1)&&(h.bulletsHit++,o.velocity.x*=.1,o.velocity.y*=.1,o.angularVelocity=xe(.02),o.disabled=!0,ps(),setTimeout(()=>{o.remove=!0},300));else if(s.type==="split"){if(Y(o,s,1,!1)){console.log("Test"),h.bulletsHit++,h.damageDealt+=Math.min(s.hp,$),s.hp-=$,s.fractureSeeds=fo(xo(s,o),s.radius);const c=vo(s),d=wo(s,c);if(s.hp<=0){++h.asteroidsDestroyed,s.remove=!0,ge();const l=Mo(s.texture,d.cellMap,s);for(let m=0;m<l.length;m++){const g=l[m],E=N().position,w=Tt(),x=Math.random()*Math.PI*2,p={x:w.x-E.x,y:w.y-E.y},U=Math.sqrt(p.x**2+p.y**2);U>0&&(p.x/=U,p.y/=U),p.x*=Math.random()*.1+.1,p.y*=Math.random()*.1+.1,X&&(p.x*=2,p.y*=2);const W=xe(.005);qt(E,x,{x:0,y:0},p,W,40,"default",g)}}o.remove=!0,Ke(),console.log(s.fractureSeeds)}}else Y(o,s,1,!1)&&(h.bulletsHit++,h.damageDealt+=Math.min(s.hp,$),s.hp-=$,s.hp<=0&&(++h.asteroidsDestroyed,s.remove=!0,ge()),o.remove=!0,Ke());else if(Y(o,i,1,!1)&&(dt(),o.remove=!0,i.hp<=0))break}for(const o of j)o.progress+=e/1e3*Ot,Xo(o,o.progress,s=>{s.remove=!0,++h.asteroidsDestroyed,h.damageDealt+=s.hp,ge()});for(const o of Z)if(me(o,e),Ve(o.position)&&(o.remove=!0),Ce(o,i))switch(o.remove=!0,fs(),o.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,i.maxHp),Oe(i.hp);break;case"damage":$+=1,ln($);break;case"rocket-piercing":Me+=1,cn(Me);break}const t={...i.position};me(i,e);const n={x:i.position.x-t.x,y:i.position.y-t.y},a=Math.sqrt(n.x**2+n.y**2);h.distanceTraveled+=a,Te(Math.min(a/100,.05));for(const o of k)if(Y(i,o,1,!0)&&(dt(),i.hp<=0))break;if(q==null)!u.forward&&!u.backward&&!u.left&&!u.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const o=navigator.getGamepads()[q];Math.abs(o.axes[0])<.01&&Math.abs(o.axes[1])<.01&&!u.forward&&!u.backward&&!u.left&&!u.right&&!u.forwardController&&!u.backwardController&&!u.leftController&&!u.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>M.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,M.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>M.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,M.height)),i.velocity.y*=-1),Ln()},Ln=()=>{k.forEach(e=>{e.remove&&(S(ne,e.id),e.frame=0,L(ae,e))}),z.forEach(e=>{e.remove&&S(B,e.id)}),j.forEach(e=>{e.remove&&(S(D,e.id),e.children.forEach(t=>{S(K,t.id)}))}),Z.forEach(e=>{e.remove&&S(ke,e.id)}),k=k.filter(e=>!e.remove),z=z.filter(e=>!e.remove),j=j.filter(e=>!e.remove),Z=Z.filter(e=>!e.remove)},An={default:Qe,homing:ys,armored:xs,turret:ws,split:Qe},qt=(e,t,n,a,o,s,c,d=null)=>{const l=N();if(l.position=e,l.rotation=t,l.acceleration=n,l.velocity=a,l.angularVelocity=o,l.mass=un(s,c),l.radius=c==="armored"?s*2:s,l.inertia=2/5*l.mass*s**2,l.hp=s/2,l.texture=d||qe(l,An[c],l.radius*2,l.radius*2),l.type=c,c==="turret"&&(l.lastBulletTime=b,l.bulletIndex=0),!Ce(l,i)){for(const m of k)if(Ce(l,m))return;L(ne,l),k.push(l)}},Nt=(e,t,n,a,o)=>{const s=N();s.position=e,s.rotation=t,s.velocity=n,s.angularVelocity=a,s.mass=Rt,s.radius=5,s.inertia=2/5*s.mass*s.radius**2,s.friendly=o,L(B,s),z.push(s),++h.bulletsFired},Bn=(e,t,n,a,o)=>{const s=N();s.position=e,s.rotation=t,s.velocity=n,s.angularVelocity=a,s.mass=Rt,s.radius=5,s.targets=o,s.progress=0,s.currentTarget=0,zo(s),Yo(s),L(D,s),j.push(s),Wt({x:-5,y:0},Math.PI/2,s),++h.rocketsFired},Dn=(e,t,n,a)=>{i=N(),i.position=e,i.rotation=t,i.velocity=n,i.angularVelocity=a,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.maxHp=5,C&&(i.maxHp=1),i.hp=i.maxHp,qe(i,bs,i.height,i.width),L(re,i),mt({x:-5,y:18},0,J,Ms,i),mt({x:-5,y:-18},0,J,vs,i)},mt=(e,t,n,a,o)=>{const s=N();s.position=e,s.rotation=t,s.parent=o,s.height=20,s.width=20,L(n,s),qe(s,a,s.height,s.width),o.children??(o.children=o.children||[]),o.children.push(s),Wt({x:-5,y:0},Math.PI/2,s)},Wt=(e,t,n)=>{const a=N();a.position=e,a.rotation=t,a.parent=n,a.height=10,a.width=5,n.children??(n.children=n.children||[]),n.children.push(a),L(K,a)},Vn=(e,t,n,a,o)=>{if(C&&["health"].includes(e))return;const s=N();s.type=e,s.position=t,s.rotation=n,s.velocity=a,s.angularVelocity=o,s.radius=25,L(ke,s),Z.push(s)},Gt=()=>{f=!f,f?(Ut(),Te(0)):be()},Cn=()=>{if(i){S(re,i.id);for(let e of i.children){S(J,e.id);for(let t of e.children)S(K,t.id)}}},Un=()=>{M.width=M.clientWidth,M.height=M.clientHeight,Dn({x:M.width/2,y:M.height/2},0,{x:0,y:0},0),console.log(C),console.log("Setting max hp to: "+(C?1:5)),dn(C?1:5)},Rn=()=>{Un(),Ft(),_e=requestAnimationFrame(_t)},Fn=()=>{if(f)return;f=!0,cancelAnimationFrame(_e),Te(0),i=null;const e=St(!_,!I,X,C);rn(_,I,X,C,h,e),an(),ts(!_,!I,X,C)},Hn=()=>{os(),Do(),k=[],z=[],j=[],Fe=1e3,Me=3,$=1,Oe(5),be(),Ue()},qe=(e,t,n,a)=>{const o=new Image;o.src=t,o.onload=()=>{const s=document.createElement("canvas");s.width=a,s.height=n,s.getContext("2d").drawImage(o,0,0,a,n),e.texture=s,e.textureReady=!0}};En();
