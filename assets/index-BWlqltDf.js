(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();let A=new Map;const Mt=2e3,j=e=>{const t={x:e.position.x,y:e.position.y,rotation:e.rotation},o=e.parent;if(o==null)return t;const n=j(o),s=Math.cos(n.rotation),a=Math.sin(n.rotation);return{x:n.x+t.x*s-t.y*a,y:n.y+t.x*a+t.y*s,rotation:n.rotation+t.rotation}},kt=(e,t)=>{A[e]||(A[e]=[]);const o=performance.now();A[e].push({x:t.x,y:t.y,time:o}),A[e]=A[e].filter(n=>o-n.time<Mt)},Et=e=>{delete A[e]},Tt=e=>{for(const t in A){const o=A[t];if(!(!o||o.length<2)){e.beginPath();for(let n=0;n<o.length;n++){const s=o[n];n===0?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.stroke()}}},Pt="/asteroid-pew-pew/img/boom/boom_0.gif",It="/asteroid-pew-pew/img/boom/boom_1.gif",St="/asteroid-pew-pew/img/boom/boom_2.gif",At="/asteroid-pew-pew/img/boom/boom_3.gif",Lt="/asteroid-pew-pew/img/boom/boom_4.gif",Bt="/asteroid-pew-pew/img/boom/boom_5.gif",Vt="/asteroid-pew-pew/img/boom/boom_6.gif",Dt="/asteroid-pew-pew/img/boom/boom_7.gif",Ct="/asteroid-pew-pew/img/boom/boom_8.gif",Ut="/asteroid-pew-pew/img/boom/boom_9.gif",Rt="/asteroid-pew-pew/img/boom/boom_10.gif",Ft="/asteroid-pew-pew/img/boom/boom_11.gif",Ot="/asteroid-pew-pew/img/boom/boom_12.gif",_t="/asteroid-pew-pew/img/boom/boom_13.gif",Ht="/asteroid-pew-pew/img/boom/boom_14.gif",Wt="/asteroid-pew-pew/img/ice.png",Nt="/asteroid-pew-pew/img/powerup.png",D=document.getElementsByTagName("canvas")[0],r=D.getContext("2d"),z="asteroid",T="bullet",J="explosion",te="flash",P="rocket",X="spaceship",Ge="velocity",F="spaceshippart",O="flames",ne="powerup",Gt="#ffffff",qt="#ffff00",Z="#ff0000",Ee="#00ff00";let $t=0;const jt=()=>`${$t++}`,I={[z]:{color:Gt},[T]:{color:qt,length:10,strokeWidth:2},[P]:{color:Z,radius:10},[X]:{color:Ee},[Ge]:{color:Z},[F]:{color:Ee},[O]:{color:Z}},L={[O]:{},[X]:{},[F]:{},[z]:{},[T]:{},[P]:{},[J]:{},[te]:{},[ne]:{}};let qe=!1,Y=!1,$e=!1,je=!1;const zt=e=>{qe=e},Jt=e=>{Y=e},Xt=e=>{$e=e},Yt=e=>{je=e},M=(e,t)=>{t.id=jt(),L[e][t.id]=t},v=(e,t)=>{delete L[e][t],Et(t)},Kt=()=>{for(const e in L)L[e]={}},g=[];for(let e=0;e<15;++e)g.push(new Image);g[0].src=Pt;g[1].src=It;g[2].src=St;g[3].src=At;g[4].src=Lt;g[5].src=Bt;g[6].src=Vt;g[7].src=Dt;g[8].src=Ct;g[9].src=Ut;g[10].src=Rt;g[11].src=Ft;g[12].src=Ot;g[13].src=_t;g[14].src=Ht;const ze=new Image;ze.src=Wt;const Qt=()=>{D.width=D.clientWidth,D.height=D.clientHeight,r.clearRect(0,0,D.width,D.height);for(const e in L)for(const t of Object.values(L[e])){switch(e){case z:Zt(t);break;case J:oo(t);break;case T:eo(t);break;case P:to(t);break;case X:case F:so(t);break;case O:ao(t);break;case te:no(t);break;case ne:ro(t);break}kt(t.id,j(t))}if(qe){r.strokeStyle=I[Ge].color,r.lineWidth=1,r.beginPath();for(const e in L){for(const t of Object.values(L[e]))if("velocity"in t){const{position:o,velocity:n}=t,{x:s,y:a}=o,{x:c,y:l}=n;r.moveTo(s,a),r.lineTo(s+c*200,a+l*200)}r.stroke()}}$e&&Tt(r)},Zt=e=>{const{radius:t,texture:o}=e,n=j(e);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.drawImage(o,-t,-t,t*2,t*2),Y&&(r.strokeStyle=Z,r.lineWidth=1,r.beginPath(),r.moveTo(0,0),r.arc(0,0,t,0,2*Math.PI),r.stroke()),e.frozen&&(r.globalAlpha=.2,r.drawImage(ze,-t-10,-t-10,t*2+20,t*2+20),r.globalAlpha=1),r.restore()},eo=e=>{var s;const{length:t}=I[T],o=Math.cos(e.rotation)*t/2,n=Math.sin(e.rotation)*t/2;r.fillStyle=e.friendly?I[T].color:"red",r.strokeStyle=e.friendly?I[T].color:"red",r.lineWidth=(s=I[T])==null?void 0:s.strokeWidth,r.beginPath(),r.moveTo(e.position.x+o,e.position.y+n),r.lineTo(e.position.x-o,e.position.y-n),r.stroke()},to=e=>{var c;const{radius:t}=I[P],o=2*Math.PI/8,n={x:e.position.x+t*Math.cos(e.rotation),y:e.position.y+t*Math.sin(e.rotation)},s={x:e.position.x-t*Math.cos(e.rotation+o),y:e.position.y-t*Math.sin(e.rotation+o)},a={x:e.position.x-t*Math.cos(e.rotation-o),y:e.position.y-t*Math.sin(e.rotation-o)};if(r.fillStyle=I[P].color,r.strokeStyle=I[P].color,r.lineWidth=((c=I[P])==null?void 0:c.strokeWidth)??0,r.beginPath(),r.moveTo(n.x,n.y),r.lineTo(s.x,s.y),r.lineTo(a.x,a.y),r.lineTo(n.x,n.y),r.stroke(),je){r.strokeStyle="grey",r.beginPath(),r.moveTo(e.pathPoints[0].x,e.pathPoints[0].y);for(const l of e.pathPoints)r.lineTo(l.x,l.y),r.arc(l.x,l.y,2,0,2*Math.PI),r.moveTo(l.x,l.y);r.lineTo(e.targets[e.targets.length-1].x,e.targets[e.targets.length-1].y),r.stroke()}},oo=e=>{r.translate(e.position.x,e.position.y);const n=g[e.frame];r.drawImage(n,-100/2,-100/2,100,100),r.translate(-e.position.x,-e.position.y),e.frame<g.length-1?e.frame++:v(J,e.id)},so=e=>{const{width:t,height:o,texture:n}=e,s=j(e);r.save(),r.translate(s.x,s.y),r.rotate(s.rotation),r.drawImage(n,-t/2,-o/2,t,o),Y&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t/2,-o/2,t,o)),r.restore()},ao=e=>{var k,le,_;const{width:t,height:o}=e,n=j(e),s=((k=e==null?void 0:e.parent)==null?void 0:k.velocity)??{x:0,y:1},a=((_=(le=e==null?void 0:e.parent)==null?void 0:le.parent)==null?void 0:_.velocity)??{x:0,y:0},c={x:s.x+a.x,y:s.y+a.y},l=Math.min(Math.sqrt(c.x**2+c.y**2)*5,2);r.save(),r.translate(n.x,n.y),r.rotate(n.rotation),r.beginPath();const m=Math.random()*5;r.moveTo(0,0),r.lineTo(-t,(o+m)*l),r.lineTo(t,(o+m)*l),r.closePath(),r.fillStyle="orange",r.fill(),r.beginPath(),r.moveTo(0,0),r.lineTo(-t/2,(o/2+m)*l),r.lineTo(t/2,(o/2+m)*l),r.closePath(),r.fillStyle="yellow",r.fill(),Y&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,0,t*2,o+m)),r.restore()},no=e=>{const t=e.position,o=e.rotation,n=3,s=15;r.fillStyle="white",r.beginPath(),r.translate(t.x,t.y),r.rotate(o),r.moveTo(n,n),r.lineTo(s,0),r.lineTo(n,-3),r.lineTo(0,-15),r.lineTo(-3,-3),r.lineTo(-15,0),r.lineTo(-3,n),r.lineTo(0,s),r.resetTransform(),r.closePath(),r.fill()},Je=new Image;Je.src=Nt;const ro=e=>{const{radius:t}=e,o=t*2;switch(r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.drawImage(Je,-t,-t,o,o),Y&&(r.strokeStyle="lime",r.lineWidth=1,r.strokeRect(-t,-t,o,o)),e.type){case"health":r.textAlign="center",r.font="20px Arial",r.fillText("ðŸ’š",0,7);break;case"damage":r.fillStyle="yellow",r.textAlign="center",r.font="20px Arial",r.fillText("=",0,7);break;case"rocket-piercing":r.fillStyle="blue",r.textAlign="center",r.font="20px Arial",r.fillText("ðŸš€",0,7);break}r.restore()},R=()=>({position:{x:0,y:0},velocity:{x:0,y:0},acceleration:{x:0,y:0},force:{x:0,y:0},rotation:0,angularVelocity:0,angularAcceleration:0,torque:0,mass:1,inertia:1,radius:0,drag:1,height:0,width:0,maxVelocity:1,parent:null,texture:null}),K=(e,t)=>{if(e.frozen)return;e.position.x+=e.velocity.x*t+.5*e.acceleration.x*t**2,e.position.y+=e.velocity.y*t+.5*e.acceleration.y*t**2,e.rotation+=e.angularVelocity*t+.5*e.angularAcceleration*t**2,e.velocity.x+=e.drag*e.acceleration.x*t,e.velocity.y+=e.drag*e.acceleration.y*t;const o=Math.sqrt(e.velocity.x**2+e.velocity.y**2);o>e.maxVelocity&&(e.velocity.x/=o/e.maxVelocity,e.velocity.y/=o/e.maxVelocity),e.angularVelocity+=e.angularAcceleration*t,e.acceleration.x=e.force.x/e.mass,e.acceleration.y=e.force.y/e.mass,e.angularAcceleration=e.torque/e.inertia,e.force.x=0,e.force.y=0,e.torque=0},Xe=(e,t)=>Math.sqrt((t.position.x-e.position.x)**2+(t.position.y-e.position.y)**2),he=(e,t)=>Xe(e,t)<e.radius+t.radius,H=(e,t,o,n)=>{const s=Xe(e,t);if(s>=e.radius+t.radius)return!1;const a={x:(t.position.x-e.position.x)/s,y:(t.position.y-e.position.y)/s},c=2*(e.velocity.x*a.x+e.velocity.y*a.y-t.velocity.x*a.x-t.velocity.y*a.y)/(e.mass+t.mass),l=e.radius+t.radius-s;n&&(e.position.x-=a.x*l,e.position.y-=a.y*l,t.position.x+=a.x*l,t.position.y+=a.y*l),e.frozen||(e.velocity.x-=c*o*t.mass*a.x,e.velocity.y-=c*o*t.mass*a.y),t.frozen||(t.velocity.x+=c*o*e.mass*a.x,t.velocity.y+=c*o*e.mass*a.y);const m={position:{x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},rotation:Math.random()*Math.PI*2};return M(te,m),setTimeout(()=>v(te,m.id),100),!0},pe=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),io=(e,t)=>{e.x*=t,e.y*=t},ce=e=>({x:Math.cos(e),y:Math.sin(e)}),lo=e=>{const t=Math.atan2(e.y,e.x);return t<0?t+Math.PI*2:t},Te=e=>Math.sqrt(e.x**2+e.y**2),Pe=10,co=30,Ie=(e,t,o,n,s)=>.5*(2*o+(-t+n)*e+(2*t-5*o+4*n-s)*e*e+(-t+3*o-3*n+s)*e*e*e),Ye=(e,t,o,n,s)=>({x:Ie(e,t.x,o.x,n.x,s.x),y:Ie(e,t.y,o.y,n.y,s.y)}),Ke=(e,t)=>{const o=Math.max(Math.min(Math.floor(t),e.targets.length-4),0);return Ye(t%1,e.targets[o+0].position,e.targets[o+1].position,e.targets[o+2].position,e.targets[o+3].position)},Qe=(e,t)=>Ke(e,Ze(e,t)),mo=e=>{e.arcLengthTable=[];let t=0,o=e.targets[1].position;for(let c=0;c<(e.targets.length-3)*Pe;++c){const l=c/Pe,m=Ke(e,l),k=Te(pe(m,o));t+=k,e.arcLengthTable.push({v:l,totalLength:t}),o=m}const n=e.targets.length-4,s=Ye(1,e.targets[n+0].position,e.targets[n+1].position,e.targets[n+2].position,e.targets[n+3].position),a=Te(pe(s,o));t+=a,e.arcLengthTable.push({v:e.targets.length-3,totalLength:t})},uo=e=>-(Math.cos(Math.PI*e)-1)/2,Ze=(e,t)=>{let o=e.arcLengthTable[e.arcLengthTable.length-1].v;for(let c=1;c<e.arcLengthTable.length;++c){const l=e.arcLengthTable[c-1],m=e.arcLengthTable[c];if(t<m.totalLength){const k=m.totalLength-l.totalLength;if(k===0){o=m.v;break}const _=(t-l.totalLength)/k;o=l.v*(1-_)+m.v*_;break}}const n=Math.floor(o),s=o-n,a=uo(s);return n+a},ho=(e,t,o)=>{const n=Qe(e,t);e.velocity=pe(n,e.position),e.rotation=Math.atan2(e.velocity.y,e.velocity.x),e.position=n;const s=Math.max(Math.min(Math.floor(Ze(e,t)),e.targets.length-3),0);if(s!==e.currentTarget&&(o(e.targets[s+1]),e.currentTarget=s),s>=e.targets.length-3){e.remove=!0;return}},po=e=>{e.pathPoints=[];const t=e.arcLengthTable[e.arcLengthTable.length-1].totalLength;for(let o=0;o<=t;o+=co)e.pathPoints.push(Qe(e,o));e.pathPoints.push(e.targets[e.targets.length-2].position)},S=document.getElementsByTagName("canvas")[0],go=()=>({x:Math.random()*S.width,y:Math.random()*S.height}),Se=()=>{const e=Math.floor(Math.random()*4),t=90;switch(e){case 0:return{x:Math.random()*S.width,y:-90};case 1:return{x:S.width+t,y:Math.random()*S.height};case 2:return{x:Math.random()*S.width,y:S.height+t};case 3:return{x:-90,y:Math.random()*S.height}}},ge=e=>(Math.random()*2-1)*e,fo=e=>{const t=[20,30,40];return e>3e4&&(t.shift(),t.push(50)),e>6e4&&(t.shift(),t.push(60)),e>9e4&&(t.shift(),t.push(80)),e>12e4&&(t.shift(),t.push(100)),t[Math.floor(Math.random()*t.length)]},yo=()=>{const e=["health","damage","rocket-piercing"],t=[.6,.9,1],o=Math.random();for(let n=0;n<e.length;n++)if(o<t[n])return e[n];return e[e.length-1]},et=(e,t)=>{const o=Math.random();let n=0;for(let s=0;s<t.length;s++)if(n+=t[s],o<n)return e[s];return e[t.length-1]},wo=()=>et(["default","homing","armored","turret"],[.85,.05,.05,.05]),xo=()=>et(["homing","armored","turret"],[.34,.33,.33]),E={timePlayed:0,asteroidsDestroyed:0,damageDealt:0,bulletsFired:0,bulletsHit:0,rocketsFired:0,distanceTraveled:0},bo=JSON.stringify(E),tt=(e,t)=>"best"+(e?"-pacifist":"-default")+(t?"-stationary":"-default"),ot=(e,t)=>{const o=tt(e,t);return JSON.parse(localStorage.getItem(o)||bo)},u={...E},vo=(e,t)=>{const o=ot(e,t);o.timePlayed=Math.max(o.timePlayed,u.timePlayed),o.asteroidsDestroyed=Math.max(o.asteroidsDestroyed,u.asteroidsDestroyed),o.damageDealt=Math.max(o.damageDealt,u.damageDealt),o.bulletsFired=Math.max(o.bulletsFired,u.bulletsFired),o.bulletsHit=Math.max(o.bulletsHit,u.bulletsHit),o.rocketsFired=Math.max(o.rocketsFired,u.rocketsFired),o.distanceTraveled=Math.max(o.distanceTraveled,u.distanceTraveled),localStorage.setItem(tt(e,t),JSON.stringify(o))},Mo=()=>{u.timePlayed=E.timePlayed,u.asteroidsDestroyed=E.asteroidsDestroyed,u.damageDealt=E.damageDealt,u.bulletsFired=E.bulletsFired,u.bulletsHit=E.bulletsHit,u.rocketsFired=E.rocketsFired,u.distanceTraveled=E.distanceTraveled},ko="/asteroid-pew-pew/audio/propulsion.mp3",Eo="/asteroid-pew-pew/audio/explosion.wav",To="/asteroid-pew-pew/audio/shoot.wav",Po="/asteroid-pew-pew/audio/hurt.wav",st="/asteroid-pew-pew/audio/hit.wav",Io="/asteroid-pew-pew/audio/click.wav",So="/asteroid-pew-pew/audio/submit.wav",Ao="/asteroid-pew-pew/audio/powerup.wav",Lo="/asteroid-pew-pew/audio/CODEX_2015.mp3",Bo="/asteroid-pew-pew/audio/armorHit.wav";let x=.5;const Vo=e=>{ve.volume=.05*e,x=e},re=new Audio(ko);re.volume=0;re.loop=!0;document.addEventListener("keydown",()=>re.play().catch(()=>{}),{once:!0});const ie=e=>{re.volume=e*x},G=()=>{const e=new Audio(So);e.volume=.5*x,e.play().catch(()=>{})},b=()=>{const e=new Audio(Io);e.volume=.5*x,e.play().catch(()=>{})},Do=()=>{const e=new Audio(st);e.volume=.1*x,e.play().catch(()=>{})},Co=()=>{const e=new Audio(Po);e.volume=.3*x,e.play().catch(()=>{})},at=()=>{const e=new Audio(To);e.volume=.1*x,e.play().catch(()=>{})},Uo=()=>{const e=new Audio(st);e.volume=.2*x,e.play().catch(()=>{})},Ro=()=>{const e=new Audio(Bo);e.volume=.2*x,e.play().catch(()=>{})},fe=()=>{const e=new Audio(Eo);e.volume=.3*x,e.play().catch(()=>{})},Fo=()=>{const e=new Audio(Ao);e.volume=.2*x,e.play().catch(()=>{})},ve=new Audio(Lo);ve.volume=.05*x;ve.loop=!0;const Oo="/asteroid-pew-pew/img/Asteroid1.png",_o="/asteroid-pew-pew/img/asteroid_red.png",Ho="/asteroid-pew-pew/img/asteroid_armored.png",Wo="/asteroid-pew-pew/img/asteroid_green.png",No="/asteroid-pew-pew/img/Spaceship.png",Go="/asteroid-pew-pew/img/WingLeft.png",qo="/asteroid-pew-pew/img/WingRight.png";let $o=document.getElementById("entity-count"),jo=document.getElementById("fps"),zo=document.getElementById("ups"),Jo=document.getElementById("target-fps"),Xo=document.getElementById("target-ups"),nt=document.getElementById("pause-menu");const rt=document.getElementById("main-menu"),Yo=document.getElementById("pause-resume"),Ko=document.getElementById("debug-velocity"),Qo=document.getElementById("debug-hitbox"),Zo=document.getElementById("debug-trajectory"),es=document.getElementById("debug-spline-paths"),ts=document.getElementById("debug-rocket-speed");document.getElementById("fire-rate");const os=document.getElementById("rocket-piercing"),ss=document.getElementById("bullet-damage"),Ae=document.getElementById("hp"),it=document.getElementById("game-over"),as=document.getElementById("time-played"),ns=document.getElementById("asteroids-destroyed"),rs=document.getElementById("distance-traveled"),is=document.getElementById("damage-dealt"),ls=document.getElementById("start"),cs=document.getElementById("restart"),ds=document.getElementById("volume"),ms=document.getElementById("mode-pacifist"),us=document.getElementById("mode-stationary"),hs=document.getElementById("mode-extreme"),ps=document.getElementById("mark-pacifist"),gs=document.getElementById("mark-stationary");document.getElementById("mark-extreme");const fs=document.getElementById("back-to-main-menu"),ys=document.getElementById("pause-back-to-main-menu"),Le=document.getElementById("controls-move"),Be=document.getElementById("controls-bullet"),Ve=document.getElementById("controls-rocket"),ws=(e,t,o,n,s,a,c,l,m,k)=>{xs(e,m,t,o,k),vs(n,s,a,c,l),Ms(e,m)},xs=(e,t,o,n,s)=>{ls.addEventListener("click",()=>{G(),bs(),t(),e()}),ms.addEventListener("change",a=>{b(),o(!a.target.checked),a.target.checked?(Be.setAttribute("disabled","true"),Ve.setAttribute("disabled","true")):(Be.removeAttribute("disabled"),Ve.removeAttribute("disabled"))}),us.addEventListener("change",a=>{b(),n(!a.target.checked),a.target.checked?Le.setAttribute("disabled","true"):Le.removeAttribute("disabled")}),hs.addEventListener("change",a=>{b(),s(a.target.checked)})},lt=()=>{rt.style.display="grid"},bs=()=>{rt.style.display="none"},vs=(e,t,o,n,s)=>{ds.addEventListener("input",a=>{e(a.target.value/100)}),Jo.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),t(1e3/a.target.value)}),Xo.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),o(1e3/a.target.value)}),Ko.addEventListener("change",a=>{b(),zt(a.target.checked)}),Qo.addEventListener("change",a=>{b(),Jt(a.target.checked)}),Zo.addEventListener("change",a=>{b(),Xt(a.target.checked)}),es.addEventListener("change",a=>{b(),Yt(a.target.checked)}),ts.addEventListener("change",a=>{b(),a.target.value=Math.max(0,Math.min(1e3,Number(a.target.value))),n(a.target.value)}),Yo.addEventListener("click",()=>{G(),oe(),s()}),ys.addEventListener("click",()=>{G(),oe(),lt()})},ct=()=>{nt.style.display="flex"},oe=()=>{nt.style.display="none"},Ms=(e,t)=>{cs.addEventListener("click",()=>{G(),ye(),t(),e()}),fs.addEventListener("click",()=>{G(),ye(),lt()})},ks=()=>{it.style.display="grid"},ye=()=>{it.style.display="none"},Es=(e,t,o,n)=>{ps.style.display=e?"none":"block",gs.style.display=t?"none":"block",Q(as,o.timePlayed/1e3,n.timePlayed/1e3,"s",1),Q(ns,o.asteroidsDestroyed,n.asteroidsDestroyed),Q(rs,o.distanceTraveled,n.distanceTraveled,"m",1),Q(is,o.damageDealt,n.damageDealt,"hp",0)},Q=(e,t,o,n,s)=>{e.children.item(1).innerText=n?`${t.toFixed(s)} ${n}`:`${t.toFixed(s)}`,e.children.item(2).classList.remove("new-best"),e.children.item(2).classList.remove("previous-best"),t>o?(e.children.item(2).classList.add("new-best"),e.children.item(2).innerText="New best!"):(e.children.item(2).classList.add("previous-best"),e.children.item(2).innerText=`( Best: ${n?`${o.toFixed(s)} ${n}`:o.toFixed(s)} )`)},Ts=e=>{os.innerText=`${e}`},Ps=e=>{ss.innerText=e.toFixed(1)},Me=e=>{for(let t=0;t<Ae.children.length;t++)Ae.children.item(t).style.color=t<e?"red":"grey"},Is=(e,t,o)=>{$o.innerText=`${e}`,jo.innerText=`${t}`,zo.innerText=`${o}`};let f=document.getElementsByTagName("canvas")[0],V=null;const dt=2e3,Ss=(e,t)=>{const o=t==="armored"?10:3.5;return 4/3*Math.PI*e**3*o};let h=!0;const mt=()=>h=!1;let ke,ee=1e3/120;const As=e=>ee=e;let ut=1e3/60;const Ls=e=>ut=e;let se=0,De=0,we=0,B=!0;const Bs=e=>B=e;let w=!0;const Vs=e=>w=e;let de=0,me=0,Ce=0,y=[],C=[],U=[],i=null,N=[],W=1,Ue=0,q=!1,Re=0,Ds=40,Fe=80,ae=3,$=!1,Cs=3e3,Oe=0,ht=300;const Us=e=>ht=e;let xe=1e3,_e=0;const Rs=e=>Math.pow(.99,e/1e3)*1e3;let be=!1;const Fs=e=>be=e;let Os=1e4,He=0,d={forward:!1,backward:!1,left:!1,right:!1,forwardController:!1,backwardController:!1,leftController:!1,rightController:!1};const _s=()=>{document.getElementById("version").innerText="0.1.0",se=performance.now(),we=se,Ws(),ws(Qs,Bs,Vs,Vo,Ls,As,Us,mt,ea,Fs)},Hs=e=>{if(V==null)return;const t=navigator.getGamepads()[V];t.buttons[9].value>=.5&&e-300>=Ce&&(vt(),Ce=e),t.buttons[7].pressed&&t.buttons[7].value>=.5?q=!h&&B:q=!1,t.buttons[6].pressed&&t.buttons[6].value>=.5?$=!h&&B:$=!1,t.buttons[12].pressed?d.forwardController=!h&&w:d.forwardController=!1,t.buttons[13].pressed?d.backwardController=!h&&w:d.backwardController=!1,t.buttons[14].pressed?d.leftController=!h&&w:d.leftController=!1,t.buttons[15].pressed?d.rightController=!h&&w:d.rightController=!1,(Math.abs(t.axes[2])>=.5||Math.abs(t.axes[3])>=.5)&&(i.rotation=Math.atan2(t.axes[3],t.axes[2]))},Ws=()=>{window.addEventListener("gamepadconnected",e=>{console.log("controller connected"),V=e.gamepad.index}),window.addEventListener("gamepaddisconnected",()=>{V=null}),document.addEventListener("keydown",e=>{switch(e.key){case"Escape":vt();break;case" ":q=!h&&B;break;case"Shift":$=!h&&B;break;case"ArrowUp":case"w":case"W":d.forward=!h&&w;break;case"ArrowDown":case"s":case"S":d.backward=!h&&w;break;case"ArrowLeft":case"a":case"A":d.left=!h&&w;break;case"ArrowRight":case"d":case"D":d.right=!h&&w;break}}),document.addEventListener("keyup",e=>{switch(e.key){case" ":q=!1;break;case"Shift":$=!1;break;case"ArrowUp":case"w":case"W":d.forward=!1;break;case"ArrowDown":case"s":case"S":d.backward=!1;break;case"ArrowLeft":case"a":case"A":d.left=!1;break;case"ArrowRight":case"d":case"D":d.right=!1;break}}),document.addEventListener("mousemove",e=>{if(h||i==null)return;const t=e.clientX-f.getBoundingClientRect().left,o=e.clientY-f.getBoundingClientRect().top,n=t-i.position.x,s=o-i.position.y;i.rotation=Math.atan2(s,n)}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(h=!0,ct())})};let p=performance.now();const pt=()=>{for(p=performance.now(),Hs(p);De+ee/2<=p;)h||(Gs(ee),++de),De+=ee;if(se+ut/2<=p&&(h||(Qt(),++me),se=p),p-we>=1e3){const e=y.length+C.length+U.length+(i?1:0);Is(e,me,de),me=0,de=0,we=p}ke=requestAnimationFrame(pt)},Ns=()=>{if(q&&p-Re>=Ds&&i){const e=i.rotation+(Math.random()-.5)*.1,t=Ue%2===0?-1:1,o=ce(i.rotation+Math.PI/2*t);o.x*=10,o.y*=10,o.x+=i.position.x,o.y+=i.position.y,xt(o,e,ce(e),0,!0),at(),Ue++,Re=p}if($&&p-Oe>=Cs&&i){const e=[{position:{x:i.position.x-Math.cos(i.rotation)*100,y:i.position.y-Math.sin(i.rotation)*100}},{position:{x:i.position.x,y:i.position.y}}];for(let t=0;t<Math.min(ae,y.length);t++){let o;do o=y[Math.floor(Math.random()*y.length)];while(e.includes(o));o.frozen=!0,o.velocity.x=0,o.velocity.y=0,e.push(o)}e.push(i),zs({...i.position},i.rotation,io(ce(i.rotation),.2),0,e),Oe=p}if(p-_e>=xe){const e=Se(),t=go(),o=Math.random()*Math.PI*2,n={x:t.x-e.x,y:t.y-e.y},s=Math.sqrt(n.x**2+n.y**2);s>0&&(n.x/=s,n.y/=s),n.x*=Math.random()*.1+.1,n.y*=Math.random()*.1+.1,be&&(n.x*=2,n.y*=2);const a=ge(.005),c=fo(u.timePlayed),l=be?xo():wo();js(e,o,{x:0,y:0},n,a,c,l),_e=p,xe=Rs(u.timePlayed)}if(p-He>=Os){const e=Se(),t={x:f.width/2+(Math.random()-.5)*400,y:f.height/2+(Math.random()-.5)*400},o={x:t.x-e.x,y:t.y-e.y},n=Math.sqrt(o.x**2+o.y**2);n>0&&(o.x/=n,o.y/=n),o.x*=.1,o.y*=.1;const s=ge(.005),a=yo();Xs(a,e,0,o,s),He=p}if(i){if(V!=null){const e=navigator.getGamepads()[V];let t=e.axes[1];Math.abs(e.axes[1])<=.01?t=0:e.axes[1]>=.7?t=1:e.axes[1]<=-.7&&(t=-1);let o=e.axes[0];Math.abs(e.axes[0])<=.01?o=0:e.axes[0]>=.7?o=1:e.axes[0]<=-.7&&(o=-1),i.force.y+=.004*t,i.force.x+=.004*o}i.force.x==0&&i.force.y==0&&((d.forward||d.forwardController)&&(i.force.y-=.004),(d.backward||d.backwardController)&&(i.force.y+=.004),(d.left||d.leftController)&&(i.force.x-=.004),(d.right||d.rightController)&&(i.force.x+=.004))}console.log("force:",i.force.x,i.force.y)},ue=e=>e.x<-100||e.x>f.width+100||e.y<-100||e.y>f.height+100,We=()=>{i.hp-=1,Co(),i.hp>=0&&Me(i.hp),i.hp<=0&&(fe(),Ys(),ie(0),M(J,{position:{...i.position},frame:0}),setTimeout(()=>{Zs()},1e3))},Gs=e=>{Ns(),u.timePlayed+=e;for(const s of y){if(s.type==="homing"){const a=Math.sqrt(s.velocity.x**2+s.velocity.y**2);let c=i.position.x-s.position.x,l=i.position.y-s.position.y;const m=Math.sqrt(c**2+l**2);m>0&&(c/=m,l/=m),c*=a,l*=a,s.velocity.x=c,s.velocity.y=l}K(s,e),ue(s.position)&&(s.remove=!0);for(const a of y)s!==a&&H(s,a,1,!0)&&Do();if(s.type==="turret"){const a=s.bulletIndex%5===0?Fe*50:Fe;if(p-s.lastBulletTime>=a){const c={x:i.position.x-s.position.x,y:i.position.y-s.position.y},l=Math.sqrt(c.x**2+c.y**2);l>0&&(c.x/=l*2,c.y/=l*2);const m={x:s.position.x,y:s.position.y};xt(m,lo(c),c,0,!1),at(),s.lastBulletTime=p,s.bulletIndex++}}}for(const s of C)if(K(s,e),ue(s.position)&&(s.remove=!0),!s.disabled){if(s.friendly)for(const a of y)a.type==="armored"?H(s,a,1,!1)&&(u.bulletsHit++,s.velocity.x*=.1,s.velocity.y*=.1,s.angularVelocity=ge(.02),s.disabled=!0,Ro(),setTimeout(()=>{s.remove=!0},300)):H(s,a,1,!1)&&(u.bulletsHit++,u.damageDealt+=Math.min(a.hp,W),a.hp-=W,a.hp<=0&&(++u.asteroidsDestroyed,a.remove=!0,fe()),s.remove=!0,Uo());else if(H(s,i,1,!1)&&(We(),s.remove=!0,i.hp<=0))break}for(const s of U)s.progress+=e/1e3*ht,ho(s,s.progress,a=>{a.remove=!0,++u.asteroidsDestroyed,u.damageDealt+=a.hp,fe()});for(const s of N)if(K(s,e),ue(s.position)&&(s.remove=!0),he(s,i))switch(s.remove=!0,Fo(),s.type){case"health":i.hp+=1,i.hp=Math.min(i.hp,5),Me(i.hp);break;case"damage":W+=1,Ps(W);break;case"rocket-piercing":ae+=1,Ts(ae);break}const t={...i.position};K(i,e);const o={x:i.position.x-t.x,y:i.position.y-t.y},n=Math.sqrt(o.x**2+o.y**2);u.distanceTraveled+=n,ie(Math.min(n/100,.05));for(const s of y)if(H(i,s,1,!0)&&(We(),i.hp<=0))break;if(V==null)!d.forward&&!d.backward&&!d.left&&!d.right&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3));else{const s=navigator.getGamepads()[V];Math.abs(s.axes[0])<.01&&Math.abs(s.axes[1])<.01&&!d.forward&&!d.backward&&!d.left&&!d.right&&!d.forwardController&&!d.backwardController&&!d.leftController&&!d.rightController&&(i.velocity.x*=Math.pow(.25,e/1e3),i.velocity.y*=Math.pow(.25,e/1e3))}(i.position.x<0||i.position.x>f.width)&&(i.position.x=Math.max(0,Math.min(i.position.x,f.width)),i.velocity.x*=-1),(i.position.y<0||i.position.y>f.height)&&(i.position.y=Math.max(0,Math.min(i.position.y,f.height)),i.velocity.y*=-1),qs()},qs=()=>{y.forEach(e=>{e.remove&&(v(z,e.id),e.frame=0,M(J,e))}),C.forEach(e=>{e.remove&&v(T,e.id)}),U.forEach(e=>{e.remove&&(v(P,e.id),e.children.forEach(t=>{v(O,t.id)}))}),N.forEach(e=>{e.remove&&v(ne,e.id)}),y=y.filter(e=>!e.remove),C=C.filter(e=>!e.remove),U=U.filter(e=>!e.remove),N=N.filter(e=>!e.remove)},gt=new Image;gt.src=Oo;const ft=new Image;ft.src=_o;const yt=new Image;yt.src=Ho;const wt=new Image;wt.src=Wo;const $s={default:gt,homing:ft,armored:yt,turret:wt},js=(e,t,o,n,s,a,c)=>{const l=R();if(l.position=e,l.rotation=t,l.acceleration=o,l.velocity=n,l.angularVelocity=s,l.mass=Ss(a,c),l.radius=c==="armored"?a*2:a,l.inertia=2/5*l.mass*a**2,l.hp=a/2,l.texture=$s[c],l.type=c,c==="turret"&&(l.lastBulletTime=p,l.bulletIndex=0),!he(l,i)){for(const m of y)if(he(l,m))return;M(z,l),y.push(l)}},xt=(e,t,o,n,s)=>{const a=R();a.position=e,a.rotation=t,a.velocity=o,a.angularVelocity=n,a.mass=dt,a.radius=5,a.inertia=2/5*a.mass*a.radius**2,a.friendly=s,M(T,a),C.push(a),++u.bulletsFired},zs=(e,t,o,n,s)=>{const a=R();a.position=e,a.rotation=t,a.velocity=o,a.angularVelocity=n,a.mass=dt,a.radius=5,a.targets=s,a.progress=0,a.currentTarget=0,mo(a),po(a),M(P,a),U.push(a),bt({x:-5,y:0},Math.PI/2,a),++u.rocketsFired},Js=(e,t,o,n)=>{i=R(),i.position=e,i.rotation=t,i.velocity=o,i.angularVelocity=n,i.mass=10,i.drag=1,i.maxVelocity=.5,i.height=40,i.width=40,i.radius=i.width/2,i.hp=5;const s=new Image;s.src=No,i.texture=s,M(X,i),Ne({x:-5,y:18},0,F,qo,i),Ne({x:-5,y:-18},0,F,Go,i)},Ne=(e,t,o,n,s)=>{const a=R();a.position=e,a.rotation=t,a.parent=s,a.height=20,a.width=20,M(o,a);const c=new Image;c.src=n,a.texture=c,s.children??(s.children=s.children||[]),s.children.push(a),bt({x:-5,y:0},Math.PI/2,a)},bt=(e,t,o)=>{const n=R();n.position=e,n.rotation=t,n.parent=o,n.height=10,n.width=5,o.children??(o.children=o.children||[]),o.children.push(n),M(O,n)},Xs=(e,t,o,n,s)=>{const a=R();a.type=e,a.position=t,a.rotation=o,a.velocity=n,a.angularVelocity=s,a.radius=25,M(ne,a),N.push(a)},vt=()=>{h=!h,h?(ct(),ie(0)):oe()},Ys=()=>{if(i){v(X,i.id);for(let e of i.children){v(F,e.id);for(let t of e.children)v(O,t.id)}}},Ks=()=>{f.width=f.clientWidth,f.height=f.clientHeight,Js({x:f.width/2,y:f.height/2},0,{x:0,y:0},0)},Qs=()=>{Ks(),mt(),ke=requestAnimationFrame(pt)},Zs=()=>{if(h)return;h=!0,cancelAnimationFrame(ke),ie(0),i=null;const e=ot(!B,!w);Es(B,w,u,e),ks(),vo(!B,!w)},ea=()=>{Mo(),Kt(),y=[],C=[],U=[],xe=1e3,ae=3,W=1,Me(5),oe(),ye()};_s();
